{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.drop.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { addClass, detach, EventHandler, select, formatUnit, createElement } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType, ImageInputSource } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\nimport { imageResizeFactor } from '../../common/config';\n/**\n * `Image` module is used to handle image actions.\n */\nvar Image = /** @class */function () {\n  function Image(parent, serviceLocator) {\n    this.isImgUploaded = false;\n    this.isAllowedTypes = true;\n    this.pageX = null;\n    this.pageY = null;\n    this.deletedImg = [];\n    this.parent = parent;\n    this.rteID = parent.element.id;\n    this.i10n = serviceLocator.getService('rteLocale');\n    this.rendererFactory = serviceLocator.getService('rendererFactory');\n    this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n    this.addEventListener();\n    this.drop = this.dragDrop.bind(this);\n    this.drag = this.dragOver.bind(this);\n    this.enter = this.dragEnter.bind(this);\n    this.start = this.dragStart.bind(this);\n    this.docClick = this.onDocumentClick.bind(this);\n    this.isDestroyed = false;\n  }\n  Image.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.on(events.keyDown, this.onKeyDown, this);\n    this.parent.on(events.keyUp, this.onKeyUp, this);\n    this.parent.on(events.insertImage, this.insertImage, this);\n    this.parent.on(events.showImageDialog, this.showDialog, this);\n    this.parent.on(events.closeImageDialog, this.closeDialog, this);\n    this.parent.on(events.windowResize, this.onWindowResize, this);\n    this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n    this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n    this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n    this.parent.on(events.imageCaption, this.caption, this);\n    this.parent.on(events.imageDelete, this.deleteImg, this);\n    this.parent.on(events.imageLink, this.insertImgLink, this);\n    this.parent.on(events.imageAlt, this.insertAltText, this);\n    this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n    this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n    this.parent.on(events.imageSize, this.imageSize, this);\n    this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n    this.parent.on(events.initialEnd, this.afterRender, this);\n    this.parent.on(events.dynamicModule, this.afterRender, this);\n    this.parent.on(events.paste, this.imagePaste, this);\n    this.parent.on(events.bindCssClass, this.setCssClass, this);\n    this.parent.on(events.destroy, this.destroy, this);\n  };\n  Image.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.off(events.keyDown, this.onKeyDown);\n    this.parent.off(events.keyUp, this.onKeyUp);\n    this.parent.off(events.windowResize, this.onWindowResize);\n    this.parent.off(events.insertImage, this.insertImage);\n    this.parent.off(events.showImageDialog, this.showDialog);\n    this.parent.off(events.closeImageDialog, this.closeDialog);\n    this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n    this.parent.off(events.clearDialogObj, this.clearDialogObj);\n    this.parent.off(events.imageCaption, this.caption);\n    this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n    this.parent.off(events.imageDelete, this.deleteImg);\n    this.parent.off(events.imageLink, this.insertImgLink);\n    this.parent.off(events.imageAlt, this.insertAltText);\n    this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n    this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n    this.parent.off(events.imageSize, this.imageSize);\n    this.parent.off(events.dropDownSelect, this.alignmentSelect);\n    this.parent.off(events.initialEnd, this.afterRender);\n    this.parent.off(events.dynamicModule, this.afterRender);\n    this.parent.off(events.paste, this.imagePaste);\n    this.parent.off(events.bindCssClass, this.setCssClass);\n    this.parent.off(events.destroy, this.destroy);\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.removeEventListener('drop', this.drop, true);\n    dropElement.removeEventListener('dragstart', this.drag, true);\n    dropElement.removeEventListener('dragenter', this.enter, true);\n    dropElement.removeEventListener('dragover', this.start, true);\n    this.drop = null;\n    this.drag = null;\n    this.enter = null;\n    this.start = null;\n    if (!isNOU(this.contentModule)) {\n      EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n      this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n      if (this.parent.insertImageSettings.resize) {\n        EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n        this.parent.element.ownerDocument.removeEventListener('mousedown', this.docClick);\n        this.docClick = null;\n        EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n      }\n    }\n  };\n  Image.prototype.updateCss = function (currentObj, e) {\n    if (currentObj && e.cssClass) {\n      if (isNOU(e.oldCssClass)) {\n        currentObj.setProperties({\n          cssClass: (currentObj.cssClass + ' ' + e.cssClass).trim()\n        });\n      } else {\n        currentObj.setProperties({\n          cssClass: (currentObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim()\n        });\n      }\n    }\n  };\n  // eslint-disable-next-line @typescript-eslint/tslint/config\n  Image.prototype.setCssClass = function (e) {\n    if (this.popupObj && e.cssClass) {\n      if (isNOU(e.oldCssClass)) {\n        addClass([this.popupObj.element], e.cssClass);\n      } else {\n        removeClass([this.popupObj.element], e.oldCssClass);\n        addClass([this.popupObj.element], e.cssClass);\n      }\n    }\n    this.updateCss(this.checkBoxObj, e);\n    this.updateCss(this.widthNum, e);\n    this.updateCss(this.heightNum, e);\n    this.updateCss(this.uploadObj, e);\n    this.updateCss(this.dialogObj, e);\n  };\n  Image.prototype.onIframeMouseDown = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  };\n  Image.prototype.afterRender = function () {\n    this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n    EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n    if (this.parent.insertImageSettings.resize) {\n      EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n      this.parent.element.ownerDocument.addEventListener('mousedown', this.docClick);\n      EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n    }\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.addEventListener('drop', this.drop, true);\n    dropElement.addEventListener('dragstart', this.drag, true);\n    dropElement.addEventListener('dragenter', this.enter, true);\n    dropElement.addEventListener('dragover', this.start, true);\n  };\n  Image.prototype.undoStack = function (args) {\n    if ((args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') && this.parent.editorMode === 'HTML') {\n      for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n        var temp = this.parent.createElement('div');\n        var contentElem = this.parent.formatter.getUndoRedoStack()[i].text;\n        temp.appendChild(contentElem.cloneNode(true));\n        var img = temp.querySelectorAll('img');\n        if (temp.querySelector('.e-img-resize') && img.length > 0) {\n          for (var j = 0; j < img.length; j++) {\n            img[j].style.outline = '';\n          }\n          detach(temp.querySelector('.e-img-resize'));\n          var clonedElement = temp.cloneNode(true);\n          var fragment = document.createDocumentFragment();\n          while (clonedElement.firstChild) {\n            fragment.appendChild(clonedElement.firstChild);\n          }\n          this.parent.formatter.getUndoRedoStack()[i].text = fragment;\n        }\n      }\n    }\n  };\n  Image.prototype.resizeEnd = function (e) {\n    this.resizeBtnInit();\n    if (this.imgEle.parentElement) {\n      this.imgEle.parentElement.style.cursor = 'auto';\n    }\n    if (Browser.isDevice) {\n      removeClass([e.target.parentElement], 'e-mob-span');\n    }\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.resizeStop, args);\n    this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n    this.parent.formatter.saveData();\n  };\n  Image.prototype.resizeStart = function (e, ele) {\n    var _this = this;\n    if (this.parent.readonly) {\n      return;\n    }\n    var target = ele ? ele : e.target;\n    this.prevSelectedImgEle = this.imgEle;\n    if (target.tagName === 'IMG') {\n      this.parent.preventDefaultResize(e);\n      var img = target;\n      if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n        detach(this.imgResizeDiv);\n      }\n      this.imageResize(img);\n    }\n    if (target.classList.contains('e-rte-imageboxmark')) {\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n      if (this.parent.iframeSettings.enable) {\n        this.pageX = e.screenX;\n        this.pageY = e.screenY;\n      } else {\n        this.pageX = this.getPointX(e);\n        this.pageY = this.getPointY(e);\n      }\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      this.resizeBtnInit();\n      if (this.quickToolObj) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n      var handlers = ['topLeft', 'topRight', 'botLeft', 'botRight'];\n      for (var i = 0; i < handlers.length; i++) {\n        var handler = handlers[i];\n        if (target.classList.contains('e-rte-' + handler)) {\n          this.resizeBtnStat[handler] = true;\n          this.currentResizeHandler = handler;\n          this.aspectRatio = this.findAspectRatio(this.imgEle);\n          break; // Exit the loop once a match is found\n        }\n      }\n      if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) && !this.imgResizeDiv.classList.contains('e-mob-span')) {\n        addClass([this.imgResizeDiv], 'e-mob-span');\n      } else {\n        var args = {\n          event: e,\n          requestType: 'images'\n        };\n        this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n          if (resizeStartArgs.cancel) {\n            _this.cancelResizeAction();\n          }\n        });\n      }\n      EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n      EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n    }\n  };\n  Image.prototype.imageClick = function (e) {\n    if (Browser.isDevice) {\n      if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A' || e.target.tagName === 'IMG') {\n        this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n        e.target.focus();\n      } else {\n        if (!this.parent.readonly) {\n          this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n        }\n      }\n    }\n    if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A') {\n      e.preventDefault();\n    }\n  };\n  Image.prototype.onCutHandler = function () {\n    if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n  };\n  Image.prototype.imageResize = function (e) {\n    this.resizeBtnInit();\n    this.imgEle = e;\n    addClass([this.imgEle], 'e-resize');\n    this.imgResizeDiv = this.parent.createElement('span', {\n      className: 'e-img-resize' + this.parent.getCssClass(true),\n      id: this.rteID + '_imgResize'\n    });\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topLeft' + this.parent.getCssClass(true),\n      styles: 'cursor: nwse-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topRight' + this.parent.getCssClass(true),\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botLeft' + this.parent.getCssClass(true),\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botRight' + this.parent.getCssClass(true),\n      styles: 'cursor: nwse-resize'\n    }));\n    if (Browser.isDevice) {\n      addClass([this.imgResizeDiv], 'e-mob-rte');\n    }\n    e.style.outline = '2px solid #4a90e2';\n    this.imgResizePos(e, this.imgResizeDiv);\n    this.resizeImgDupPos(e);\n    this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n  };\n  Image.prototype.getPointX = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageX;\n    } else {\n      return e.pageX;\n    }\n  };\n  Image.prototype.getPointY = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageY;\n    } else {\n      return e.pageY;\n    }\n  };\n  Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n    var pos = this.calcPos(e);\n    var top = pos.top;\n    var left = pos.left;\n    var imgWid = e.getBoundingClientRect().width;\n    var imgHgt = e.getBoundingClientRect().height;\n    var borWid = Browser.isDevice ? 4 * parseInt(e.style.outline.slice(-3), 10) + 2 : 2 * parseInt(e.style.outline.slice(-3), 10) + 2; //span border width + image outline width\n    var devWid = Browser.isDevice ? 0 : 2; // span border width\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.top = top - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.top = top - borWid + 'px';\n  };\n  Image.prototype.calcPos = function (elem) {\n    var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n    var parentOffset = {\n      top: 0,\n      left: 0\n    };\n    var elementOffset;\n    var doc = elem.ownerDocument;\n    var offsetParent = (elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') || ignoreOffset.indexOf(elem.offsetParent.tagName) > -1) ? closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n    while (offsetParent && (offsetParent === doc.body || offsetParent === doc.documentElement) && offsetParent.style.position === 'static') {\n      offsetParent = offsetParent.parentNode;\n    }\n    if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n      parentOffset = offsetParent.getBoundingClientRect();\n    }\n    if (elem.offsetParent && elem.offsetParent.classList.contains('e-img-caption')) {\n      elementOffset = elem.getBoundingClientRect();\n      return {\n        top: elementOffset.top - parentOffset.top,\n        left: elementOffset.left - parentOffset.left\n      };\n    } else {\n      return {\n        top: elem.offsetTop,\n        left: elem.offsetLeft\n      };\n    }\n  };\n  Image.prototype.setAspectRatio = function (img, expectedX, expectedY) {\n    if (isNOU(img.width)) {\n      return;\n    }\n    var width = img.width;\n    var height = img.height;\n    var sameHeightWidth = width === height;\n    var factor = this.parent.insertImageSettings.resizeByPercent ? '%' : 'px';\n    var emptyStyleDimension = img.style.width === '' && img.style.height === '';\n    if (!sameHeightWidth && !emptyStyleDimension) {\n      if (img.style.width !== '' && img.style.height !== '') {\n        if (this.parent.insertImageSettings.resizeByPercent) {\n          this.setImageWidth(img, expectedX, factor);\n          this.removeImageHeight(img);\n        } else {\n          this.setImageWidth(img, expectedX, factor);\n          this.setImageHeight(img, expectedY, factor);\n        }\n      } else if (img.style.width !== '') {\n        if (this.parent.insertImageSettings.resizeByPercent) {\n          this.setImageWidth(img, expectedX, factor);\n          this.removeImageHeight(img);\n        } else {\n          this.setImageWidth(img, expectedX, factor);\n        }\n      } else if (img.style.height !== '') {\n        if (this.parent.insertImageSettings.resizeByPercent) {\n          this.setImageWidth(img, expectedX, factor);\n          this.removeImageHeight(img);\n        } else {\n          this.setImageHeight(img, expectedY, factor);\n        }\n      }\n    } else {\n      this.setImageWidth(img, expectedX, factor);\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        this.removeImageHeight(img);\n      } else {\n        this.setImageHeight(img, expectedY, factor);\n      }\n    }\n  };\n  Image.prototype.setImageWidth = function (img, value, suffix) {\n    img.style.width = this.getImageDimension(value, img) + suffix;\n    if (!this.parent.insertImageSettings.resizeByPercent) {\n      img.setAttribute('width', value.toString());\n    }\n  };\n  Image.prototype.setImageHeight = function (img, value, suffix) {\n    img.style.height = this.getImageDimension(value, img) + suffix;\n    if (!this.parent.insertImageSettings.resizeByPercent) {\n      img.setAttribute('height', value.toString());\n    }\n  };\n  Image.prototype.removeImageHeight = function (img) {\n    img.style.height = '';\n    img.removeAttribute('height');\n  };\n  Image.prototype.getImageDimension = function (value, img) {\n    if (this.parent.insertImageSettings.resizeByPercent) {\n      var rootElem = img.parentElement;\n      return this.pixToPerc(value, rootElem);\n    } else {\n      return value;\n    }\n  };\n  Image.prototype.adjustDimensionsByAspectRatio = function (width, height, aspectRatio, isWidthPrimary) {\n    if (isWidthPrimary) {\n      height = Math.round(width / aspectRatio);\n      width = Math.round(height * aspectRatio);\n    } else {\n      width = Math.round(height * aspectRatio);\n      height = Math.round(width / aspectRatio);\n    }\n    return {\n      width: width,\n      height: height\n    };\n  };\n  Image.prototype.pixToPerc = function (expected, parentEle) {\n    return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n  };\n  Image.prototype.imgDupMouseMove = function (width, height, e) {\n    var _this = this;\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.onResize, args, function (resizingArgs) {\n      if (resizingArgs.cancel) {\n        _this.cancelResizeAction();\n      } else {\n        if (parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) || parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) && isNOU(_this.imgEle.style.width)) {\n          return;\n        }\n        if (!_this.parent.insertImageSettings.resizeByPercent && (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) || parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n          return;\n        }\n        _this.imgEle.parentElement.style.cursor = 'pointer';\n        _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10));\n        _this.resizeImgDupPos(_this.imgEle);\n        _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n      }\n    });\n  };\n  Image.prototype.resizing = function (e) {\n    if (!this.parent) {\n      this.cancelResizeAction();\n      return;\n    }\n    if (this.resizeBtnStat.botRight || this.resizeBtnStat.botLeft || this.resizeBtnStat.topRight || this.resizeBtnStat.topLeft) {\n      if (this.parent.iframeSettings.enable) {\n        var resizeFactor = this.getResizeFactor(this.currentResizeHandler);\n        var currentScreenX = e.screenX;\n        var currentScreenY = e.screenY;\n        var currentWidth = this.imgEle.clientWidth;\n        var currentHeight = this.imgEle.clientHeight;\n        var deltaX = currentScreenX - this.pageX;\n        var deltaY = currentScreenY - this.pageY;\n        var width = deltaX * resizeFactor[0] + currentWidth;\n        var height = deltaY * resizeFactor[1] + currentHeight;\n        var dimensions = this.adjustDimensions(width, height, deltaX, deltaY, this.aspectRatio);\n        this.pageX = currentScreenX;\n        this.pageY = currentScreenY;\n        this.imgDupMouseMove(dimensions.width + 'px', dimensions.height + 'px', e);\n        this.parent.autoResize();\n      } else {\n        var pageX = this.getPointX(e);\n        var pageY = this.getPointY(e);\n        var resizeFactor = this.getResizeFactor(this.currentResizeHandler);\n        var diffX = pageX - this.pageX;\n        var diffY = pageY - this.pageY;\n        var currentWidth = this.imgEle.clientWidth;\n        var currentHeight = this.imgEle.clientHeight;\n        var width = diffX * resizeFactor[0] + currentWidth;\n        var height = diffY * resizeFactor[1] + currentHeight;\n        var dimensions = this.adjustDimensions(width, height, diffX, diffY, this.aspectRatio);\n        this.pageX = pageX;\n        this.pageY = pageY;\n        this.imgDupMouseMove(dimensions.width + 'px', dimensions.height + 'px', e);\n      }\n    }\n  };\n  Image.prototype.adjustDimensions = function (width, height, diffX, diffY, aspectRatio) {\n    width = width < 16 ? 16 : width;\n    height = height < 16 ? 16 : height;\n    var isWidthPrimary = width > height;\n    var dimensions = this.adjustDimensionsByAspectRatio(width, height, aspectRatio, isWidthPrimary);\n    return dimensions;\n  };\n  Image.prototype.getResizeFactor = function (value) {\n    return imageResizeFactor[value];\n  };\n  Image.prototype.findAspectRatio = function (image) {\n    return image.clientWidth / image.clientHeight;\n  };\n  Image.prototype.cancelResizeAction = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n    if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      detach(this.imgResizeDiv);\n      this.imgEle.style.outline = '';\n      this.imgResizeDiv = null;\n      this.pageX = null;\n      this.pageY = null;\n      this.currentResizeHandler = null;\n      this.aspectRatio = null;\n    }\n  };\n  Image.prototype.resizeImgDupPos = function (e) {\n    this.imgDupPos = {\n      width: e.style.width !== '' && this.parent.insertImageSettings && !this.parent.insertImageSettings.resizeByPercent ? this.imgEle.style.width : e.width + 'px',\n      height: e.style.height !== '' ? this.imgEle.style.height : e.height + 'px'\n    };\n  };\n  Image.prototype.resizeBtnInit = function () {\n    this.aspectRatio = null;\n    this.currentResizeHandler = null;\n    return this.resizeBtnStat = {\n      botLeft: false,\n      botRight: false,\n      topRight: false,\n      topLeft: false\n    };\n  };\n  Image.prototype.onToolbarAction = function (args) {\n    if (isIDevice()) {\n      this.parent.notify(events.selectionRestore, {});\n    }\n    var item = args.args.item;\n    switch (item.subCommand) {\n      case 'Replace':\n        if (this.parent.fileManagerSettings.enable) {\n          this.parent.notify(events.renderFileManager, args);\n        } else {\n          this.parent.notify(events.insertImage, args);\n        }\n        break;\n      case 'Caption':\n        this.parent.notify(events.imageCaption, args);\n        break;\n      case 'InsertLink':\n        this.parent.notify(events.imageLink, args);\n        break;\n      case 'AltText':\n        this.parent.notify(events.imageAlt, args);\n        break;\n      case 'Remove':\n        this.parent.notify(events.imageDelete, args);\n        break;\n      case 'Dimension':\n        this.parent.notify(events.imageSize, args);\n        break;\n      case 'OpenImageLink':\n        this.openImgLink(args);\n        break;\n      case 'EditImageLink':\n        this.editImgLink(args);\n        break;\n      case 'RemoveImageLink':\n        this.removeImgLink(args);\n        break;\n    }\n  };\n  Image.prototype.openImgLink = function (e) {\n    var sanitizedHTML = this.parent.htmlEditorModule.sanitizeHelper(e.selectParent[0].parentNode.outerHTML);\n    var tempEle = document.createElement('div');\n    tempEle.innerHTML = sanitizedHTML;\n    var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      url: tempEle.firstChild.href,\n      target: target,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n    tempEle.remove();\n  };\n  Image.prototype.editImgLink = function (e) {\n    var selectParentEle = e.selectParent[0].parentNode;\n    var linkUpdate = this.i10n.getConstant('dialogUpdate');\n    var inputDetails = {\n      url: selectParentEle.href,\n      target: selectParentEle.target,\n      header: 'Edit Link',\n      btnText: linkUpdate\n    };\n    this.insertImgLink(e, inputDetails);\n  };\n  Image.prototype.removeImgLink = function (e) {\n    if (Browser.isIE) {\n      this.contentModule.getEditPanel().focus();\n    }\n    e.selection.restore();\n    var isCapLink = this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle) ? true : false;\n    var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      insertElement: e.selectNode[0],\n      selectParent: selectParent,\n      selection: e.selection,\n      subCommand: e.args.item.subCommand\n    });\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      if (!isNOU(e.selectParent)) {\n        removeClass([e.selectParent[0]], 'e-img-focus');\n      }\n    }\n    if (isCapLink) {\n      select('.e-img-inner', this.captionEle).focus();\n    }\n  };\n  Image.prototype.onKeyDown = function (event) {\n    var originalEvent = event.args;\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    this.deletedImg = [];\n    var isCursor;\n    var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n    if (this.parent.editorMode === 'HTML') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n    }\n    if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n      var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      for (var i = 0; i < nodes.length; i++) {\n        if (nodes[i].nodeName === 'IMG') {\n          this.deletedImg.push(nodes[i]);\n        }\n      }\n    }\n    if (this.parent.editorMode === 'HTML' && (originalEvent.which === 8 && originalEvent.code === 'Backspace' || originalEvent.which === 46 && originalEvent.code === 'Delete')) {\n      var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n      if (originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1) {\n        this.checkImageBack(range);\n      } else if (originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1) {\n        this.checkImageDel(range);\n      }\n    }\n    if (!isNOU(this.parent.formatter.editorManager.nodeSelection) && originalEvent.code !== 'KeyK') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') && !isNOU(selectParentEle[0]) && selectParentEle[0].tagName === 'IMG' && selectParentEle[0].parentElement) {\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n          this.removeResizeEle();\n        }\n        removeClass([selectParentEle[0]], 'e-img-focus');\n        if (this.quickToolObj && this.quickToolObj.imageQTBar) {\n          this.quickToolObj.imageQTBar.hidePopup();\n        }\n      }\n    }\n    if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n      if (this.parent.editorMode !== 'Markdown') {\n        this.undoStack({\n          subCommand: originalEvent.keyCode === 90 ? 'undo' : 'redo'\n        });\n      }\n    }\n    if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n      if (selectNodeEle && selectNodeEle[0] && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n        if (!isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n          save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n        }\n        originalEvent.preventDefault();\n        var event_1 = {\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle,\n          args: {\n            item: {\n              command: 'Images',\n              subCommand: 'Remove'\n            },\n            originalEvent: originalEvent\n          }\n        };\n        this.deleteImg(event_1, originalEvent.keyCode);\n      }\n      if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        this.removeResizeEle();\n      }\n    }\n    if (originalEvent.code === 'Backspace') {\n      originalEvent.action = 'backspace';\n    }\n    switch (originalEvent.action) {\n      case 'escape':\n        if (!isNOU(this.dialogObj)) {\n          this.dialogObj.close();\n        }\n        break;\n      case 'backspace':\n      case 'delete':\n        if (this.parent.editorMode !== 'Markdown') {\n          if (range.startContainer.nodeType === 3) {\n            if (originalEvent.code === 'Backspace') {\n              if (range.startContainer.previousElementSibling && range.startOffset === 0 && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                detach(range.startContainer.previousElementSibling);\n              }\n            } else {\n              if (range.startContainer.nextElementSibling && range.endContainer.textContent.length === range.endOffset && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                detach(range.startContainer.nextElementSibling);\n              }\n            }\n          } else if (range.startContainer.nodeType === 1) {\n            if (range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE)) {\n              detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n            } else if (range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK)) {\n              detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK));\n            } else if (range.startContainer.classList.contains('e-img-wrap') && closest(range.startContainer, '.' + classes.CLS_CAPTION)) {\n              var parentElem = range.startContainer.parentElement.parentElement;\n              detach(closest(range.startContainer, '.' + classes.CLS_CAPTION));\n              if (parentElem && parentElem.textContent.trim() === '') {\n                var brElem = this.parent.createElement('br');\n                brElem.classList.add('e-rte-image-remove-focus');\n                parentElem.appendChild(brElem);\n              }\n            }\n          }\n        }\n        break;\n      case 'insert-image':\n        if (!isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n          save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n        }\n        this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n        originalEvent.preventDefault();\n        break;\n    }\n    if (originalEvent.ctrlKey && originalEvent.key === 'a') {\n      this.handleSelectAll();\n    }\n  };\n  Image.prototype.handleSelectAll = function () {\n    this.cancelResizeAction();\n    var imgFocusNodes = this.parent.inputElement.querySelectorAll('.' + classes.CLS_IMG_FOCUS);\n    removeClass(imgFocusNodes, classes.CLS_IMG_FOCUS);\n  };\n  Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = selection;\n      selectNodeEle = ele;\n      selectParentEle = parentEle;\n    }\n    if (this.parent.editorMode === 'HTML') {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event,\n          name: !isInternal ? 'showDialog' : null\n        },\n        selectNode: selectNodeEle,\n        selection: save,\n        selectParent: selectParentEle\n      });\n    } else {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event,\n          name: !isInternal ? 'showDialog' : null\n        },\n        member: 'image',\n        text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n        module: 'Markdown',\n        name: 'insertImage'\n      });\n    }\n  };\n  Image.prototype.showDialog = function () {\n    this.openDialog(false);\n    this.setCssClass({\n      cssClass: this.parent.getCssClass()\n    });\n  };\n  Image.prototype.closeDialog = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  };\n  Image.prototype.onKeyUp = function () {\n    if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n      var deleteImages = Array.from(this.deletedImg);\n      for (var i = deleteImages.length - 1; i >= 0; i--) {\n        var args = {\n          element: this.deletedImg[i],\n          src: this.deletedImg[i].getAttribute('src')\n        };\n        this.parent.trigger(events.afterImageDelete, args);\n        this.deletedImg.splice(i, 1);\n      }\n    }\n  };\n  Image.prototype.checkImageBack = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === 0 && !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.previousSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) && range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n    }\n  };\n  Image.prototype.checkImageDel = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length && !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.nextSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) && range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n    }\n  };\n  Image.prototype.alignmentSelect = function (e) {\n    var item = e.item;\n    if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n      return;\n    }\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n    selectNodeEle = selectNodeEle[0].nodeName === 'IMG' ? selectNodeEle : [this.imgEle];\n    var args = {\n      args: e,\n      selectNode: selectNodeEle\n    };\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n    switch (item.subCommand) {\n      case 'JustifyLeft':\n        this.alignImage(args);\n        break;\n      case 'JustifyCenter':\n        this.alignImage(args);\n        break;\n      case 'JustifyRight':\n        this.alignImage(args);\n        break;\n      case 'Inline':\n        this.inline(args);\n        break;\n      case 'Break':\n        this.break(args);\n        break;\n    }\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNodeEle[0]], 'e-img-focus');\n    }\n    this.cancelResizeAction();\n  };\n  Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n    var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n    for (var i = 0; i < items.length; i++) {\n      if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n        addClass([items[i]], 'e-link-groups');\n        items[i].style.display = 'none';\n      } else if (items[i].getAttribute('title') === 'Insert Link') {\n        items[i].style.display = '';\n      } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n        detach(items[i]);\n      }\n    }\n    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n  };\n  Image.prototype.showImageQuickToolbar = function (e) {\n    var _this = this;\n    if (e.type !== 'Images' || isNOU(this.parent.quickToolbarModule) || isNOU(this.parent.quickToolbarModule.imageQTBar) || isNOU(e.args)) {\n      return;\n    }\n    this.quickToolObj = this.parent.quickToolbarModule;\n    var args = e.args;\n    var target = e.elements;\n    [].forEach.call(e.elements, function (element, index) {\n      if (index === 0) {\n        target = element;\n      }\n    });\n    if (target && !closest(target, 'a')) {\n      this.imageWithLinkQTBarItemUpdate();\n    }\n    if (target.nodeName === 'IMG') {\n      addClass([target], ['e-img-focus']);\n    }\n    var pageY = this.parent.iframeSettings.enable ? window.pageYOffset + this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n    if (this.parent.quickToolbarModule.imageQTBar) {\n      if (e.isNotify) {\n        this.imageQTPopupTime = setTimeout(function () {\n          _this.parent.formatter.editorManager.nodeSelection.Clear(_this.contentModule.getDocument());\n          _this.parent.formatter.editorManager.nodeSelection.setSelectionContents(_this.contentModule.getDocument(), target);\n          _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n          if (_this.parent.insertImageSettings.resize === true) {\n            _this.resizeStart(e.args, target);\n          }\n        }, 400);\n      } else {\n        var coordinates = target.getBoundingClientRect();\n        this.quickToolObj.imageQTBar.showPopup(coordinates.left, coordinates.top, target, 'Image');\n      }\n    }\n  };\n  Image.prototype.hideImageQuickToolbar = function () {\n    if (!isNOU(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n      removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n      if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n    }\n  };\n  Image.prototype.editAreaClickHandler = function (e) {\n    if (this.parent.readonly) {\n      this.hideImageQuickToolbar();\n      return;\n    }\n    var args = e.args;\n    var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n    if (args.which === 2 || showOnRightClick && args.which === 1 || !showOnRightClick && args.which === 3) {\n      if (showOnRightClick && args.which === 1 && !isNOU(args.target) && args.target.tagName === 'IMG') {\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n      }\n      return;\n    }\n    if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n      this.quickToolObj = this.parent.quickToolbarModule;\n      var target = args.target;\n      this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n      var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n      if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n        if (isPopupOpen) {\n          return;\n        }\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n        if (isIDevice()) {\n          this.parent.notify(events.selectionSave, e);\n        }\n        addClass([target], 'e-img-focus');\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        var separator = void 0;\n        if (closest(target, 'a')) {\n          for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n              items[i].style.display = '';\n              removeClass([items[i]], 'e-link-groups');\n            } else if (items[i].getAttribute('title') === 'Insert Link') {\n              items[i].style.display = 'none';\n            } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n              // eslint-disable-next-line\n              separator = items[i];\n              detach(items[i]);\n            }\n          }\n          var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n          this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n        } else if (!closest(target, 'a')) {\n          this.imageWithLinkQTBarItemUpdate();\n        }\n        this.showImageQuickToolbar({\n          args: args,\n          type: 'Images',\n          elements: [args.target]\n        });\n      } else {\n        this.hideImageQuickToolbar();\n      }\n    }\n  };\n  Image.prototype.insertImgLink = function (e, inputDetails) {\n    var _this = this;\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    this.imagDialog(e);\n    if (!isNOU(this.dialogObj)) {\n      var linkWrap = this.parent.createElement('div', {\n        className: 'e-img-linkwrap' + this.parent.getCssClass(true)\n      });\n      var linkUrl = this.i10n.getConstant('linkurl');\n      var content = '<div class=\"e-rte-field' + this.parent.getCssClass(true) + '\">' + '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link' + this.parent.getCssClass(true) + '\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' + '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' + '<input type=\"checkbox\" class=\"e-rte-linkTarget' + this.parent.getCssClass(true) + '\"  data-role =\"none\"></div>';\n      var contentElem = parseHtml(content);\n      linkWrap.appendChild(contentElem);\n      var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n      var inputLink = linkWrap.querySelector('.e-img-link');\n      var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n      this.checkBoxObj = new CheckBox({\n        label: linkOpenLabel,\n        checked: true,\n        enableRtl: this.parent.enableRtl,\n        cssClass: this.parent.getCssClass(),\n        change: function (e) {\n          if (e.checked) {\n            target_1 = '_blank';\n          } else {\n            target_1 = null;\n          }\n        }\n      });\n      this.checkBoxObj.isStringTemplate = true;\n      this.checkBoxObj.createElement = this.parent.createElement;\n      this.checkBoxObj.appendTo(linkTarget);\n      var target_1 = '_blank';\n      var imageLabel = this.i10n.getConstant('imageLinkAriaLabel');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var linkargs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        selectParent: e.selectParent,\n        link: inputLink,\n        target: target_1,\n        ariaLabel: imageLabel\n      };\n      this.dialogObj.setProperties({\n        width: '290px',\n        header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n        content: linkWrap,\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertlink(linkargs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-link' + this.parent.getCssClass(true),\n            isPrimary: true\n          }\n        }],\n        cssClass: this.dialogObj.cssClass + ' e-rte-img-link-dialog'\n      });\n      if (!isNOU(this.parent.cssClass)) {\n        this.dialogObj.setProperties({\n          cssClass: this.parent.cssClass\n        });\n      }\n      if (!isNOU(inputDetails)) {\n        inputLink.value = inputDetails.url;\n        this.checkBoxObj.checked = inputDetails.target ? true : false;\n        this.dialogObj.header = inputDetails.header;\n      }\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n  Image.prototype.insertAltText = function (e) {\n    var _this = this;\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    this.imagDialog(e);\n    var altText = this.i10n.getConstant('altText');\n    if (!isNOU(this.dialogObj)) {\n      var altWrap = this.parent.createElement('div', {\n        className: 'e-img-altwrap' + this.parent.getCssClass(true)\n      });\n      var altHeader = this.i10n.getConstant('alternateHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var getAlt = e.selectNode[0].getAttribute('alt') === null ? '' : e.selectNode[0].getAttribute('alt');\n      var content = '<div class=\"e-rte-field' + this.parent.getCssClass(true) + '\">' + '<input type=\"text\" spellcheck=\"false\"  class=\"e-input e-img-alt' + this.parent.getCssClass(true) + '\" placeholder=\"' + altText + '\"/>' + '</div>';\n      var contentElem = parseHtml(content);\n      contentElem.querySelector('input').setAttribute('value', getAlt);\n      altWrap.appendChild(contentElem);\n      var inputAlt = altWrap.querySelector('.e-img-alt');\n      var altArgs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        alt: inputAlt\n      };\n      this.dialogObj.setProperties({\n        width: '290px',\n        header: altHeader,\n        content: altWrap,\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertAlt(altArgs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-alt' + this.parent.getCssClass(true),\n            isPrimary: true\n          }\n        }],\n        cssClass: this.dialogObj.cssClass + ' e-rte-img-alt-dialog'\n      });\n      if (!isNOU(this.parent.cssClass)) {\n        this.dialogObj.setProperties({\n          cssClass: this.parent.cssClass\n        });\n      }\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n  Image.prototype.insertAlt = function (e) {\n    if (!isNOU(e.alt)) {\n      e.selection.restore();\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n      var altText = e.alt.value;\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        altText: altText,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      this.dialogObj.hide({\n        returnValue: false\n      });\n    }\n  };\n  Image.prototype.insertlink = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var url = e.link.value;\n    if (url === '') {\n      addClass([e.link], 'e-error');\n      e.link.setSelectionRange(0, url.length);\n      e.link.focus();\n      return;\n    }\n    if (!this.isUrl(url)) {\n      url = 'http://' + url;\n    } else {\n      removeClass([e.link], 'e-error');\n    }\n    var proxy = e.selfImage;\n    if (proxy.parent.editorMode === 'HTML') {\n      e.selection.restore();\n    }\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n    if (e.selectNode[0].parentElement.nodeName === 'A') {\n      proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n        url: url,\n        target: proxy.checkBoxObj.checked ? '_blank' : null,\n        ariaLabel: proxy.checkBoxObj.checked ? this.i10n.getConstant('imageLinkAriaLabel') : null,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      proxy.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n    proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n      url: url,\n      target: proxy.checkBoxObj.checked ? '_blank' : null,\n      ariaLabel: proxy.checkBoxObj.checked ? this.i10n.getConstant('imageLinkAriaLabel') : null,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand,\n      selection: e.selection\n    });\n    var captionEle = closest(e.selectNode[0], '.e-img-caption');\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n    proxy.dialogObj.hide({\n      returnValue: false\n    });\n  };\n  Image.prototype.isUrl = function (url) {\n    var regExp = RegExp;\n    var regexp = new regExp('(ftp|http|https)://(\\\\w+:{0,1}\\\\w*@)?(\\\\S+)(:[0-9]+)?(/|/([\\\\w#!:.?+=&%@\\\\-\\\\/]))?', 'gi');\n    return regexp.test(url);\n  };\n  Image.prototype.deleteImg = function (e, keyCode) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var args = {\n      element: e.selectNode[0],\n      src: e.selectNode[0].getAttribute('src')\n    };\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n    var restoreStartElement = e.selection.range.startContainer;\n    if (e.selection.range.startContainer.nodeName === 'SPAN' && restoreStartElement.classList.contains('e-img-wrap') && restoreStartElement.parentElement.classList.contains('e-img-caption')) {\n      restoreStartElement = restoreStartElement.parentElement;\n      if (!isNOU(restoreStartElement.previousSibling)) {\n        var lastNode = restoreStartElement.previousSibling;\n        while (lastNode.nodeName !== '#text' && lastNode.nodeName !== 'BR') {\n          lastNode = lastNode.lastChild;\n        }\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(), lastNode, lastNode.nodeName !== 'BR' ? lastNode.textContent.length : 0);\n      } else if (!isNOU(restoreStartElement.nextSibling)) {\n        var firstNode = restoreStartElement.nextSibling;\n        while (firstNode.nodeName !== '#text' && firstNode.nodeName !== 'BR') {\n          firstNode = firstNode.firstChild;\n        }\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(), firstNode, 0);\n      }\n    } else {\n      e.selection.restore();\n    }\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n      this.removeResizeEle();\n    }\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      captionClass: classes.CLS_CAPTION,\n      subCommand: e.args.item.subCommand\n    });\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n    }\n    this.cancelResizeAction();\n    if (isNOU(keyCode)) {\n      this.parent.trigger(events.afterImageDelete, args);\n    }\n  };\n  Image.prototype.caption = function (e) {\n    var selectNode = e.selectNode[0];\n    if (selectNode.nodeName !== 'IMG') {\n      return;\n    }\n    e.selection.restore();\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n    this.cancelResizeAction();\n    addClass([selectNode], 'e-rte-image');\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Caption';\n    if (!isNOU(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n      detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n      if (Browser.isIE) {\n        this.contentModule.getEditPanel().focus();\n        e.selection.restore();\n      }\n      if (selectNode.parentElement.tagName === 'A') {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode.parentElement,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      } else {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      }\n    } else {\n      this.captionEle = this.parent.createElement('span', {\n        className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION + this.parent.getCssClass(true),\n        attrs: {\n          contenteditable: 'false',\n          draggable: 'false',\n          style: 'width:' + this.parent.insertImageSettings.width\n        }\n      });\n      var imgWrap = this.parent.createElement('span', {\n        className: 'e-img-wrap' + this.parent.getCssClass(true)\n      });\n      var imgInner = this.parent.createElement('span', {\n        className: 'e-img-inner' + this.parent.getCssClass(true),\n        attrs: {\n          contenteditable: 'true'\n        }\n      });\n      var parent_1 = e.selectNode[0].parentElement;\n      if (parent_1.tagName === 'A') {\n        parent_1.setAttribute('contenteditable', 'true');\n      }\n      imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n      imgWrap.appendChild(imgInner);\n      var imgCaption = this.i10n.getConstant('imageCaption');\n      imgInner.innerHTML = imgCaption;\n      this.captionEle.appendChild(imgWrap);\n      if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n        addClass([this.captionEle], classes.CLS_CAPINLINE);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n        addClass([this.captionEle], classes.CLS_IMGBREAK);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n        addClass([this.captionEle], classes.CLS_IMGLEFT);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n        addClass([this.captionEle], classes.CLS_IMGRIGHT);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n        addClass([this.captionEle], classes.CLS_IMGCENTER);\n      }\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        insertElement: this.captionEle,\n        selectNode: e.selectNode,\n        subCommand: subCommand\n      });\n      this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n    }\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNode], 'e-img-focus');\n    }\n  };\n  Image.prototype.imageSize = function (e) {\n    var _this = this;\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    this.imagDialog(e);\n    if (!isNOU(this.dialogObj)) {\n      var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var dialogContent = this.imgsizeInput(e);\n      var selectObj_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode\n      };\n      this.dialogObj.setProperties({\n        width: '290px',\n        header: imgSizeHeader,\n        content: dialogContent,\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertSize(selectObj_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-size' + this.parent.getCssClass(true),\n            isPrimary: true\n          }\n        }],\n        cssClass: this.dialogObj.cssClass + ' e-rte-img-size-dialog'\n      });\n      if (!isNOU(this.parent.cssClass)) {\n        this.dialogObj.setProperties({\n          cssClass: this.parent.cssClass\n        });\n      }\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n  Image.prototype.break = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var subCommand = e.args.item.subCommand;\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n  Image.prototype.inline = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var subCommand = e.args.item.subCommand;\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n  Image.prototype.alignImage = function (e) {\n    var subCommand = e.args.item.subCommand;\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n  Image.prototype.clearDialogObj = function () {\n    if (this.uploadObj && !this.uploadObj.isDestroyed) {\n      this.uploadObj.destroy();\n      detach(this.uploadObj.element);\n      this.uploadObj = null;\n    }\n    if (this.checkBoxObj && !this.checkBoxObj.isDestroyed) {\n      this.checkBoxObj.destroy();\n      detach(this.checkBoxObj.element);\n      this.checkBoxObj = null;\n    }\n    if (this.popupObj && !this.popupObj.isDestroyed) {\n      this.popupObj.destroy();\n      detach(this.popupObj.element);\n      this.popupObj = null;\n    }\n    if (this.widthNum && !this.widthNum.isDestroyed) {\n      this.widthNum.destroy();\n      detach(this.widthNum.element);\n      this.widthNum = null;\n    }\n    if (this.heightNum && !this.heightNum.isDestroyed) {\n      this.heightNum.destroy();\n      detach(this.heightNum.element);\n      this.heightNum = null;\n    }\n    if (this.browseButton && !this.browseButton.isDestroyed) {\n      this.browseButton.destroy();\n      detach(this.browseButton.element);\n      this.browseButton = null;\n    }\n    if (this.dialogObj && !this.dialogObj.isDestroyed) {\n      this.dialogObj.destroy();\n      detach(this.dialogObj.element);\n      this.dialogObj = null;\n    }\n  };\n  Image.prototype.imagDialog = function (e) {\n    var _this = this;\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n    var imgDialog = this.parent.createElement('div', {\n      className: 'e-rte-img-dialog' + this.parent.getCssClass(true),\n      id: this.rteID + '_image'\n    });\n    this.parent.rootContainer.appendChild(imgDialog);\n    var imgInsert = this.i10n.getConstant('dialogInsert');\n    var imglinkCancel = this.i10n.getConstant('dialogCancel');\n    var imgHeader = this.i10n.getConstant('imageHeader');\n    var selection = e.selection;\n    var selectObj = {\n      selfImage: this,\n      selection: e.selection,\n      args: e.args,\n      selectParent: e.selectParent\n    };\n    var dialogModel = {\n      header: imgHeader,\n      cssClass: classes.CLS_RTE_ELEMENTS + this.parent.getCssClass(true),\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      showCloseIcon: true,\n      closeOnEscape: true,\n      width: Browser.isDevice ? '290px' : '340px',\n      isModal: Browser.isDevice,\n      buttons: [{\n        click: this.insertImageUrl.bind(selectObj),\n        buttonModel: {\n          content: imgInsert,\n          cssClass: 'e-flat e-insertImage' + this.parent.getCssClass(true),\n          isPrimary: true,\n          disabled: this.parent.editorMode === 'Markdown' ? false : true\n        }\n      }, {\n        click: this.cancelDialog.bind(this),\n        buttonModel: {\n          cssClass: 'e-flat e-cancel' + this.parent.getCssClass(true),\n          content: imglinkCancel\n        }\n      }],\n      target: Browser.isDevice ? document.body : this.parent.element,\n      animationSettings: {\n        effect: 'None'\n      },\n      close: function (event) {\n        if (event && event.closedBy !== 'user action' && _this.uploadObj.filesData.length > 0) {\n          _this.uploadObj.remove();\n        }\n        _this.parent.isBlur = false;\n        if (event && !isNOU(event.event) && event.event.returnValue) {\n          if (_this.parent.editorMode === 'HTML') {\n            selection.restore();\n          } else {\n            _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n          }\n        }\n        _this.clearDialogObj();\n        _this.dialogRenderObj.close(event);\n      }\n    };\n    var dialogContent = this.parent.createElement('div', {\n      className: 'e-img-content' + this.parent.getCssClass(true)\n    });\n    if (!isNOU(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n      dialogContent.appendChild(this.imgUpload(e));\n    }\n    var linkHeader = this.parent.createElement('div', {\n      className: 'e-linkheader' + this.parent.getCssClass(true)\n    });\n    var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n    if (this.parent.editorMode === 'HTML') {\n      linkHeader.innerHTML = linkHeaderText;\n    } else {\n      linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n    }\n    dialogContent.appendChild(linkHeader);\n    dialogContent.appendChild(this.imageUrlPopup(e));\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n      dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n      dialogModel.content = dialogContent;\n      dialogModel.buttons[0].buttonModel.cssClass = dialogModel.buttons[0].buttonModel.cssClass + ' e-updateImage';\n    } else {\n      dialogModel.content = dialogContent;\n    }\n    this.dialogObj = this.dialogRenderObj.render(dialogModel);\n    this.dialogObj.createElement = this.parent.createElement;\n    this.dialogObj.appendTo(imgDialog);\n    if (isNOU(this.dialogObj)) {\n      return;\n    }\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && e.name === 'insertImage') {\n      this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n    }\n    imgDialog.style.maxHeight = 'inherit';\n    if (this.quickToolObj) {\n      if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n        if (!isNOU(e.selectParent)) {\n          removeClass([e.selectParent[0]], 'e-img-focus');\n        }\n      }\n      if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n        this.quickToolObj.inlineQTBar.hidePopup();\n      }\n      if (this.quickToolObj.textQTBar && this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)) {\n        this.quickToolObj.textQTBar.hidePopup();\n      }\n    }\n  };\n  Image.prototype.cancelDialog = function () {\n    this.parent.isBlur = false;\n    if (this.uploadObj.filesData.length > 0) {\n      this.uploadObj.remove();\n    }\n    this.dialogObj.hide({\n      returnValue: true\n    });\n  };\n  Image.prototype.onDocumentClick = function (e) {\n    var target = e.target;\n    if (isNOU(this.contentModule.getEditPanel())) {\n      return;\n    }\n    if (target.nodeName === 'IMG') {\n      this.imgEle = target;\n    }\n    if (!this.parent) {\n      return;\n    }\n    if (target.nodeName !== '#document') {\n      this.parent.currentTarget = e.target;\n    }\n    if (!isNOU(this.dialogObj) && (\n    // eslint-disable-next-line\n    !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() && !this.parent.getToolbarElement().contains(e.target) || this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) && !closest(target, '#' + this.parent.getID() + '_toolbar_Image') && !target.querySelector('#' + this.parent.getID() + '_toolbar_Image'))) {\n      /* eslint-disable */\n      if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {} else {\n        this.parent.notify(events.documentClickClosedBy, {\n          closedBy: \"outside click\"\n        });\n        this.dialogObj.hide({\n          returnValue: true\n        });\n        this.parent.isBlur = true;\n        dispatchEvent(this.parent.element, 'focusout');\n      }\n      /* eslint-enable */\n    }\n    if (!(this.parent.iframeSettings.enable && !isNOU(this.parent.currentTarget) && this.parent.currentTarget.nodeName === 'IMG') && e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj && this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize') && !(this.parent.iframeSettings.enable && this.parent.currentTarget.nodeName === 'IMG')) {\n      if (target.tagName !== 'IMG') {\n        this.removeResizeEle();\n      }\n      if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n        this.imgEle.style.outline = '';\n      } else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n        this.prevSelectedImgEle.style.outline = '';\n      }\n    }\n    if (target.tagName !== 'IMG') {\n      var items = this.contentModule.getEditPanel().querySelectorAll('img');\n      for (var i = 0; i < items.length; i++) {\n        removeClass([items[i]], 'e-img-focus');\n        removeClass([items[i]], 'e-resize');\n      }\n    }\n    if (this.parent.inlineMode.enable && target && this.dialogObj && !closest(target, '#' + this.dialogObj.element.id)) {\n      this.dialogObj.hide();\n    }\n  };\n  Image.prototype.removeResizeEle = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n    detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n  };\n  Image.prototype.onWindowResize = function () {\n    if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n      this.cancelResizeAction();\n    }\n  };\n  Image.prototype.imageUrlPopup = function (e) {\n    var _this = this;\n    var imgUrl = this.parent.createElement('div', {\n      className: 'imgUrl' + this.parent.getCssClass(true)\n    });\n    var placeUrl = this.i10n.getConstant('imageUrl');\n    this.inputUrl = this.parent.createElement('input', {\n      className: 'e-input e-img-url' + this.parent.getCssClass(true),\n      attrs: {\n        placeholder: placeUrl,\n        spellcheck: 'false',\n        'aria-label': this.i10n.getConstant('imageLinkHeader')\n      }\n    });\n    this.inputUrl.addEventListener('input', function () {\n      if (!isNOU(_this.inputUrl)) {\n        if (_this.inputUrl.value.length === 0) {\n          _this.dialogObj.getButtons(0).element.disabled = true;\n        } else {\n          _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n        }\n      }\n    });\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n      var regex = new RegExp(/([^\\S]|^)(((https?:\\/\\/)|(www\\.))(\\S+))/gi);\n      this.inputUrl.value = e.selectNode[0].src.match(regex) ? e.selectNode[0].src : '';\n    }\n    imgUrl.appendChild(this.inputUrl);\n    return imgUrl;\n  };\n  Image.prototype.insertImageUrl = function (e) {\n    var proxy = this.selfImage;\n    proxy.isImgUploaded = false;\n    var url = proxy.inputUrl.value;\n    if (e.target && e.target.nodeName === 'BUTTON' && e.target.classList.contains('e-updateImage')) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      var element = this.selectNode && this.selectNode[0] && this.selectNode[0].nodeName === 'IMG' ?\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      this.selectNode[0] : null;\n      var args = {\n        element: element,\n        src: url\n      };\n      proxy.parent.trigger(events.afterImageDelete, args);\n    }\n    if (proxy.parent.editorMode === 'Markdown' && url === '') {\n      url = 'http://';\n    }\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n    var previousSubCommand = this.args.item.subCommand;\n    this.args.item.subCommand = e.target.innerHTML === 'Update' ? 'Replace' : this.args.item.subCommand;\n    if (!isNOU(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n      proxy.uploadUrl.cssClass = proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK;\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n      if (proxy.dialogObj !== null) {\n        return;\n      }\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n      proxy.uploadUrl.url = '';\n      if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        proxy.imgEle.style.outline = '';\n        proxy.removeResizeEle();\n      }\n    } else if (url !== '') {\n      if (proxy.parent.editorMode === 'HTML' && isNOU(closest(\n      // eslint-disable-next-line\n      this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n        proxy.contentModule.getEditPanel().focus();\n        var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n        this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n        this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      }\n      var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n      var matchUrl = !isNOU(url.match(regex)) && proxy.parent.editorMode === 'HTML' ? url.match(regex)[0] : '';\n      var value = {\n        cssClass: proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n        url: url,\n        selection: this.selection,\n        altText: matchUrl,\n        selectParent: this.selectParent,\n        width: {\n          width: proxy.parent.insertImageSettings.width,\n          minWidth: proxy.parent.insertImageSettings.minWidth,\n          maxWidth: proxy.parent.getInsertImgMaxWidth()\n        },\n        height: {\n          height: proxy.parent.insertImageSettings.height,\n          minHeight: proxy.parent.insertImageSettings.minHeight,\n          maxHeight: proxy.parent.insertImageSettings.maxHeight\n        }\n      };\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n      if (proxy.dialogObj !== null) {\n        return;\n      }\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n    }\n    this.args.item.subCommand = previousSubCommand;\n  };\n  Image.prototype.imgsizeInput = function (e) {\n    var _this = this;\n    var selectNode = e.selectNode[0];\n    var imgHeight = this.i10n.getConstant('imageHeight');\n    var imgWidth = this.i10n.getConstant('imageWidth');\n    var imgSizeWrap = this.parent.createElement('div', {\n      className: 'e-img-sizewrap' + this.parent.getCssClass(true)\n    });\n    var widthVal = isNOU(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' || selectNode.style.width !== '') ? selectNode.style.width : !isNOU(this.changedWidthValue) ? this.changedWidthValue : parseInt(selectNode.getClientRects()[0].width.toString(), 10).toString();\n    var heightVal = isNOU(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' || selectNode.style.height !== '') ? selectNode.style.height : !isNOU(this.changedHeightValue) ? this.changedHeightValue : parseInt(selectNode.getClientRects()[0].height.toString(), 10).toString();\n    if (selectNode.style.width === '') {\n      widthVal = 'auto';\n    }\n    if (selectNode.style.height === '') {\n      heightVal = 'auto';\n    }\n    this.changedWidthValue = null;\n    this.changedHeightValue = null;\n    var content = '<div class=\"e-rte-label' + this.parent.getCssClass(true) + '\"><label>' + imgWidth + '</label></div><div class=\"e-rte-field' + this.parent.getCssClass(true) + '\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width' + this.parent.getCssClass(true) + '\"/></div>' + '<div class=\"e-rte-label' + this.parent.getCssClass(true) + '\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field' + this.parent.getCssClass(true) + '\"> ' + '<input type=\"text\" id=\"imgheight\" class=\"e-img-height' + this.parent.getCssClass(true) + '\"/></div>';\n    var contentElem = parseHtml(content);\n    contentElem.getElementById('imgwidth').setAttribute('value', widthVal);\n    contentElem.getElementById('imgheight').setAttribute('value', heightVal);\n    imgSizeWrap.appendChild(contentElem);\n    this.widthNum = new TextBox({\n      value: formatUnit(widthVal),\n      enableRtl: this.parent.enableRtl,\n      cssClass: this.parent.getCssClass(),\n      input: function (e) {\n        _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    this.widthNum.createElement = this.parent.createElement;\n    this.widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n    this.heightNum = new TextBox({\n      value: formatUnit(heightVal),\n      enableRtl: this.parent.enableRtl,\n      cssClass: this.parent.getCssClass(),\n      input: function (e) {\n        _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    this.heightNum.createElement = this.parent.createElement;\n    this.heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n    return imgSizeWrap;\n  };\n  Image.prototype.inputValue = function (value) {\n    if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1 || value.match(/(\\d+)/)) {\n      return value;\n    } else {\n      return 'auto';\n    }\n  };\n  Image.prototype.insertSize = function (e) {\n    e.selection.restore();\n    var proxy = e.selfImage;\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n    var dialogEle = proxy.dialogObj.element;\n    this.changedWidthValue = this.inputWidthValue;\n    this.changedHeightValue = this.inputHeightValue;\n    var width = dialogEle.querySelector('.e-img-width').value;\n    var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n    proxy.parent.formatter.process(this.parent, e.args, e.args, {\n      width: width,\n      height: height,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n    if (this.imgResizeDiv) {\n      proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n    }\n    proxy.dialogObj.hide({\n      returnValue: true\n    });\n  };\n  Image.prototype.insertImage = function (e) {\n    this.imagDialog(e);\n    if (!isNOU(this.dialogObj)) {\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n      if (!isNOU(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n        document.getElementById(this.rteID + '_insertImage').focus();\n      } else {\n        dialogContent.querySelector('.e-img-url').focus();\n      }\n    }\n  };\n  Image.prototype.imgUpload = function (e) {\n    var _this = this;\n    var save;\n    var selectParent;\n    // eslint-disable-next-line\n    var proxy = this;\n    var iframe = proxy.parent.iframeSettings.enable;\n    if (proxy.parent.editorMode === 'HTML' && (!iframe && isNOU(closest(e.selection.range.startContainer.parentNode, '[id='\n    // eslint-disable-next-line\n    + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']')) || iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib'))) {\n      this.contentModule.getEditPanel().focus();\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = e.selection;\n      selectParent = e.selectParent;\n    }\n    var uploadParentEle = this.parent.createElement('div', {\n      className: 'e-img-uploadwrap e-droparea' + this.parent.getCssClass(true)\n    });\n    var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n    var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n    var span = this.parent.createElement('span', {\n      className: 'e-droptext' + this.parent.getCssClass(true)\n    });\n    var spanMsg = this.parent.createElement('span', {\n      className: 'e-rte-upload-text' + this.parent.getCssClass(true),\n      innerHTML: Browser.isDevice ? deviceImgUpMsg : imgUpMsg\n    });\n    span.appendChild(spanMsg);\n    var btnEle = this.parent.createElement('button', {\n      className: 'e-browsebtn' + this.parent.getCssClass(true),\n      id: this.rteID + '_insertImage',\n      attrs: {\n        autofocus: 'true',\n        type: 'button'\n      }\n    });\n    span.appendChild(btnEle);\n    uploadParentEle.appendChild(span);\n    var browserMsg = this.i10n.getConstant('browse');\n    this.browseButton = new Button({\n      content: browserMsg,\n      enableRtl: this.parent.enableRtl\n    });\n    this.browseButton.isStringTemplate = true;\n    this.browseButton.createElement = this.parent.createElement;\n    this.browseButton.appendTo(btnEle);\n    var btnClick = Browser.isDevice ? span : btnEle;\n    EventHandler.add(btnClick, 'click', this.fileSelect, this);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      },\n      className: this.parent.getCssClass()\n    });\n    uploadParentEle.appendChild(uploadEle);\n    var altText;\n    var selectArgs;\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    var filesData;\n    var previousFileInfo = null;\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      dropArea: span,\n      multiple: false,\n      enableRtl: this.parent.enableRtl,\n      cssClass: this.parent.getCssClass(),\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      selected: function (e) {\n        proxy.isImgUploaded = true;\n        selectArgs = e;\n        filesData = e.filesData;\n        _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n          if (!selectArgs.cancel) {\n            _this.checkExtension(selectArgs.filesData[0]);\n            altText = selectArgs.filesData[0].name.replace(/\\.[a-zA-Z0-9]+$/, '');\n            if (_this.parent.editorMode === 'HTML' && isNOU(_this.parent.insertImageSettings.path)) {\n              var reader_1 = new FileReader();\n              // eslint-disable-next-line\n              reader_1.addEventListener('load', function (e) {\n                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result : URL.createObjectURL(convertToBlob(reader_1.result));\n                proxy.uploadUrl = {\n                  url: url,\n                  selection: save,\n                  altText: altText,\n                  selectParent: selectParent,\n                  width: {\n                    width: proxy.parent.insertImageSettings.width,\n                    minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                  },\n                  height: {\n                    height: proxy.parent.insertImageSettings.height,\n                    minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                  }\n                };\n                proxy.inputUrl.setAttribute('disabled', 'true');\n                if (!isNOU(_this.dialogObj)) {\n                  var button = _this.dialogObj.getButtons(0);\n                  if (!isNOU(button)) {\n                    if (isNOU(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes && selectArgs.filesData[0].size <= _this.uploadObj.maxFileSize) {\n                      button.element.removeAttribute('disabled');\n                    } else {\n                      button.element.setAttribute('disabled', 'true');\n                    }\n                  }\n                }\n              });\n              reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n            }\n          }\n        });\n      },\n      beforeUpload: function (args) {\n        _this.parent.trigger(events.beforeImageUpload, args);\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          _this.parent.trigger(events.imageUploading, e);\n        }\n      },\n      success: function (e) {\n        e.detectImageSource = ImageInputSource.Uploaded;\n        _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n          if (!isNOU(_this.parent.insertImageSettings.path)) {\n            var url = _this.parent.insertImageSettings.path + e.file.name;\n            // Update the URL of the previously uploaded image\n            if (!isNOU(previousFileInfo) && e.operation === 'upload') {\n              _this.uploadObj.remove(previousFileInfo);\n            }\n            // eslint-disable-next-line\n            var value = {\n              url: url,\n              selection: save\n            };\n            proxy.uploadUrl = {\n              url: url,\n              selection: save,\n              altText: altText,\n              selectParent: selectParent,\n              width: {\n                width: proxy.parent.insertImageSettings.width,\n                minWidth: proxy.parent.insertImageSettings.minWidth,\n                maxWidth: proxy.parent.getInsertImgMaxWidth()\n              },\n              height: {\n                height: proxy.parent.insertImageSettings.height,\n                minHeight: proxy.parent.insertImageSettings.minHeight,\n                maxHeight: proxy.parent.insertImageSettings.maxHeight\n              }\n            };\n            proxy.inputUrl.setAttribute('disabled', 'true');\n            previousFileInfo = e.file;\n          }\n          if (e.operation === 'upload' && !isNOU(_this.dialogObj)) {\n            _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n          }\n        });\n      },\n      failure: function (e) {\n        _this.parent.trigger(events.imageUploadFailed, e);\n      },\n      removing: function (removeEventArgs) {\n        // eslint-disable-next-line\n        _this.parent.trigger(events.imageRemoving, removeEventArgs, function (e) {\n          proxy.isImgUploaded = false;\n          _this.dialogObj.getButtons(0).element.disabled = true;\n          proxy.inputUrl.removeAttribute('disabled');\n          if (proxy.uploadUrl) {\n            proxy.uploadUrl.url = '';\n          }\n        });\n      }\n    });\n    this.uploadObj.isStringTemplate = true;\n    this.uploadObj.createElement = this.parent.createElement;\n    this.uploadObj.appendTo(uploadEle);\n    return uploadParentEle;\n  };\n  Image.prototype.checkExtension = function (e) {\n    if (this.uploadObj.allowedExtensions) {\n      if (e.type) {\n        if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n          this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n          this.isAllowedTypes = false;\n        } else {\n          this.isAllowedTypes = true;\n        }\n      }\n    }\n  };\n  Image.prototype.fileSelect = function () {\n    this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n    return false;\n  };\n  Image.prototype.dragStart = function (e) {\n    if (e.target.nodeName === 'IMG') {\n      this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n        if (actionBeginArgs.cancel) {\n          e.preventDefault();\n        } else {\n          e.dataTransfer.effectAllowed = 'copyMove';\n          e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n        }\n      });\n    } else {\n      return true;\n    }\n  };\n  Image.prototype.dragEnter = function (e) {\n    e.dataTransfer.dropEffect = 'copy';\n    e.preventDefault();\n  };\n  Image.prototype.dragOver = function (e) {\n    if (Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1 || Browser.isIE && e.dataTransfer.types[0] === 'Files') {\n      e.preventDefault();\n    } else {\n      return true;\n    }\n  };\n  /**\n   * Used to set range When drop an image\n   *\n   * @param {ImageDropEventArgs} args - specifies the image arguments.\n   * @returns {void}\n   */\n  Image.prototype.dragDrop = function (args) {\n    var _this = this;\n    this.parent.trigger(events.beforeImageDrop, args, function (e) {\n      var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n      var isImgOrFileDrop = imgElement && imgElement.tagName === 'IMG' || e.dataTransfer.files.length > 0;\n      if (!e.cancel && isImgOrFileDrop) {\n        if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') || _this.parent.inputElement.contentEditable === 'false') {\n          e.preventDefault();\n          return;\n        }\n        if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n          detach(_this.imgResizeDiv);\n        }\n        e.preventDefault();\n        var range = void 0;\n        if (_this.contentModule.getDocument().caretRangeFromPoint) {\n          //For chrome\n          range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n        } else if (e.rangeParent) {\n          //For mozilla firefox\n          range = _this.contentModule.getDocument().createRange();\n          range.setStart(e.rangeParent, e.rangeOffset);\n        } else {\n          range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n        }\n        _this.parent.notify(events.selectRange, {\n          range: range\n        });\n        var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n        if (uploadArea) {\n          return;\n        }\n        _this.insertDragImage(e);\n      } else {\n        if (isImgOrFileDrop) {\n          e.preventDefault();\n        }\n      }\n    });\n  };\n  /**\n   * Used to calculate range on internet explorer\n   *\n   * @param {number} x - specifies the x range.\n   * @param {number} y - specifies the y range.\n   * @returns {void}\n   */\n  Image.prototype.getDropRange = function (x, y) {\n    var startRange = this.contentModule.getDocument().createRange();\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n    var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n    var startNode = elem.childNodes.length > 0 ? elem.childNodes[0] : elem;\n    var startCharIndexCharacter = 0;\n    if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n      startRange.setStart(startNode, startCharIndexCharacter);\n      startRange.setEnd(startNode, startCharIndexCharacter);\n    } else {\n      var rangeRect = void 0;\n      do {\n        startCharIndexCharacter++;\n        startRange.setStart(startNode, startCharIndexCharacter);\n        startRange.setEnd(startNode, startCharIndexCharacter + 1);\n        rangeRect = startRange.getBoundingClientRect();\n      } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n    }\n    return startRange;\n  };\n  Image.prototype.insertDragImage = function (e) {\n    var _this = this;\n    e.preventDefault();\n    var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n    this.parent.notify(events.drop, {\n      args: e\n    });\n    if (activePopupElement) {\n      activePopupElement.classList.add(classes.CLS_HIDE);\n    }\n    var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n    var actionBeginArgs = {\n      requestType: 'Images',\n      name: 'ImageDragAndDrop',\n      cancel: false,\n      originalEvent: e\n    };\n    if (e.dataTransfer.files.length > 0 && imgElement === null) {\n      //For external image drag and drop\n      if (e.dataTransfer.files.length > 1) {\n        return;\n      }\n      var imgFiles_1 = e.dataTransfer.files;\n      var fileName = imgFiles_1[0].name;\n      var imgType = fileName.substring(fileName.lastIndexOf('.'));\n      var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n      for (var i = 0; i < allowedTypes.length; i++) {\n        if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n          if (this.parent.insertImageSettings.saveUrl) {\n            this.onSelect(e);\n          } else {\n            this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n              if (!actionBeginArgs.cancel) {\n                var args = {\n                  args: e,\n                  text: '',\n                  file: imgFiles_1[0]\n                };\n                e.preventDefault();\n                _this.imagePaste(args);\n              } else {\n                actionBeginArgs.originalEvent.preventDefault();\n              }\n            });\n          }\n        }\n      }\n    } else {\n      //For internal image drag and drop\n      this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n        if (!actionBeginArgs.cancel) {\n          var range = _this.parent.formatter.editorManager.nodeSelection.getRange(_this.parent.contentModule.getDocument());\n          if (imgElement && imgElement.tagName === 'IMG') {\n            if (imgElement.nextElementSibling) {\n              if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n                range.insertNode(imgElement.parentElement.parentElement);\n              } else {\n                range.insertNode(imgElement);\n              }\n            } else {\n              range.insertNode(imgElement);\n            }\n            imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n            var imgArgs_1 = {\n              elements: [imgElement]\n            };\n            imgElement.addEventListener('load', function () {\n              _this.parent.trigger(events.actionComplete, imgArgs_1);\n            });\n            _this.parent.formatter.editorManager.nodeSelection.Clear(_this.contentModule.getDocument());\n            var args = e;\n            _this.resizeStart(args, imgElement);\n            _this.hideImageQuickToolbar();\n          }\n        } else {\n          actionBeginArgs.originalEvent.preventDefault();\n        }\n      });\n    }\n  };\n  Image.prototype.onSelect = function (args) {\n    var _this = this;\n    // eslint-disable-next-line\n    var proxy = this;\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var parentElement = this.parent.createElement('ul', {\n      className: classes.CLS_UPLOAD_FILES\n    });\n    this.parent.rootContainer.appendChild(parentElement);\n    var validFiles = {\n      name: args.dataTransfer.files[0].name,\n      size: args.dataTransfer.files[0].size,\n      status: '',\n      statusCode: '',\n      type: args.dataTransfer.files[0].type,\n      rawFile: args.dataTransfer.files[0],\n      validationMessages: {}\n    };\n    var imageTag = this.parent.createElement('IMG');\n    imageTag.style.opacity = '0.5';\n    imageTag.classList.add(classes.CLS_RTE_IMAGE);\n    imageTag.classList.add(classes.CLS_IMGINLINE);\n    imageTag.classList.add(classes.CLS_RESIZE);\n    var file = validFiles.rawFile;\n    var reader = new FileReader();\n    reader.addEventListener('load', function () {\n      var url = URL.createObjectURL(convertToBlob(reader.result));\n      imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n    });\n    if (file) {\n      reader.readAsDataURL(file);\n    }\n    var selection = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n    var imageCommand = {\n      cssClass: this.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n      url: this.parent.insertImageSettings.path + file.name,\n      selection: selection,\n      altText: file.name.replace(/\\.[a-zA-Z0-9]+$/, ''),\n      width: {\n        width: this.parent.insertImageSettings.width,\n        minWidth: this.parent.insertImageSettings.minWidth,\n        maxWidth: this.parent.getInsertImgMaxWidth()\n      },\n      height: {\n        height: this.parent.insertImageSettings.height,\n        minHeight: this.parent.insertImageSettings.minHeight,\n        maxHeight: this.parent.insertImageSettings.maxHeight\n      }\n    };\n    var actionBeginArgs = {\n      requestType: 'Image',\n      name: 'ImageDragAndDrop',\n      cancel: false,\n      originalEvent: args,\n      itemCollection: imageCommand\n    };\n    this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n      if (!actionBeginArgs.cancel) {\n        var command = actionBeginArgs.itemCollection;\n        var image_1 = createElement('img', {\n          className: command.cssClass,\n          attrs: {\n            src: command.url,\n            alt: command.altText\n          }\n        });\n        image_1.style.opacity = '0.5';\n        image_1.classList.add(classes.CLS_RTE_IMAGE);\n        image_1.classList.add(classes.CLS_IMGINLINE);\n        image_1.classList.add(classes.CLS_RESIZE);\n        range.insertNode(image_1);\n        _this.uploadMethod(args, image_1);\n        image_1.addEventListener('load', function (e) {\n          var actionCompleteArgs = {\n            requestType: 'Image',\n            name: 'InsertDropImage',\n            elements: [image_1],\n            event: e,\n            editorMode: 'HTML'\n          };\n          _this.parent.trigger(events.actionComplete, actionCompleteArgs);\n        });\n        detach(parentElement);\n      } else {\n        actionBeginArgs.originalEvent.preventDefault();\n      }\n    });\n  };\n  /**\n   * Rendering uploader and popup for drag and drop\n   *\n   * @param {DragEvent} dragEvent - specifies the event.\n   * @param {HTMLImageElement} imageElement - specifies the element.\n   * @returns {void}\n   */\n  Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n    var _this = this;\n    var isUploading = false;\n    // eslint-disable-next-line\n    var proxy = this;\n    var popupEle = this.parent.createElement('div');\n    this.parent.rootContainer.appendChild(popupEle);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      }\n    });\n    var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n    this.popupObj = new Popup(popupEle, {\n      relateTo: imageElement,\n      height: '85px',\n      width: '300px',\n      offsetY: offsetY,\n      content: uploadEle,\n      viewPortElement: this.parent.element,\n      position: {\n        X: 'center',\n        Y: 'top'\n      },\n      enableRtl: this.parent.enableRtl,\n      zIndex: 10001,\n      // eslint-disable-next-line\n      close: function (event) {\n        _this.parent.isBlur = false;\n        _this.popupObj.destroy();\n        detach(_this.popupObj.element);\n        _this.popupObj = null;\n        if (!_this.parent.inlineMode.enable) {\n          _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n        }\n      }\n    });\n    this.popupObj.element.style.display = 'none';\n    addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n    addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n    if (!isNOU(this.parent.cssClass)) {\n      addClass([this.popupObj.element], this.parent.cssClass.replace(/\\s+/g, ' ').trim().split(' '));\n    }\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n    this.imageDragPopupTime = setTimeout(function () {\n      proxy.refreshPopup(imageElement);\n    }, timeOut);\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      cssClass: classes.CLS_RTE_DIALOG_UPLOAD + this.parent.getCssClass(true),\n      dropArea: this.parent.element,\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      removing: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n        _this.popupObj.close();\n      },\n      canceling: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n        _this.popupObj.close();\n        _this.quickToolObj.imageQTBar.hidePopup();\n        _this.uploadCancelTime = setTimeout(function () {\n          _this.uploadObj.destroy();\n        }, 900);\n      },\n      beforeUpload: function (args) {\n        _this.parent.trigger(events.beforeImageUpload, args);\n        if (!_this.parent.inlineMode.enable) {\n          _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n        }\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          isUploading = true;\n          _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n            if (imageUploadingArgs.cancel) {\n              if (!isNOU(imageElement)) {\n                detach(imageElement);\n              }\n              if (!isNOU(_this.popupObj.element)) {\n                detach(_this.popupObj.element);\n              }\n            } else {\n              _this.parent.inputElement.contentEditable = 'false';\n            }\n          });\n        }\n      },\n      selected: function (e) {\n        if (isUploading) {\n          e.cancel = true;\n        }\n      },\n      failure: function (e) {\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        _this.uploadFailureTime = setTimeout(function () {\n          _this.uploadFailure(imageElement, args, e);\n        }, 900);\n      },\n      success: function (e) {\n        if (e.operation === 'cancel') {\n          return;\n        }\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        _this.uploadSuccessTime = setTimeout(function () {\n          _this.uploadSuccess(imageElement, dragEvent, args, e);\n        }, 900);\n      }\n    });\n    this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n    this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n    range.selectNodeContents(imageElement);\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n  };\n  Image.prototype.refreshPopup = function (imageElement) {\n    var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop + imageElement.offsetTop : imageElement.offsetTop;\n    var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n    if (imgPosition > rtePosition) {\n      this.popupObj.relateTo = this.parent.inputElement;\n      this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n      this.popupObj.element.style.display = 'block';\n    } else {\n      if (this.popupObj) {\n        this.popupObj.refreshPosition(imageElement);\n        this.popupObj.element.style.display = 'block';\n      }\n    }\n  };\n  /**\n   * Called when drop image upload was failed\n   *\n   * @param {HTMLElement} imgEle - specifies the image element.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {Object} e - specfies the object.\n   * @returns {void}\n   */\n  Image.prototype.uploadFailure = function (imgEle, args, e) {\n    detach(imgEle);\n    if (this.popupObj) {\n      this.popupObj.close();\n    }\n    this.parent.trigger(events.imageUploadFailed, e);\n    this.uploadObj.destroy();\n  };\n  /**\n   * Called when drop image upload was successful\n   *\n   * @param {HTMLElement} imageElement - specifies the image element.\n   * @param {DragEvent} dragEvent - specifies the drag event.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {ImageSuccessEventArgs} e - specifies the success event.\n   * @returns {void}\n   */\n  Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n    var _this = this;\n    imageElement.style.opacity = '1';\n    imageElement.classList.add(classes.CLS_IMG_FOCUS);\n    e.element = imageElement;\n    e.detectImageSource = ImageInputSource.Dropped;\n    this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n      if (!isNOU(_this.parent.insertImageSettings.path)) {\n        var url = _this.parent.insertImageSettings.path + e.file.name;\n        imageElement.src = url;\n        imageElement.setAttribute('alt', e.file.name);\n      }\n    });\n    if (this.popupObj) {\n      this.popupObj.close();\n      this.uploadObj.destroy();\n    }\n    this.showImageQuickToolbar(args);\n    this.resizeStart(dragEvent, imageElement);\n  };\n  Image.prototype.imagePaste = function (args) {\n    var _this = this;\n    if (args.text.length === 0 && !isNOU(args.file)) {\n      // eslint-disable-next-line\n      var proxy_1 = this;\n      var reader_2 = new FileReader();\n      args.args.preventDefault();\n      // eslint-disable-next-line\n      reader_2.addEventListener('load', function (e) {\n        var url = {\n          cssClass: proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n          url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNOU(args.callBack) ? reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n          width: {\n            width: proxy_1.parent.insertImageSettings.width,\n            minWidth: proxy_1.parent.insertImageSettings.minWidth,\n            maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n          },\n          height: {\n            height: proxy_1.parent.insertImageSettings.height,\n            minHeight: proxy_1.parent.insertImageSettings.minHeight,\n            maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n          }\n        };\n        if (!isNOU(args.callBack)) {\n          args.callBack(url);\n          return;\n        } else {\n          proxy_1.parent.formatter.process(proxy_1.parent, {\n            item: {\n              command: 'Images',\n              subCommand: 'Image'\n            }\n          }, args.args, url);\n          _this.showPopupToolBar(args, url);\n        }\n      });\n      reader_2.readAsDataURL(args.file);\n    }\n  };\n  Image.prototype.showPopupToolBar = function (e, url) {\n    var _this = this;\n    var imageSrc = 'img[src=\"' + url.url + '\"]';\n    var imageElement = this.parent.inputElement.querySelector(imageSrc);\n    this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n    var args = {\n      args: e.args,\n      type: 'Images',\n      isNotify: undefined,\n      elements: imageElement\n    };\n    if (imageElement) {\n      this.showImageQTbarTime = setTimeout(function () {\n        _this.showImageQuickToolbar(args);\n        if (_this.parent.insertImageSettings.resize) {\n          _this.resizeStart(e.args, imageElement);\n        }\n      }, 0);\n    }\n  };\n  /* eslint-disable */\n  /**\n   * Destroys the ToolBar.\n   *\n   * @method destroy\n   * @returns {void}\n   * @hidden\n    */\n  /* eslint-enable */\n  Image.prototype.destroy = function () {\n    if (this.isDestroyed) {\n      return;\n    }\n    this.prevSelectedImgEle = undefined;\n    if (!isNOU(this.imageQTPopupTime)) {\n      clearTimeout(this.imageQTPopupTime);\n      this.imageQTPopupTime = null;\n    }\n    if (!isNOU(this.imageDragPopupTime)) {\n      clearTimeout(this.imageDragPopupTime);\n      this.imageDragPopupTime = null;\n    }\n    if (!isNOU(this.uploadCancelTime)) {\n      clearTimeout(this.uploadCancelTime);\n      this.uploadCancelTime = null;\n    }\n    if (!isNOU(this.uploadFailureTime)) {\n      clearTimeout(this.uploadFailureTime);\n      this.uploadFailureTime = null;\n    }\n    if (!isNOU(this.showImageQTbarTime)) {\n      clearTimeout(this.showImageQTbarTime);\n      this.showImageQTbarTime = null;\n    }\n    if (!isNOU(this.uploadSuccessTime)) {\n      clearTimeout(this.uploadSuccessTime);\n      this.uploadSuccessTime = null;\n    }\n    this.removeEventListener();\n    this.clearDialogObj();\n    this.cancelResizeAction();\n    this.isDestroyed = true;\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {void}\n   */\n  Image.prototype.getModuleName = function () {\n    return 'image';\n  };\n  return Image;\n}();\nexport { Image };","map":{"version":3,"names":["addClass","detach","EventHandler","select","formatUnit","createElement","Browser","closest","removeClass","isNullOrUndefined","isNOU","events","classes","Uploader","TextBox","Popup","Button","CheckBox","RenderType","ImageInputSource","dispatchEvent","parseHtml","hasClass","convertToBlob","isIDevice","imageResizeFactor","Image","parent","serviceLocator","isImgUploaded","isAllowedTypes","pageX","pageY","deletedImg","rteID","element","id","i10n","getService","rendererFactory","dialogRenderObj","addEventListener","drop","dragDrop","bind","drag","dragOver","enter","dragEnter","start","dragStart","docClick","onDocumentClick","isDestroyed","prototype","on","keyDown","onKeyDown","keyUp","onKeyUp","insertImage","showImageDialog","showDialog","closeImageDialog","closeDialog","windowResize","onWindowResize","insertCompleted","showImageQuickToolbar","clearDialogObj","imageToolbarAction","onToolbarAction","imageCaption","caption","imageDelete","deleteImg","imageLink","insertImgLink","imageAlt","insertAltText","editAreaClick","editAreaClickHandler","iframeMouseDown","onIframeMouseDown","imageSize","dropDownSelect","alignmentSelect","initialEnd","afterRender","dynamicModule","paste","imagePaste","bindCssClass","setCssClass","destroy","removeEventListener","off","dropElement","iframeSettings","enable","inputElement","ownerDocument","contentModule","remove","getEditPanel","touchEndEvent","imageClick","formatter","editorManager","observer","checkUndo","undoStack","insertImageSettings","resize","touchStartEvent","resizeStart","onCutHandler","getDocument","touchMoveEvent","resizing","updateCss","currentObj","e","cssClass","oldCssClass","setProperties","trim","replace","popupObj","checkBoxObj","widthNum","heightNum","uploadObj","dialogObj","hide","returnValue","getRenderer","Content","add","args","subCommand","toLowerCase","editorMode","i","getUndoRedoStack","length","temp","contentElem","text","appendChild","cloneNode","img","querySelectorAll","querySelector","j","style","outline","clonedElement","fragment","document","createDocumentFragment","firstChild","resizeEnd","resizeBtnInit","imgEle","parentElement","cursor","isDevice","target","event","requestType","trigger","resizeStop","saveData","ele","_this","readonly","prevSelectedImgEle","tagName","preventDefaultResize","imgResizeDiv","contains","imageResize","classList","screenX","screenY","getPointX","getPointY","preventDefault","stopImmediatePropagation","quickToolObj","imageQTBar","hidePopup","handlers","handler","resizeBtnStat","currentResizeHandler","aspectRatio","findAspectRatio","resizeStartArgs","cancel","cancelResizeAction","setAttribute","focus","className","getCssClass","styles","imgResizePos","resizeImgDupPos","touches","pos","calcPos","top","left","imgWid","getBoundingClientRect","width","imgHgt","height","borWid","parseInt","slice","devWid","elem","ignoreOffset","parentOffset","elementOffset","doc","offsetParent","indexOf","getID","documentElement","body","position","parentNode","nodeType","offsetTop","offsetLeft","setAspectRatio","expectedX","expectedY","sameHeightWidth","factor","resizeByPercent","emptyStyleDimension","setImageWidth","removeImageHeight","setImageHeight","value","suffix","getImageDimension","toString","removeAttribute","rootElem","pixToPerc","adjustDimensionsByAspectRatio","isWidthPrimary","Math","round","expected","parentEle","parseFloat","getComputedStyle","imgDupMouseMove","onResize","resizingArgs","minWidth","getInsertImgMaxWidth","minHeight","maxHeight","botRight","botLeft","topRight","topLeft","resizeFactor","getResizeFactor","currentScreenX","currentScreenY","currentWidth","clientWidth","currentHeight","clientHeight","deltaX","deltaY","dimensions","adjustDimensions","autoResize","diffX","diffY","image","imgDupPos","notify","selectionRestore","item","fileManagerSettings","renderFileManager","openImgLink","editImgLink","removeImgLink","sanitizedHTML","htmlEditorModule","sanitizeHelper","selectParent","outerHTML","tempEle","innerHTML","process","url","href","selectNode","selectParentEle","linkUpdate","getConstant","inputDetails","header","btnText","isIE","selection","restore","isCapLink","captionEle","insertElement","originalEvent","range","save","selectNodeEle","isCursor","keyCodeValues","nodeSelection","getRange","startContainer","endContainer","startOffset","endOffset","which","nodes","getNodeCollection","nodeName","push","code","isCursor_1","checkImageBack","checkImageDel","getParentNodeCollection","ctrlKey","key","action","removeResizeEle","keyCode","event_1","command","close","previousElementSibling","CLS_CAPTION","CLS_CAPINLINE","nextElementSibling","textContent","CLS_IMGBREAK","parentElem","brElem","openDialog","handleSelectAll","imgFocusNodes","CLS_IMG_FOCUS","isInternal","name","member","markdownSelection","getSelectedText","module","deleteImages","Array","from","src","getAttribute","afterImageDelete","splice","previousSibling","childNodes","nextSibling","alignImage","inline","break","imageWithLinkQTBarItemUpdate","items","toolbarElement","display","newItems","addQTBarItem","type","quickToolbarModule","elements","forEach","call","index","window","pageYOffset","clientY","isNotify","imageQTPopupTime","setTimeout","Clear","setSelectionContents","showPopup","coordinates","hideImageQuickToolbar","showOnRightClick","quickToolbarSettings","isPopupOpen","selectionSave","separator","imagDialog","linkWrap","linkUrl","content","linkTarget","inputLink","linkOpenLabel","label","checked","enableRtl","change","target_1","isStringTemplate","appendTo","imageLabel","linkargs_1","selfImage","link","ariaLabel","localeObj","buttons","click","insertlink","buttonModel","isPrimary","altText","altWrap","altHeader","getAlt","inputAlt","altArgs_1","alt","insertAlt","setSelectionRange","isUrl","proxy","regExp","RegExp","regexp","test","restoreStartElement","lastNode","lastChild","setCursorPoint","firstNode","captionClass","CLS_RTE_CAPTION","attrs","contenteditable","draggable","imgWrap","imgInner","parent_1","imgCaption","CLS_IMGINLINE","CLS_IMGLEFT","CLS_IMGRIGHT","CLS_IMGCENTER","setSelectionText","imgSizeHeader","dialogContent","imgsizeInput","selectObj_1","insertSize","browseButton","imgDialog","rootContainer","imgInsert","imglinkCancel","imgHeader","selectObj","dialogModel","CLS_RTE_ELEMENTS","locale","showCloseIcon","closeOnEscape","isModal","insertImageUrl","disabled","cancelDialog","animationSettings","effect","closedBy","filesData","isBlur","path","imgUpload","linkHeader","linkHeaderText","imageUrlPopup","render","inlineQTBar","textQTBar","currentTarget","toolbarSettings","getToolbarElement","offsetX","offsetY","documentClickClosedBy","inlineMode","imgUrl","placeUrl","inputUrl","placeholder","spellcheck","getButtons","regex","match","previousSubCommand","uploadUrl","getPanel","matchUrl","maxWidth","imgHeight","imgWidth","imgSizeWrap","widthVal","changedWidthValue","getClientRects","heightVal","changedHeightValue","getElementById","input","inputWidthValue","inputValue","inputHeightValue","dialogEle","iframe","uploadParentEle","deviceImgUpMsg","imgUpMsg","span","spanMsg","btnEle","autofocus","browserMsg","btnClick","fileSelect","uploadEle","selectArgs","previousFileInfo","asyncSettings","saveUrl","removeUrl","dropArea","multiple","allowedExtensions","allowedTypes","selected","imageSelected","checkExtension","reader_1","FileReader","saveFormat","result","URL","createObjectURL","button","size","maxFileSize","readAsDataURL","rawFile","beforeUpload","beforeImageUpload","uploading","isServerRendered","imageUploading","success","detectImageSource","Uploaded","imageUploadSuccess","file","operation","failure","imageUploadFailed","removing","removeEventArgs","imageRemoving","toLocaleLowerCase","getElementsByClassName","actionBegin","actionBeginArgs","dataTransfer","effectAllowed","CLS_RTE_DRAG_IMAGE","dropEffect","info","split","types","beforeImageDrop","imgElement","isImgOrFileDrop","files","contentEditable","CLS_IMG_RESIZE","caretRangeFromPoint","clientX","rangeParent","createRange","setStart","rangeOffset","getDropRange","selectRange","uploadArea","CLS_DROPAREA","insertDragImage","x","y","startRange","setRange","elementFromPoint","startNode","startCharIndexCharacter","setEnd","rangeRect","activePopupElement","CLS_POPUP_OPEN","CLS_HIDE","imgFiles_1","fileName","imgType","substring","lastIndexOf","onSelect","CLS_IMG_INNER","insertNode","imgArgs_1","actionComplete","CLS_UPLOAD_FILES","validFiles","status","statusCode","validationMessages","imageTag","opacity","CLS_RTE_IMAGE","CLS_RESIZE","reader","imageCommand","itemCollection","image_1","uploadMethod","actionCompleteArgs","dragEvent","imageElement","isUploading","popupEle","relateTo","viewPortElement","X","Y","zIndex","toolbarModule","baseToolbar","toolbarObj","disable","CLS_RTE_UPLOAD_POPUP","timeOut","imageDragPopupTime","refreshPopup","CLS_RTE_DIALOG_UPLOAD","canceling","uploadCancelTime","imageUploadingArgs","undefined","uploadFailureTime","uploadFailure","uploadSuccessTime","uploadSuccess","selectNodeContents","imgPosition","rtePosition","offsetHeight","refreshPosition","Dropped","proxy_1","reader_2","callBack","showPopupToolBar","imageSrc","createQTBar","ImageToolbar","showImageQTbarTime","clearTimeout","getModuleName"],"sources":["/var/www/vue/vue-gantt-chart/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/renderer/image-module.js"],"sourcesContent":["import { addClass, detach, EventHandler, select, formatUnit, createElement } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType, ImageInputSource } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\nimport { imageResizeFactor } from '../../common/config';\n/**\n * `Image` module is used to handle image actions.\n */\nvar Image = /** @class */ (function () {\n    function Image(parent, serviceLocator) {\n        this.isImgUploaded = false;\n        this.isAllowedTypes = true;\n        this.pageX = null;\n        this.pageY = null;\n        this.deletedImg = [];\n        this.parent = parent;\n        this.rteID = parent.element.id;\n        this.i10n = serviceLocator.getService('rteLocale');\n        this.rendererFactory = serviceLocator.getService('rendererFactory');\n        this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n        this.addEventListener();\n        this.drop = this.dragDrop.bind(this);\n        this.drag = this.dragOver.bind(this);\n        this.enter = this.dragEnter.bind(this);\n        this.start = this.dragStart.bind(this);\n        this.docClick = this.onDocumentClick.bind(this);\n        this.isDestroyed = false;\n    }\n    Image.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.keyDown, this.onKeyDown, this);\n        this.parent.on(events.keyUp, this.onKeyUp, this);\n        this.parent.on(events.insertImage, this.insertImage, this);\n        this.parent.on(events.showImageDialog, this.showDialog, this);\n        this.parent.on(events.closeImageDialog, this.closeDialog, this);\n        this.parent.on(events.windowResize, this.onWindowResize, this);\n        this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n        this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n        this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n        this.parent.on(events.imageCaption, this.caption, this);\n        this.parent.on(events.imageDelete, this.deleteImg, this);\n        this.parent.on(events.imageLink, this.insertImgLink, this);\n        this.parent.on(events.imageAlt, this.insertAltText, this);\n        this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n        this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n        this.parent.on(events.imageSize, this.imageSize, this);\n        this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n        this.parent.on(events.initialEnd, this.afterRender, this);\n        this.parent.on(events.dynamicModule, this.afterRender, this);\n        this.parent.on(events.paste, this.imagePaste, this);\n        this.parent.on(events.bindCssClass, this.setCssClass, this);\n        this.parent.on(events.destroy, this.destroy, this);\n    };\n    Image.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.keyDown, this.onKeyDown);\n        this.parent.off(events.keyUp, this.onKeyUp);\n        this.parent.off(events.windowResize, this.onWindowResize);\n        this.parent.off(events.insertImage, this.insertImage);\n        this.parent.off(events.showImageDialog, this.showDialog);\n        this.parent.off(events.closeImageDialog, this.closeDialog);\n        this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n        this.parent.off(events.clearDialogObj, this.clearDialogObj);\n        this.parent.off(events.imageCaption, this.caption);\n        this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n        this.parent.off(events.imageDelete, this.deleteImg);\n        this.parent.off(events.imageLink, this.insertImgLink);\n        this.parent.off(events.imageAlt, this.insertAltText);\n        this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n        this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n        this.parent.off(events.imageSize, this.imageSize);\n        this.parent.off(events.dropDownSelect, this.alignmentSelect);\n        this.parent.off(events.initialEnd, this.afterRender);\n        this.parent.off(events.dynamicModule, this.afterRender);\n        this.parent.off(events.paste, this.imagePaste);\n        this.parent.off(events.bindCssClass, this.setCssClass);\n        this.parent.off(events.destroy, this.destroy);\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument\n            : this.parent.inputElement;\n        dropElement.removeEventListener('drop', this.drop, true);\n        dropElement.removeEventListener('dragstart', this.drag, true);\n        dropElement.removeEventListener('dragenter', this.enter, true);\n        dropElement.removeEventListener('dragover', this.start, true);\n        this.drop = null;\n        this.drag = null;\n        this.enter = null;\n        this.start = null;\n        if (!isNOU(this.contentModule)) {\n            EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n            this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n            if (this.parent.insertImageSettings.resize) {\n                EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n                this.parent.element.ownerDocument.removeEventListener('mousedown', this.docClick);\n                this.docClick = null;\n                EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n                EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n            }\n        }\n    };\n    Image.prototype.updateCss = function (currentObj, e) {\n        if (currentObj && e.cssClass) {\n            if (isNOU(e.oldCssClass)) {\n                currentObj.setProperties({ cssClass: (currentObj.cssClass + ' ' + e.cssClass).trim() });\n            }\n            else {\n                currentObj.setProperties({ cssClass: (currentObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim() });\n            }\n        }\n    };\n    // eslint-disable-next-line @typescript-eslint/tslint/config\n    Image.prototype.setCssClass = function (e) {\n        if (this.popupObj && e.cssClass) {\n            if (isNOU(e.oldCssClass)) {\n                addClass([this.popupObj.element], e.cssClass);\n            }\n            else {\n                removeClass([this.popupObj.element], e.oldCssClass);\n                addClass([this.popupObj.element], e.cssClass);\n            }\n        }\n        this.updateCss(this.checkBoxObj, e);\n        this.updateCss(this.widthNum, e);\n        this.updateCss(this.heightNum, e);\n        this.updateCss(this.uploadObj, e);\n        this.updateCss(this.dialogObj, e);\n    };\n    Image.prototype.onIframeMouseDown = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    Image.prototype.afterRender = function () {\n        this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n        EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n        if (this.parent.insertImageSettings.resize) {\n            EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n            this.parent.element.ownerDocument.addEventListener('mousedown', this.docClick);\n            EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n        }\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument :\n            this.parent.inputElement;\n        dropElement.addEventListener('drop', this.drop, true);\n        dropElement.addEventListener('dragstart', this.drag, true);\n        dropElement.addEventListener('dragenter', this.enter, true);\n        dropElement.addEventListener('dragover', this.start, true);\n    };\n    Image.prototype.undoStack = function (args) {\n        if ((args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') && this.parent.editorMode === 'HTML') {\n            for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n                var temp = this.parent.createElement('div');\n                var contentElem = this.parent.formatter.getUndoRedoStack()[i].text;\n                temp.appendChild(contentElem.cloneNode(true));\n                var img = temp.querySelectorAll('img');\n                if (temp.querySelector('.e-img-resize') && img.length > 0) {\n                    for (var j = 0; j < img.length; j++) {\n                        img[j].style.outline = '';\n                    }\n                    detach(temp.querySelector('.e-img-resize'));\n                    var clonedElement = temp.cloneNode(true);\n                    var fragment = document.createDocumentFragment();\n                    while (clonedElement.firstChild) {\n                        fragment.appendChild(clonedElement.firstChild);\n                    }\n                    this.parent.formatter.getUndoRedoStack()[i].text = fragment;\n                }\n            }\n        }\n    };\n    Image.prototype.resizeEnd = function (e) {\n        this.resizeBtnInit();\n        if (this.imgEle.parentElement) {\n            this.imgEle.parentElement.style.cursor = 'auto';\n        }\n        if (Browser.isDevice) {\n            removeClass([e.target.parentElement], 'e-mob-span');\n        }\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.resizeStop, args);\n        this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n        this.parent.formatter.saveData();\n    };\n    Image.prototype.resizeStart = function (e, ele) {\n        var _this = this;\n        if (this.parent.readonly) {\n            return;\n        }\n        var target = ele ? ele : e.target;\n        this.prevSelectedImgEle = this.imgEle;\n        if (target.tagName === 'IMG') {\n            this.parent.preventDefaultResize(e);\n            var img = target;\n            if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n                detach(this.imgResizeDiv);\n            }\n            this.imageResize(img);\n        }\n        if (target.classList.contains('e-rte-imageboxmark')) {\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            if (this.parent.iframeSettings.enable) {\n                this.pageX = e.screenX;\n                this.pageY = e.screenY;\n            }\n            else {\n                this.pageX = this.getPointX(e);\n                this.pageY = this.getPointY(e);\n            }\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            this.resizeBtnInit();\n            if (this.quickToolObj) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n            var handlers = ['topLeft', 'topRight', 'botLeft', 'botRight'];\n            for (var i = 0; i < handlers.length; i++) {\n                var handler = handlers[i];\n                if (target.classList.contains('e-rte-' + handler)) {\n                    this.resizeBtnStat[handler] = true;\n                    this.currentResizeHandler = handler;\n                    this.aspectRatio = this.findAspectRatio(this.imgEle);\n                    break; // Exit the loop once a match is found\n                }\n            }\n            if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) &&\n                !this.imgResizeDiv.classList.contains('e-mob-span')) {\n                addClass([this.imgResizeDiv], 'e-mob-span');\n            }\n            else {\n                var args = { event: e, requestType: 'images' };\n                this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n                    if (resizeStartArgs.cancel) {\n                        _this.cancelResizeAction();\n                    }\n                });\n            }\n            EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n            EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n        }\n    };\n    Image.prototype.imageClick = function (e) {\n        if (Browser.isDevice) {\n            if ((e.target.tagName === 'IMG' &&\n                e.target.parentElement.tagName === 'A') ||\n                (e.target.tagName === 'IMG')) {\n                this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n                e.target.focus();\n            }\n            else {\n                if (!this.parent.readonly) {\n                    this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n                }\n            }\n        }\n        if (e.target.tagName === 'IMG' &&\n            e.target.parentElement.tagName === 'A') {\n            e.preventDefault();\n        }\n    };\n    Image.prototype.onCutHandler = function () {\n        if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n    };\n    Image.prototype.imageResize = function (e) {\n        this.resizeBtnInit();\n        this.imgEle = e;\n        addClass([this.imgEle], 'e-resize');\n        this.imgResizeDiv = this.parent.createElement('span', { className: 'e-img-resize' + this.parent.getCssClass(true), id: this.rteID + '_imgResize' });\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topLeft' + this.parent.getCssClass(true), styles: 'cursor: nwse-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topRight' + this.parent.getCssClass(true), styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botLeft' + this.parent.getCssClass(true), styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botRight' + this.parent.getCssClass(true), styles: 'cursor: nwse-resize'\n        }));\n        if (Browser.isDevice) {\n            addClass([this.imgResizeDiv], 'e-mob-rte');\n        }\n        e.style.outline = '2px solid #4a90e2';\n        this.imgResizePos(e, this.imgResizeDiv);\n        this.resizeImgDupPos(e);\n        this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n    };\n    Image.prototype.getPointX = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageX;\n        }\n        else {\n            return e.pageX;\n        }\n    };\n    Image.prototype.getPointY = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageY;\n        }\n        else {\n            return e.pageY;\n        }\n    };\n    Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n        var pos = this.calcPos(e);\n        var top = pos.top;\n        var left = pos.left;\n        var imgWid = e.getBoundingClientRect().width;\n        var imgHgt = e.getBoundingClientRect().height;\n        var borWid = (Browser.isDevice) ? (4 * parseInt((e.style.outline.slice(-3)), 10)) + 2 :\n            (2 * parseInt((e.style.outline.slice(-3)), 10)) + 2; //span border width + image outline width\n        var devWid = ((Browser.isDevice) ? 0 : 2); // span border width\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.top = (top - (borWid)) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.top = (top - borWid) + 'px';\n    };\n    Image.prototype.calcPos = function (elem) {\n        var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n        var parentOffset = { top: 0, left: 0 };\n        var elementOffset;\n        var doc = elem.ownerDocument;\n        var offsetParent = ((elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') ||\n            ignoreOffset.indexOf(elem.offsetParent.tagName) > -1)) ?\n            closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n        while (offsetParent &&\n            (offsetParent === doc.body || offsetParent === doc.documentElement) &&\n            offsetParent.style.position === 'static') {\n            offsetParent = offsetParent.parentNode;\n        }\n        if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n            parentOffset = offsetParent.getBoundingClientRect();\n        }\n        if (elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption'))) {\n            elementOffset = elem.getBoundingClientRect();\n            return {\n                top: elementOffset.top - parentOffset.top,\n                left: elementOffset.left - parentOffset.left\n            };\n        }\n        else {\n            return {\n                top: elem.offsetTop,\n                left: elem.offsetLeft\n            };\n        }\n    };\n    Image.prototype.setAspectRatio = function (img, expectedX, expectedY) {\n        if (isNOU(img.width)) {\n            return;\n        }\n        var width = img.width;\n        var height = img.height;\n        var sameHeightWidth = (width === height);\n        var factor = this.parent.insertImageSettings.resizeByPercent ? '%' : 'px';\n        var emptyStyleDimension = (img.style.width === '' && img.style.height === '');\n        if (!sameHeightWidth && !emptyStyleDimension) {\n            if (img.style.width !== '' && img.style.height !== '') {\n                if (this.parent.insertImageSettings.resizeByPercent) {\n                    this.setImageWidth(img, expectedX, factor);\n                    this.removeImageHeight(img);\n                }\n                else {\n                    this.setImageWidth(img, expectedX, factor);\n                    this.setImageHeight(img, expectedY, factor);\n                }\n            }\n            else if (img.style.width !== '') {\n                if (this.parent.insertImageSettings.resizeByPercent) {\n                    this.setImageWidth(img, expectedX, factor);\n                    this.removeImageHeight(img);\n                }\n                else {\n                    this.setImageWidth(img, expectedX, factor);\n                }\n            }\n            else if (img.style.height !== '') {\n                if (this.parent.insertImageSettings.resizeByPercent) {\n                    this.setImageWidth(img, expectedX, factor);\n                    this.removeImageHeight(img);\n                }\n                else {\n                    this.setImageHeight(img, expectedY, factor);\n                }\n            }\n        }\n        else {\n            this.setImageWidth(img, expectedX, factor);\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                this.removeImageHeight(img);\n            }\n            else {\n                this.setImageHeight(img, expectedY, factor);\n            }\n        }\n    };\n    Image.prototype.setImageWidth = function (img, value, suffix) {\n        img.style.width = this.getImageDimension(value, img) + suffix;\n        if (!this.parent.insertImageSettings.resizeByPercent) {\n            img.setAttribute('width', value.toString());\n        }\n    };\n    Image.prototype.setImageHeight = function (img, value, suffix) {\n        img.style.height = this.getImageDimension(value, img) + suffix;\n        if (!this.parent.insertImageSettings.resizeByPercent) {\n            img.setAttribute('height', value.toString());\n        }\n    };\n    Image.prototype.removeImageHeight = function (img) {\n        img.style.height = '';\n        img.removeAttribute('height');\n    };\n    Image.prototype.getImageDimension = function (value, img) {\n        if (this.parent.insertImageSettings.resizeByPercent) {\n            var rootElem = img.parentElement;\n            return this.pixToPerc(value, rootElem);\n        }\n        else {\n            return value;\n        }\n    };\n    Image.prototype.adjustDimensionsByAspectRatio = function (width, height, aspectRatio, isWidthPrimary) {\n        if (isWidthPrimary) {\n            height = Math.round(width / aspectRatio);\n            width = Math.round(height * aspectRatio);\n        }\n        else {\n            width = Math.round(height * aspectRatio);\n            height = Math.round(width / aspectRatio);\n        }\n        return { width: width, height: height };\n    };\n    Image.prototype.pixToPerc = function (expected, parentEle) {\n        return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n    };\n    Image.prototype.imgDupMouseMove = function (width, height, e) {\n        var _this = this;\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.onResize, args, function (resizingArgs) {\n            if (resizingArgs.cancel) {\n                _this.cancelResizeAction();\n            }\n            else {\n                if ((parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) ||\n                    (parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) &&\n                        isNOU(_this.imgEle.style.width)))) {\n                    return;\n                }\n                if (!_this.parent.insertImageSettings.resizeByPercent &&\n                    (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) ||\n                        parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n                    return;\n                }\n                _this.imgEle.parentElement.style.cursor = 'pointer';\n                _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10));\n                _this.resizeImgDupPos(_this.imgEle);\n                _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n            }\n        });\n    };\n    Image.prototype.resizing = function (e) {\n        if (!this.parent) {\n            this.cancelResizeAction();\n            return;\n        }\n        if (this.resizeBtnStat.botRight || this.resizeBtnStat.botLeft || this.resizeBtnStat.topRight || this.resizeBtnStat.topLeft) {\n            if (this.parent.iframeSettings.enable) {\n                var resizeFactor = this.getResizeFactor(this.currentResizeHandler);\n                var currentScreenX = e.screenX;\n                var currentScreenY = e.screenY;\n                var currentWidth = this.imgEle.clientWidth;\n                var currentHeight = this.imgEle.clientHeight;\n                var deltaX = currentScreenX - this.pageX;\n                var deltaY = currentScreenY - this.pageY;\n                var width = deltaX * resizeFactor[0] + currentWidth;\n                var height = deltaY * resizeFactor[1] + currentHeight;\n                var dimensions = this.adjustDimensions(width, height, deltaX, deltaY, this.aspectRatio);\n                this.pageX = currentScreenX;\n                this.pageY = currentScreenY;\n                this.imgDupMouseMove(dimensions.width + 'px', dimensions.height + 'px', e);\n                this.parent.autoResize();\n            }\n            else {\n                var pageX = this.getPointX(e);\n                var pageY = this.getPointY(e);\n                var resizeFactor = this.getResizeFactor(this.currentResizeHandler);\n                var diffX = (pageX - this.pageX);\n                var diffY = (pageY - this.pageY);\n                var currentWidth = this.imgEle.clientWidth;\n                var currentHeight = this.imgEle.clientHeight;\n                var width = diffX * resizeFactor[0] + currentWidth;\n                var height = diffY * resizeFactor[1] + currentHeight;\n                var dimensions = this.adjustDimensions(width, height, diffX, diffY, this.aspectRatio);\n                this.pageX = pageX;\n                this.pageY = pageY;\n                this.imgDupMouseMove(dimensions.width + 'px', dimensions.height + 'px', e);\n            }\n        }\n    };\n    Image.prototype.adjustDimensions = function (width, height, diffX, diffY, aspectRatio) {\n        width = (width < 16) ? 16 : width;\n        height = (height < 16) ? 16 : height;\n        var isWidthPrimary = width > height;\n        var dimensions = this.adjustDimensionsByAspectRatio(width, height, aspectRatio, isWidthPrimary);\n        return dimensions;\n    };\n    Image.prototype.getResizeFactor = function (value) {\n        return imageResizeFactor[value];\n    };\n    Image.prototype.findAspectRatio = function (image) {\n        return image.clientWidth / image.clientHeight;\n    };\n    Image.prototype.cancelResizeAction = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            detach(this.imgResizeDiv);\n            this.imgEle.style.outline = '';\n            this.imgResizeDiv = null;\n            this.pageX = null;\n            this.pageY = null;\n            this.currentResizeHandler = null;\n            this.aspectRatio = null;\n        }\n    };\n    Image.prototype.resizeImgDupPos = function (e) {\n        this.imgDupPos = {\n            width: (e.style.width !== '' && (this.parent.insertImageSettings &&\n                !this.parent.insertImageSettings.resizeByPercent)) ? this.imgEle.style.width : e.width + 'px',\n            height: (e.style.height !== '') ? this.imgEle.style.height : e.height + 'px'\n        };\n    };\n    Image.prototype.resizeBtnInit = function () {\n        this.aspectRatio = null;\n        this.currentResizeHandler = null;\n        return this.resizeBtnStat = { botLeft: false, botRight: false, topRight: false, topLeft: false };\n    };\n    Image.prototype.onToolbarAction = function (args) {\n        if (isIDevice()) {\n            this.parent.notify(events.selectionRestore, {});\n        }\n        var item = args.args.item;\n        switch (item.subCommand) {\n            case 'Replace':\n                if (this.parent.fileManagerSettings.enable) {\n                    this.parent.notify(events.renderFileManager, args);\n                }\n                else {\n                    this.parent.notify(events.insertImage, args);\n                }\n                break;\n            case 'Caption':\n                this.parent.notify(events.imageCaption, args);\n                break;\n            case 'InsertLink':\n                this.parent.notify(events.imageLink, args);\n                break;\n            case 'AltText':\n                this.parent.notify(events.imageAlt, args);\n                break;\n            case 'Remove':\n                this.parent.notify(events.imageDelete, args);\n                break;\n            case 'Dimension':\n                this.parent.notify(events.imageSize, args);\n                break;\n            case 'OpenImageLink':\n                this.openImgLink(args);\n                break;\n            case 'EditImageLink':\n                this.editImgLink(args);\n                break;\n            case 'RemoveImageLink':\n                this.removeImgLink(args);\n                break;\n        }\n    };\n    Image.prototype.openImgLink = function (e) {\n        var sanitizedHTML = this.parent.htmlEditorModule.sanitizeHelper(e.selectParent[0].parentNode.outerHTML);\n        var tempEle = document.createElement('div');\n        tempEle.innerHTML = sanitizedHTML;\n        var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            url: tempEle.firstChild.href, target: target, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n        tempEle.remove();\n    };\n    Image.prototype.editImgLink = function (e) {\n        var selectParentEle = e.selectParent[0].parentNode;\n        var linkUpdate = this.i10n.getConstant('dialogUpdate');\n        var inputDetails = {\n            url: selectParentEle.href, target: selectParentEle.target,\n            header: 'Edit Link', btnText: linkUpdate\n        };\n        this.insertImgLink(e, inputDetails);\n    };\n    Image.prototype.removeImgLink = function (e) {\n        if (Browser.isIE) {\n            this.contentModule.getEditPanel().focus();\n        }\n        e.selection.restore();\n        var isCapLink = (this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle)) ?\n            true : false;\n        var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            insertElement: e.selectNode[0], selectParent: selectParent, selection: e.selection,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            if (!isNOU(e.selectParent)) {\n                removeClass([e.selectParent[0]], 'e-img-focus');\n            }\n        }\n        if (isCapLink) {\n            select('.e-img-inner', this.captionEle).focus();\n        }\n    };\n    Image.prototype.onKeyDown = function (event) {\n        var originalEvent = event.args;\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        this.deletedImg = [];\n        var isCursor;\n        var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123,\n            44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n        if (this.parent.editorMode === 'HTML') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n        }\n        if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n            var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            for (var i = 0; i < nodes.length; i++) {\n                if (nodes[i].nodeName === 'IMG') {\n                    this.deletedImg.push(nodes[i]);\n                }\n            }\n        }\n        if (this.parent.editorMode === 'HTML' && ((originalEvent.which === 8 && originalEvent.code === 'Backspace') ||\n            (originalEvent.which === 46 && originalEvent.code === 'Delete'))) {\n            var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n            if ((originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1)) {\n                this.checkImageBack(range);\n            }\n            else if ((originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1)) {\n                this.checkImageDel(range);\n            }\n        }\n        if (!isNOU(this.parent.formatter.editorManager.nodeSelection) &&\n            originalEvent.code !== 'KeyK') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') &&\n                (!isNOU(selectParentEle[0]) && selectParentEle[0].tagName === 'IMG') && selectParentEle[0].parentElement) {\n                if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                    this.removeResizeEle();\n                }\n                removeClass([selectParentEle[0]], 'e-img-focus');\n                if (this.quickToolObj && this.quickToolObj.imageQTBar) {\n                    this.quickToolObj.imageQTBar.hidePopup();\n                }\n            }\n        }\n        if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n            if (this.parent.editorMode !== 'Markdown') {\n                this.undoStack({ subCommand: (originalEvent.keyCode === 90 ? 'undo' : 'redo') });\n            }\n        }\n        if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n            if (selectNodeEle && selectNodeEle[0] && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n                if (!isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n                    save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n                }\n                originalEvent.preventDefault();\n                var event_1 = {\n                    selectNode: selectNodeEle, selection: save, selectParent: selectParentEle,\n                    args: {\n                        item: { command: 'Images', subCommand: 'Remove' },\n                        originalEvent: originalEvent\n                    }\n                };\n                this.deleteImg(event_1, originalEvent.keyCode);\n            }\n            if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                this.removeResizeEle();\n            }\n        }\n        if (originalEvent.code === 'Backspace') {\n            originalEvent.action = 'backspace';\n        }\n        switch (originalEvent.action) {\n            case 'escape':\n                if (!isNOU(this.dialogObj)) {\n                    this.dialogObj.close();\n                }\n                break;\n            case 'backspace':\n            case 'delete':\n                if (this.parent.editorMode !== 'Markdown') {\n                    if (range.startContainer.nodeType === 3) {\n                        if (originalEvent.code === 'Backspace') {\n                            if (range.startContainer.previousElementSibling && range.startOffset === 0 &&\n                                range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                                range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                                detach(range.startContainer.previousElementSibling);\n                            }\n                        }\n                        else {\n                            if (range.startContainer.nextElementSibling &&\n                                range.endContainer.textContent.length === range.endOffset &&\n                                range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                                range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                                detach(range.startContainer.nextElementSibling);\n                            }\n                        }\n                    }\n                    else if (range.startContainer.nodeType === 1) {\n                        if (range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE)) {\n                            detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n                        }\n                        else if (range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK)) {\n                            detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK));\n                        }\n                        else if (range.startContainer.classList.contains('e-img-wrap') && closest(range.startContainer, '.' + classes.CLS_CAPTION)) {\n                            var parentElem = range.startContainer.parentElement.parentElement;\n                            detach(closest(range.startContainer, '.' + classes.CLS_CAPTION));\n                            if (parentElem && parentElem.textContent.trim() === '') {\n                                var brElem = this.parent.createElement('br');\n                                brElem.classList.add('e-rte-image-remove-focus');\n                                parentElem.appendChild(brElem);\n                            }\n                        }\n                    }\n                }\n                break;\n            case 'insert-image':\n                if (!isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n                    save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n                }\n                this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n                originalEvent.preventDefault();\n                break;\n        }\n        if (originalEvent.ctrlKey && originalEvent.key === 'a') {\n            this.handleSelectAll();\n        }\n    };\n    Image.prototype.handleSelectAll = function () {\n        this.cancelResizeAction();\n        var imgFocusNodes = this.parent.inputElement.querySelectorAll('.' + classes.CLS_IMG_FOCUS);\n        removeClass(imgFocusNodes, classes.CLS_IMG_FOCUS);\n    };\n    Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = selection;\n            selectNodeEle = ele;\n            selectParentEle = parentEle;\n        }\n        if (this.parent.editorMode === 'HTML') {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event,\n                    name: !isInternal ? 'showDialog' : null\n                },\n                selectNode: selectNodeEle,\n                selection: save,\n                selectParent: selectParentEle\n            });\n        }\n        else {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event,\n                    name: !isInternal ? 'showDialog' : null\n                },\n                member: 'image',\n                text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n                module: 'Markdown',\n                name: 'insertImage'\n            });\n        }\n    };\n    Image.prototype.showDialog = function () {\n        this.openDialog(false);\n        this.setCssClass({ cssClass: this.parent.getCssClass() });\n    };\n    Image.prototype.closeDialog = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    Image.prototype.onKeyUp = function () {\n        if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n            var deleteImages = Array.from(this.deletedImg);\n            for (var i = deleteImages.length - 1; i >= 0; i--) {\n                var args = {\n                    element: this.deletedImg[i],\n                    src: this.deletedImg[i].getAttribute('src')\n                };\n                this.parent.trigger(events.afterImageDelete, args);\n                this.deletedImg.splice(i, 1);\n            }\n        }\n    };\n    Image.prototype.checkImageBack = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === 0 &&\n            !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.previousSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) &&\n            range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n        }\n    };\n    Image.prototype.checkImageDel = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length &&\n            !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.nextSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) &&\n            range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n        }\n    };\n    Image.prototype.alignmentSelect = function (e) {\n        var item = e.item;\n        if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n            return;\n        }\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n        selectNodeEle = (selectNodeEle[0].nodeName === 'IMG') ? selectNodeEle : [this.imgEle];\n        var args = { args: e, selectNode: selectNodeEle };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        switch (item.subCommand) {\n            case 'JustifyLeft':\n                this.alignImage(args);\n                break;\n            case 'JustifyCenter':\n                this.alignImage(args);\n                break;\n            case 'JustifyRight':\n                this.alignImage(args);\n                break;\n            case 'Inline':\n                this.inline(args);\n                break;\n            case 'Break':\n                this.break(args);\n                break;\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNodeEle[0]], 'e-img-focus');\n        }\n        this.cancelResizeAction();\n    };\n    Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                addClass([items[i]], 'e-link-groups');\n                items[i].style.display = 'none';\n            }\n            else if (items[i].getAttribute('title') === 'Insert Link') {\n                items[i].style.display = '';\n            }\n            else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                detach(items[i]);\n            }\n        }\n        var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n        this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n    };\n    Image.prototype.showImageQuickToolbar = function (e) {\n        var _this = this;\n        if (e.type !== 'Images' || isNOU(this.parent.quickToolbarModule)\n            || isNOU(this.parent.quickToolbarModule.imageQTBar) || isNOU(e.args)) {\n            return;\n        }\n        this.quickToolObj = this.parent.quickToolbarModule;\n        var args = e.args;\n        var target = e.elements;\n        [].forEach.call(e.elements, function (element, index) {\n            if (index === 0) {\n                target = element;\n            }\n        });\n        if (target && !closest(target, 'a')) {\n            this.imageWithLinkQTBarItemUpdate();\n        }\n        if (target.nodeName === 'IMG') {\n            addClass([target], ['e-img-focus']);\n        }\n        var pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset +\n            this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n        if (this.parent.quickToolbarModule.imageQTBar) {\n            if (e.isNotify) {\n                this.imageQTPopupTime = setTimeout(function () {\n                    _this.parent.formatter.editorManager.nodeSelection.Clear(_this.contentModule.getDocument());\n                    _this.parent.formatter.editorManager.nodeSelection.setSelectionContents(_this.contentModule.getDocument(), target);\n                    _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n                    if (_this.parent.insertImageSettings.resize === true) {\n                        _this.resizeStart(e.args, target);\n                    }\n                }, 400);\n            }\n            else {\n                var coordinates = target.getBoundingClientRect();\n                this.quickToolObj.imageQTBar.showPopup(coordinates.left, coordinates.top, target, 'Image');\n            }\n        }\n    };\n    Image.prototype.hideImageQuickToolbar = function () {\n        if (!isNOU(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n            removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n            if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n        }\n    };\n    Image.prototype.editAreaClickHandler = function (e) {\n        if (this.parent.readonly) {\n            this.hideImageQuickToolbar();\n            return;\n        }\n        var args = e.args;\n        var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n        if (args.which === 2 || (showOnRightClick && args.which === 1) || (!showOnRightClick && args.which === 3)) {\n            if ((showOnRightClick && args.which === 1) && !isNOU(args.target) &&\n                args.target.tagName === 'IMG') {\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n            }\n            return;\n        }\n        if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n            this.quickToolObj = this.parent.quickToolbarModule;\n            var target = args.target;\n            this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n            var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n            if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n                if (isPopupOpen) {\n                    return;\n                }\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n                if (isIDevice()) {\n                    this.parent.notify(events.selectionSave, e);\n                }\n                addClass([target], 'e-img-focus');\n                var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n                var separator = void 0;\n                if (closest(target, 'a')) {\n                    for (var i = 0; i < items.length; i++) {\n                        if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                            items[i].style.display = '';\n                            removeClass([items[i]], 'e-link-groups');\n                        }\n                        else if (items[i].getAttribute('title') === 'Insert Link') {\n                            items[i].style.display = 'none';\n                        }\n                        else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                            // eslint-disable-next-line\n                            separator = items[i];\n                            detach(items[i]);\n                        }\n                    }\n                    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n                    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n                }\n                else if (!closest(target, 'a')) {\n                    this.imageWithLinkQTBarItemUpdate();\n                }\n                this.showImageQuickToolbar({ args: args, type: 'Images', elements: [args.target] });\n            }\n            else {\n                this.hideImageQuickToolbar();\n            }\n        }\n    };\n    Image.prototype.insertImgLink = function (e, inputDetails) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNOU(this.dialogObj)) {\n            var linkWrap = this.parent.createElement('div', { className: 'e-img-linkwrap' + this.parent.getCssClass(true) });\n            var linkUrl = this.i10n.getConstant('linkurl');\n            var content = '<div class=\"e-rte-field' + this.parent.getCssClass(true) + '\">' +\n                '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link' + this.parent.getCssClass(true) + '\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' +\n                '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' +\n                '<input type=\"checkbox\" class=\"e-rte-linkTarget' + this.parent.getCssClass(true) + '\"  data-role =\"none\"></div>';\n            var contentElem = parseHtml(content);\n            linkWrap.appendChild(contentElem);\n            var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n            var inputLink = linkWrap.querySelector('.e-img-link');\n            var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n            this.checkBoxObj = new CheckBox({\n                label: linkOpenLabel, checked: true, enableRtl: this.parent.enableRtl, cssClass: this.parent.getCssClass(),\n                change: function (e) {\n                    if (e.checked) {\n                        target_1 = '_blank';\n                    }\n                    else {\n                        target_1 = null;\n                    }\n                }\n            });\n            this.checkBoxObj.isStringTemplate = true;\n            this.checkBoxObj.createElement = this.parent.createElement;\n            this.checkBoxObj.appendTo(linkTarget);\n            var target_1 = '_blank';\n            var imageLabel = this.i10n.getConstant('imageLinkAriaLabel');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var linkargs_1 = {\n                args: e.args,\n                selfImage: this, selection: e.selection,\n                selectNode: e.selectNode, selectParent: e.selectParent, link: inputLink, target: target_1, ariaLabel: imageLabel\n            };\n            this.dialogObj.setProperties({\n                width: '290px',\n                header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n                content: linkWrap,\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertlink(linkargs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-link' + this.parent.getCssClass(true), isPrimary: true\n                        }\n                    }],\n                cssClass: this.dialogObj.cssClass + ' e-rte-img-link-dialog'\n            });\n            if (!isNOU(this.parent.cssClass)) {\n                this.dialogObj.setProperties({ cssClass: this.parent.cssClass });\n            }\n            if (!isNOU(inputDetails)) {\n                inputLink.value = inputDetails.url;\n                this.checkBoxObj.checked = (inputDetails.target) ? true : false;\n                this.dialogObj.header = inputDetails.header;\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAltText = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        var altText = this.i10n.getConstant('altText');\n        if (!isNOU(this.dialogObj)) {\n            var altWrap = this.parent.createElement('div', { className: 'e-img-altwrap' + this.parent.getCssClass(true) });\n            var altHeader = this.i10n.getConstant('alternateHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var getAlt = (e.selectNode[0].getAttribute('alt') === null) ? '' :\n                e.selectNode[0].getAttribute('alt');\n            var content = '<div class=\"e-rte-field' + this.parent.getCssClass(true) + '\">' +\n                '<input type=\"text\" spellcheck=\"false\"  class=\"e-input e-img-alt' + this.parent.getCssClass(true) + '\" placeholder=\"' + altText + '\"/>' +\n                '</div>';\n            var contentElem = parseHtml(content);\n            contentElem.querySelector('input').setAttribute('value', getAlt);\n            altWrap.appendChild(contentElem);\n            var inputAlt = altWrap.querySelector('.e-img-alt');\n            var altArgs_1 = {\n                args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode,\n                alt: inputAlt\n            };\n            this.dialogObj.setProperties({\n                width: '290px', header: altHeader, content: altWrap,\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertAlt(altArgs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-alt' + this.parent.getCssClass(true), isPrimary: true\n                        }\n                    }],\n                cssClass: this.dialogObj.cssClass + ' e-rte-img-alt-dialog'\n            });\n            if (!isNOU(this.parent.cssClass)) {\n                this.dialogObj.setProperties({ cssClass: this.parent.cssClass });\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAlt = function (e) {\n        if (!isNOU(e.alt)) {\n            e.selection.restore();\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            var altText = e.alt.value;\n            this.parent.formatter.process(this.parent, e.args, e.args, {\n                altText: altText, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            this.dialogObj.hide({ returnValue: false });\n        }\n    };\n    Image.prototype.insertlink = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var url = e.link.value;\n        if (url === '') {\n            addClass([e.link], 'e-error');\n            e.link.setSelectionRange(0, url.length);\n            e.link.focus();\n            return;\n        }\n        if (!this.isUrl(url)) {\n            url = 'http://' + url;\n        }\n        else {\n            removeClass([e.link], 'e-error');\n        }\n        var proxy = e.selfImage;\n        if (proxy.parent.editorMode === 'HTML') {\n            e.selection.restore();\n        }\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        if (e.selectNode[0].parentElement.nodeName === 'A') {\n            proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n                url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, ariaLabel: proxy.checkBoxObj.checked ? this.i10n.getConstant('imageLinkAriaLabel') : null, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            proxy.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n            url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, ariaLabel: proxy.checkBoxObj.checked ? this.i10n.getConstant('imageLinkAriaLabel') : null, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand, selection: e.selection\n        });\n        var captionEle = closest(e.selectNode[0], '.e-img-caption');\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        proxy.dialogObj.hide({ returnValue: false });\n    };\n    Image.prototype.isUrl = function (url) {\n        var regExp = RegExp;\n        var regexp = new regExp('(ftp|http|https)://(\\\\w+:{0,1}\\\\w*@)?(\\\\S+)(:[0-9]+)?(/|/([\\\\w#!:.?+=&%@\\\\-\\\\/]))?', 'gi');\n        return regexp.test(url);\n    };\n    Image.prototype.deleteImg = function (e, keyCode) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var args = {\n            element: e.selectNode[0],\n            src: e.selectNode[0].getAttribute('src')\n        };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        var restoreStartElement = e.selection.range.startContainer;\n        if (e.selection.range.startContainer.nodeName === 'SPAN' &&\n            restoreStartElement.classList.contains('e-img-wrap') &&\n            restoreStartElement.parentElement.classList.contains('e-img-caption')) {\n            restoreStartElement = restoreStartElement.parentElement;\n            if (!isNOU(restoreStartElement.previousSibling)) {\n                var lastNode = restoreStartElement.previousSibling;\n                while (lastNode.nodeName !== '#text' && lastNode.nodeName !== 'BR') {\n                    lastNode = lastNode.lastChild;\n                }\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(), lastNode, lastNode.nodeName !== 'BR' ? lastNode.textContent.length : 0);\n            }\n            else if (!isNOU(restoreStartElement.nextSibling)) {\n                var firstNode = restoreStartElement.nextSibling;\n                while (firstNode.nodeName !== '#text' && firstNode.nodeName !== 'BR') {\n                    firstNode = firstNode.firstChild;\n                }\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(), firstNode, 0);\n            }\n        }\n        else {\n            e.selection.restore();\n        }\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n            this.removeResizeEle();\n        }\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            selectNode: e.selectNode,\n            captionClass: classes.CLS_CAPTION,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n        }\n        this.cancelResizeAction();\n        if (isNOU(keyCode)) {\n            this.parent.trigger(events.afterImageDelete, args);\n        }\n    };\n    Image.prototype.caption = function (e) {\n        var selectNode = e.selectNode[0];\n        if (selectNode.nodeName !== 'IMG') {\n            return;\n        }\n        e.selection.restore();\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        this.cancelResizeAction();\n        addClass([selectNode], 'e-rte-image');\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Caption';\n        if (!isNOU(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n            detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n            if (Browser.isIE) {\n                this.contentModule.getEditPanel().focus();\n                e.selection.restore();\n            }\n            if (selectNode.parentElement.tagName === 'A') {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode.parentElement, selectNode: e.selectNode, subCommand: subCommand });\n            }\n            else {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode, selectNode: e.selectNode, subCommand: subCommand });\n            }\n        }\n        else {\n            this.captionEle = this.parent.createElement('span', {\n                className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION + this.parent.getCssClass(true),\n                attrs: { contenteditable: 'false', draggable: 'false', style: 'width:' + this.parent.insertImageSettings.width }\n            });\n            var imgWrap = this.parent.createElement('span', { className: 'e-img-wrap' + this.parent.getCssClass(true) });\n            var imgInner = this.parent.createElement('span', { className: 'e-img-inner' + this.parent.getCssClass(true),\n                attrs: { contenteditable: 'true' } });\n            var parent_1 = e.selectNode[0].parentElement;\n            if (parent_1.tagName === 'A') {\n                parent_1.setAttribute('contenteditable', 'true');\n            }\n            imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n            imgWrap.appendChild(imgInner);\n            var imgCaption = this.i10n.getConstant('imageCaption');\n            imgInner.innerHTML = imgCaption;\n            this.captionEle.appendChild(imgWrap);\n            if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n                addClass([this.captionEle], classes.CLS_CAPINLINE);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n                addClass([this.captionEle], classes.CLS_IMGBREAK);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n                addClass([this.captionEle], classes.CLS_IMGLEFT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n                addClass([this.captionEle], classes.CLS_IMGRIGHT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n                addClass([this.captionEle], classes.CLS_IMGCENTER);\n            }\n            this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: this.captionEle, selectNode: e.selectNode, subCommand: subCommand });\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNode], 'e-img-focus');\n        }\n    };\n    Image.prototype.imageSize = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNOU(this.dialogObj)) {\n            var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var dialogContent = this.imgsizeInput(e);\n            var selectObj_1 = { args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode };\n            this.dialogObj.setProperties({\n                width: '290px', header: imgSizeHeader, content: dialogContent,\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertSize(selectObj_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-size' + this.parent.getCssClass(true), isPrimary: true\n                        }\n                    }],\n                cssClass: this.dialogObj.cssClass + ' e-rte-img-size-dialog'\n            });\n            if (!isNOU(this.parent.cssClass)) {\n                this.dialogObj.setProperties({ cssClass: this.parent.cssClass });\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.break = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = e.args.item.subCommand;\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.inline = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = e.args.item.subCommand;\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.alignImage = function (e) {\n        var subCommand = e.args.item.subCommand;\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.clearDialogObj = function () {\n        if (this.uploadObj && !this.uploadObj.isDestroyed) {\n            this.uploadObj.destroy();\n            detach(this.uploadObj.element);\n            this.uploadObj = null;\n        }\n        if (this.checkBoxObj && !this.checkBoxObj.isDestroyed) {\n            this.checkBoxObj.destroy();\n            detach(this.checkBoxObj.element);\n            this.checkBoxObj = null;\n        }\n        if (this.popupObj && !this.popupObj.isDestroyed) {\n            this.popupObj.destroy();\n            detach(this.popupObj.element);\n            this.popupObj = null;\n        }\n        if (this.widthNum && !this.widthNum.isDestroyed) {\n            this.widthNum.destroy();\n            detach(this.widthNum.element);\n            this.widthNum = null;\n        }\n        if (this.heightNum && !this.heightNum.isDestroyed) {\n            this.heightNum.destroy();\n            detach(this.heightNum.element);\n            this.heightNum = null;\n        }\n        if (this.browseButton && !this.browseButton.isDestroyed) {\n            this.browseButton.destroy();\n            detach(this.browseButton.element);\n            this.browseButton = null;\n        }\n        if (this.dialogObj && !this.dialogObj.isDestroyed) {\n            this.dialogObj.destroy();\n            detach(this.dialogObj.element);\n            this.dialogObj = null;\n        }\n    };\n    Image.prototype.imagDialog = function (e) {\n        var _this = this;\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        var imgDialog = this.parent.createElement('div', { className: 'e-rte-img-dialog' + this.parent.getCssClass(true), id: this.rteID + '_image' });\n        this.parent.rootContainer.appendChild(imgDialog);\n        var imgInsert = this.i10n.getConstant('dialogInsert');\n        var imglinkCancel = this.i10n.getConstant('dialogCancel');\n        var imgHeader = this.i10n.getConstant('imageHeader');\n        var selection = e.selection;\n        var selectObj = { selfImage: this, selection: e.selection, args: e.args, selectParent: e.selectParent };\n        var dialogModel = {\n            header: imgHeader,\n            cssClass: classes.CLS_RTE_ELEMENTS + this.parent.getCssClass(true),\n            enableRtl: this.parent.enableRtl,\n            locale: this.parent.locale,\n            showCloseIcon: true, closeOnEscape: true, width: (Browser.isDevice) ? '290px' : '340px',\n            isModal: Browser.isDevice,\n            buttons: [{\n                    click: this.insertImageUrl.bind(selectObj),\n                    buttonModel: { content: imgInsert, cssClass: 'e-flat e-insertImage' + this.parent.getCssClass(true), isPrimary: true, disabled: this.parent.editorMode === 'Markdown' ? false : true }\n                },\n                {\n                    click: this.cancelDialog.bind(this),\n                    buttonModel: { cssClass: 'e-flat e-cancel' + this.parent.getCssClass(true), content: imglinkCancel }\n                }],\n            target: (Browser.isDevice) ? document.body : this.parent.element,\n            animationSettings: { effect: 'None' },\n            close: function (event) {\n                if (event && event.closedBy !== 'user action' && _this.uploadObj.filesData.length > 0) {\n                    _this.uploadObj.remove();\n                }\n                _this.parent.isBlur = false;\n                if (event && !isNOU(event.event) && event.event.returnValue) {\n                    if (_this.parent.editorMode === 'HTML') {\n                        selection.restore();\n                    }\n                    else {\n                        _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n                    }\n                }\n                _this.clearDialogObj();\n                _this.dialogRenderObj.close(event);\n            }\n        };\n        var dialogContent = this.parent.createElement('div', { className: 'e-img-content' + this.parent.getCssClass(true) });\n        if ((!isNOU(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n            || this.parent.editorMode === 'HTML') {\n            dialogContent.appendChild(this.imgUpload(e));\n        }\n        var linkHeader = this.parent.createElement('div', { className: 'e-linkheader' + this.parent.getCssClass(true) });\n        var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n        if (this.parent.editorMode === 'HTML') {\n            linkHeader.innerHTML = linkHeaderText;\n        }\n        else {\n            linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n        }\n        dialogContent.appendChild(linkHeader);\n        dialogContent.appendChild(this.imageUrlPopup(e));\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n            dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n            dialogModel.content = dialogContent;\n            dialogModel.buttons[0].buttonModel.cssClass = dialogModel.buttons[0].buttonModel.cssClass + ' e-updateImage';\n        }\n        else {\n            dialogModel.content = dialogContent;\n        }\n        this.dialogObj = this.dialogRenderObj.render(dialogModel);\n        this.dialogObj.createElement = this.parent.createElement;\n        this.dialogObj.appendTo(imgDialog);\n        if (isNOU(this.dialogObj)) {\n            return;\n        }\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && (e.name === 'insertImage')) {\n            this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n        }\n        imgDialog.style.maxHeight = 'inherit';\n        if (this.quickToolObj) {\n            if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n                if (!isNOU(e.selectParent)) {\n                    removeClass([e.selectParent[0]], 'e-img-focus');\n                }\n            }\n            if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n                this.quickToolObj.inlineQTBar.hidePopup();\n            }\n            if (this.quickToolObj.textQTBar && this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)) {\n                this.quickToolObj.textQTBar.hidePopup();\n            }\n        }\n    };\n    Image.prototype.cancelDialog = function () {\n        this.parent.isBlur = false;\n        if (this.uploadObj.filesData.length > 0) {\n            this.uploadObj.remove();\n        }\n        this.dialogObj.hide({ returnValue: true });\n    };\n    Image.prototype.onDocumentClick = function (e) {\n        var target = e.target;\n        if (isNOU(this.contentModule.getEditPanel())) {\n            return;\n        }\n        if (target.nodeName === 'IMG') {\n            this.imgEle = target;\n        }\n        if (!this.parent) {\n            return;\n        }\n        if (target.nodeName !== '#document') {\n            this.parent.currentTarget = e.target;\n        }\n        if (!isNOU(this.dialogObj) && ((\n        // eslint-disable-next-line\n        !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() &&\n            !this.parent.getToolbarElement().contains(e.target)) ||\n            (this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) &&\n                !closest(target, '#' + this.parent.getID() + '_toolbar_Image') &&\n                !target.querySelector('#' + this.parent.getID() + '_toolbar_Image')))) {\n            /* eslint-disable */\n            if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {\n            }\n            else {\n                this.parent.notify(events.documentClickClosedBy, { closedBy: \"outside click\" });\n                this.dialogObj.hide({ returnValue: true });\n                this.parent.isBlur = true;\n                dispatchEvent(this.parent.element, 'focusout');\n            }\n            /* eslint-enable */\n        }\n        if (!(this.parent.iframeSettings.enable && !isNOU(this.parent.currentTarget) && this.parent.currentTarget.nodeName === 'IMG') &&\n            e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj &&\n            this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) &&\n            this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize') && !(this.parent.iframeSettings.enable && this.parent.currentTarget.nodeName === 'IMG')) {\n            if (target.tagName !== 'IMG') {\n                this.removeResizeEle();\n            }\n            if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n                this.imgEle.style.outline = '';\n            }\n            else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n                this.prevSelectedImgEle.style.outline = '';\n            }\n        }\n        if (target.tagName !== 'IMG') {\n            var items = this.contentModule.getEditPanel().querySelectorAll('img');\n            for (var i = 0; i < items.length; i++) {\n                removeClass([items[i]], 'e-img-focus');\n                removeClass([items[i]], 'e-resize');\n            }\n        }\n        if (this.parent.inlineMode.enable && target && this.dialogObj && !closest(target, '#' + this.dialogObj.element.id)) {\n            this.dialogObj.hide();\n        }\n    };\n    Image.prototype.removeResizeEle = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n    };\n    Image.prototype.onWindowResize = function () {\n        if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n            this.cancelResizeAction();\n        }\n    };\n    Image.prototype.imageUrlPopup = function (e) {\n        var _this = this;\n        var imgUrl = this.parent.createElement('div', { className: 'imgUrl' + this.parent.getCssClass(true) });\n        var placeUrl = this.i10n.getConstant('imageUrl');\n        this.inputUrl = this.parent.createElement('input', {\n            className: 'e-input e-img-url' + this.parent.getCssClass(true),\n            attrs: { placeholder: placeUrl, spellcheck: 'false', 'aria-label': this.i10n.getConstant('imageLinkHeader') }\n        });\n        this.inputUrl.addEventListener('input', function () {\n            if (!isNOU(_this.inputUrl)) {\n                if (_this.inputUrl.value.length === 0) {\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                }\n                else {\n                    _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                }\n            }\n        });\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n            var regex = new RegExp(/([^\\S]|^)(((https?:\\/\\/)|(www\\.))(\\S+))/gi);\n            this.inputUrl.value = e.selectNode[0].src.match(regex) ? e.selectNode[0].src : '';\n        }\n        imgUrl.appendChild(this.inputUrl);\n        return imgUrl;\n    };\n    Image.prototype.insertImageUrl = function (e) {\n        var proxy = this.selfImage;\n        proxy.isImgUploaded = false;\n        var url = proxy.inputUrl.value;\n        if (e.target && e.target.nodeName === 'BUTTON' && e.target.classList.contains('e-updateImage')) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var element = this.selectNode && this.selectNode[0] && this.selectNode[0].nodeName === 'IMG' ?\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                this.selectNode[0] : null;\n            var args = {\n                element: element,\n                src: url\n            };\n            proxy.parent.trigger(events.afterImageDelete, args);\n        }\n        if (proxy.parent.editorMode === 'Markdown' && url === '') {\n            url = 'http://';\n        }\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        var previousSubCommand = this.args.item.subCommand;\n        this.args.item.subCommand = e.target.innerHTML === 'Update' ? 'Replace' : this.args.item.subCommand;\n        if (!isNOU(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n            proxy.uploadUrl.cssClass = (proxy.parent.insertImageSettings.display === 'inline' ?\n                classes.CLS_IMGINLINE : classes.CLS_IMGBREAK);\n            proxy.dialogObj.hide({ returnValue: false });\n            if (proxy.dialogObj !== null) {\n                return;\n            }\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n            proxy.uploadUrl.url = '';\n            if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                proxy.imgEle.style.outline = '';\n                proxy.removeResizeEle();\n            }\n        }\n        else if (url !== '') {\n            if (proxy.parent.editorMode === 'HTML' && isNOU(closest(\n            // eslint-disable-next-line\n            this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n                proxy.contentModule.getEditPanel().focus();\n                var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n                this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n                this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            }\n            var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n            var matchUrl = (!isNOU(url.match(regex)) && proxy.parent.editorMode === 'HTML') ? url.match(regex)[0] : '';\n            var value = {\n                cssClass: (proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                url: url, selection: this.selection, altText: matchUrl,\n                selectParent: this.selectParent, width: {\n                    width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                },\n                height: {\n                    height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                }\n            };\n            proxy.dialogObj.hide({ returnValue: false });\n            if (proxy.dialogObj !== null) {\n                return;\n            }\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n        }\n        this.args.item.subCommand = previousSubCommand;\n    };\n    Image.prototype.imgsizeInput = function (e) {\n        var _this = this;\n        var selectNode = e.selectNode[0];\n        var imgHeight = this.i10n.getConstant('imageHeight');\n        var imgWidth = this.i10n.getConstant('imageWidth');\n        var imgSizeWrap = this.parent.createElement('div', { className: 'e-img-sizewrap' + this.parent.getCssClass(true) });\n        var widthVal = isNOU(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' ||\n            selectNode.style.width !== '') ? selectNode.style.width : !isNOU(this.changedWidthValue) ?\n            this.changedWidthValue : (parseInt(selectNode.getClientRects()[0].width.toString(), 10)).toString();\n        var heightVal = isNOU(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' ||\n            selectNode.style.height !== '') ? selectNode.style.height : !isNOU(this.changedHeightValue) ?\n            this.changedHeightValue : (parseInt(selectNode.getClientRects()[0].height.toString(), 10)).toString();\n        if (selectNode.style.width === '') {\n            widthVal = 'auto';\n        }\n        if (selectNode.style.height === '') {\n            heightVal = 'auto';\n        }\n        this.changedWidthValue = null;\n        this.changedHeightValue = null;\n        var content = '<div class=\"e-rte-label' + this.parent.getCssClass(true) + '\"><label>' + imgWidth +\n            '</label></div><div class=\"e-rte-field' + this.parent.getCssClass(true) + '\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width' + this.parent.getCssClass(true) + '\"/></div>' +\n            '<div class=\"e-rte-label' + this.parent.getCssClass(true) + '\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field' + this.parent.getCssClass(true) + '\"> ' +\n            '<input type=\"text\" id=\"imgheight\" class=\"e-img-height' + this.parent.getCssClass(true) + '\"/></div>';\n        var contentElem = parseHtml(content);\n        contentElem.getElementById('imgwidth').setAttribute('value', widthVal);\n        contentElem.getElementById('imgheight').setAttribute('value', heightVal);\n        imgSizeWrap.appendChild(contentElem);\n        this.widthNum = new TextBox({\n            value: formatUnit(widthVal),\n            enableRtl: this.parent.enableRtl,\n            cssClass: this.parent.getCssClass(),\n            input: function (e) {\n                _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        this.widthNum.createElement = this.parent.createElement;\n        this.widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n        this.heightNum = new TextBox({\n            value: formatUnit(heightVal),\n            enableRtl: this.parent.enableRtl,\n            cssClass: this.parent.getCssClass(),\n            input: function (e) {\n                _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        this.heightNum.createElement = this.parent.createElement;\n        this.heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n        return imgSizeWrap;\n    };\n    Image.prototype.inputValue = function (value) {\n        if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1\n            || value.match(/(\\d+)/)) {\n            return value;\n        }\n        else {\n            return 'auto';\n        }\n    };\n    Image.prototype.insertSize = function (e) {\n        e.selection.restore();\n        var proxy = e.selfImage;\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        var dialogEle = proxy.dialogObj.element;\n        this.changedWidthValue = this.inputWidthValue;\n        this.changedHeightValue = this.inputHeightValue;\n        var width = dialogEle.querySelector('.e-img-width').value;\n        var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n        proxy.parent.formatter.process(this.parent, e.args, e.args, {\n            width: width, height: height, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.imgResizeDiv) {\n            proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n        }\n        proxy.dialogObj.hide({ returnValue: true });\n    };\n    Image.prototype.insertImage = function (e) {\n        this.imagDialog(e);\n        if (!isNOU(this.dialogObj)) {\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n            if (((!isNOU(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n                || this.parent.editorMode === 'HTML')) {\n                document.getElementById(this.rteID + '_insertImage').focus();\n            }\n            else {\n                dialogContent.querySelector('.e-img-url').focus();\n            }\n        }\n    };\n    Image.prototype.imgUpload = function (e) {\n        var _this = this;\n        var save;\n        var selectParent;\n        // eslint-disable-next-line\n        var proxy = this;\n        var iframe = proxy.parent.iframeSettings.enable;\n        if (proxy.parent.editorMode === 'HTML' && (!iframe && isNOU(closest(e.selection.range.startContainer.parentNode, '[id='\n            // eslint-disable-next-line\n            + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']'))\n            || (iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib')))) {\n            this.contentModule.getEditPanel().focus();\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = e.selection;\n            selectParent = e.selectParent;\n        }\n        var uploadParentEle = this.parent.createElement('div', { className: 'e-img-uploadwrap e-droparea' + this.parent.getCssClass(true) });\n        var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n        var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n        var span = this.parent.createElement('span', { className: 'e-droptext' + this.parent.getCssClass(true) });\n        var spanMsg = this.parent.createElement('span', {\n            className: 'e-rte-upload-text' + this.parent.getCssClass(true), innerHTML: ((Browser.isDevice) ? deviceImgUpMsg : imgUpMsg)\n        });\n        span.appendChild(spanMsg);\n        var btnEle = this.parent.createElement('button', {\n            className: 'e-browsebtn' + this.parent.getCssClass(true), id: this.rteID + '_insertImage', attrs: { autofocus: 'true', type: 'button' }\n        });\n        span.appendChild(btnEle);\n        uploadParentEle.appendChild(span);\n        var browserMsg = this.i10n.getConstant('browse');\n        this.browseButton = new Button({ content: browserMsg, enableRtl: this.parent.enableRtl });\n        this.browseButton.isStringTemplate = true;\n        this.browseButton.createElement = this.parent.createElement;\n        this.browseButton.appendTo(btnEle);\n        var btnClick = (Browser.isDevice) ? span : btnEle;\n        EventHandler.add(btnClick, 'click', this.fileSelect, this);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }, className: this.parent.getCssClass()\n        });\n        uploadParentEle.appendChild(uploadEle);\n        var altText;\n        var selectArgs;\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        var filesData;\n        var previousFileInfo = null;\n        this.uploadObj = new Uploader({\n            asyncSettings: { saveUrl: this.parent.insertImageSettings.saveUrl, removeUrl: this.parent.insertImageSettings.removeUrl },\n            dropArea: span, multiple: false, enableRtl: this.parent.enableRtl, cssClass: this.parent.getCssClass(),\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            selected: function (e) {\n                proxy.isImgUploaded = true;\n                selectArgs = e;\n                filesData = e.filesData;\n                _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n                    if (!selectArgs.cancel) {\n                        _this.checkExtension(selectArgs.filesData[0]);\n                        altText = selectArgs.filesData[0].name.replace(/\\.[a-zA-Z0-9]+$/, '');\n                        if (_this.parent.editorMode === 'HTML' && isNOU(_this.parent.insertImageSettings.path)) {\n                            var reader_1 = new FileReader();\n                            // eslint-disable-next-line\n                            reader_1.addEventListener('load', function (e) {\n                                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result :\n                                    URL.createObjectURL(convertToBlob(reader_1.result));\n                                proxy.uploadUrl = {\n                                    url: url, selection: save, altText: altText,\n                                    selectParent: selectParent,\n                                    width: {\n                                        width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                        maxWidth: proxy.parent.getInsertImgMaxWidth()\n                                    }, height: {\n                                        height: proxy.parent.insertImageSettings.height,\n                                        minHeight: proxy.parent.insertImageSettings.minHeight,\n                                        maxHeight: proxy.parent.insertImageSettings.maxHeight\n                                    }\n                                };\n                                proxy.inputUrl.setAttribute('disabled', 'true');\n                                if (!isNOU(_this.dialogObj)) {\n                                    var button = _this.dialogObj.getButtons(0);\n                                    if (!isNOU(button)) {\n                                        if (isNOU(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes\n                                            && selectArgs.filesData[0].size <= _this.uploadObj.maxFileSize) {\n                                            button.element.removeAttribute('disabled');\n                                        }\n                                        else {\n                                            button.element.setAttribute('disabled', 'true');\n                                        }\n                                    }\n                                }\n                            });\n                            reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n                        }\n                    }\n                });\n            },\n            beforeUpload: function (args) {\n                _this.parent.trigger(events.beforeImageUpload, args);\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    _this.parent.trigger(events.imageUploading, e);\n                }\n            },\n            success: function (e) {\n                e.detectImageSource = ImageInputSource.Uploaded;\n                _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n                    if (!isNOU(_this.parent.insertImageSettings.path)) {\n                        var url = _this.parent.insertImageSettings.path + (e).file.name;\n                        // Update the URL of the previously uploaded image\n                        if (!isNOU(previousFileInfo) && e.operation === 'upload') {\n                            _this.uploadObj.remove(previousFileInfo);\n                        }\n                        // eslint-disable-next-line\n                        var value = { url: url, selection: save };\n                        proxy.uploadUrl = {\n                            url: url, selection: save, altText: altText, selectParent: selectParent,\n                            width: {\n                                width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                maxWidth: proxy.parent.getInsertImgMaxWidth()\n                            }, height: {\n                                height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                                maxHeight: proxy.parent.insertImageSettings.maxHeight\n                            }\n                        };\n                        proxy.inputUrl.setAttribute('disabled', 'true');\n                        previousFileInfo = e.file;\n                    }\n                    if (e.operation === 'upload' && !isNOU(_this.dialogObj)) {\n                        _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                    }\n                });\n            },\n            failure: function (e) {\n                _this.parent.trigger(events.imageUploadFailed, e);\n            },\n            removing: function (removeEventArgs) {\n                // eslint-disable-next-line\n                _this.parent.trigger(events.imageRemoving, removeEventArgs, function (e) {\n                    proxy.isImgUploaded = false;\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                    proxy.inputUrl.removeAttribute('disabled');\n                    if (proxy.uploadUrl) {\n                        proxy.uploadUrl.url = '';\n                    }\n                });\n            }\n        });\n        this.uploadObj.isStringTemplate = true;\n        this.uploadObj.createElement = this.parent.createElement;\n        this.uploadObj.appendTo(uploadEle);\n        return uploadParentEle;\n    };\n    Image.prototype.checkExtension = function (e) {\n        if (this.uploadObj.allowedExtensions) {\n            if (e.type) {\n                if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n                    this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n                    this.isAllowedTypes = false;\n                }\n                else {\n                    this.isAllowedTypes = true;\n                }\n            }\n        }\n    };\n    Image.prototype.fileSelect = function () {\n        this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n        return false;\n    };\n    Image.prototype.dragStart = function (e) {\n        if (e.target.nodeName === 'IMG') {\n            this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n                if (actionBeginArgs.cancel) {\n                    e.preventDefault();\n                }\n                else {\n                    e.dataTransfer.effectAllowed = 'copyMove';\n                    e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n                }\n            });\n        }\n        else {\n            return true;\n        }\n    };\n    Image.prototype.dragEnter = function (e) {\n        e.dataTransfer.dropEffect = 'copy';\n        e.preventDefault();\n    };\n    Image.prototype.dragOver = function (e) {\n        if ((Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1) ||\n            (Browser.isIE && e.dataTransfer.types[0] === 'Files')) {\n            e.preventDefault();\n        }\n        else {\n            return true;\n        }\n    };\n    /**\n     * Used to set range When drop an image\n     *\n     * @param {ImageDropEventArgs} args - specifies the image arguments.\n     * @returns {void}\n     */\n    Image.prototype.dragDrop = function (args) {\n        var _this = this;\n        this.parent.trigger(events.beforeImageDrop, args, function (e) {\n            var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n            var isImgOrFileDrop = (imgElement && imgElement.tagName === 'IMG') || e.dataTransfer.files.length > 0;\n            if (!e.cancel && isImgOrFileDrop) {\n                if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') ||\n                    _this.parent.inputElement.contentEditable === 'false') {\n                    e.preventDefault();\n                    return;\n                }\n                if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n                    detach(_this.imgResizeDiv);\n                }\n                e.preventDefault();\n                var range = void 0;\n                if (_this.contentModule.getDocument().caretRangeFromPoint) { //For chrome\n                    range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n                }\n                else if ((e.rangeParent)) { //For mozilla firefox\n                    range = _this.contentModule.getDocument().createRange();\n                    range.setStart(e.rangeParent, e.rangeOffset);\n                }\n                else {\n                    range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n                }\n                _this.parent.notify(events.selectRange, { range: range });\n                var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n                if (uploadArea) {\n                    return;\n                }\n                _this.insertDragImage(e);\n            }\n            else {\n                if (isImgOrFileDrop) {\n                    e.preventDefault();\n                }\n            }\n        });\n    };\n    /**\n     * Used to calculate range on internet explorer\n     *\n     * @param {number} x - specifies the x range.\n     * @param {number} y - specifies the y range.\n     * @returns {void}\n     */\n    Image.prototype.getDropRange = function (x, y) {\n        var startRange = this.contentModule.getDocument().createRange();\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n        var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n        var startNode = (elem.childNodes.length > 0 ? elem.childNodes[0] : elem);\n        var startCharIndexCharacter = 0;\n        if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n            startRange.setStart(startNode, startCharIndexCharacter);\n            startRange.setEnd(startNode, startCharIndexCharacter);\n        }\n        else {\n            var rangeRect = void 0;\n            do {\n                startCharIndexCharacter++;\n                startRange.setStart(startNode, startCharIndexCharacter);\n                startRange.setEnd(startNode, startCharIndexCharacter + 1);\n                rangeRect = startRange.getBoundingClientRect();\n            } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n        }\n        return startRange;\n    };\n    Image.prototype.insertDragImage = function (e) {\n        var _this = this;\n        e.preventDefault();\n        var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n        this.parent.notify(events.drop, { args: e });\n        if (activePopupElement) {\n            activePopupElement.classList.add(classes.CLS_HIDE);\n        }\n        var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n        var actionBeginArgs = {\n            requestType: 'Images',\n            name: 'ImageDragAndDrop',\n            cancel: false,\n            originalEvent: e\n        };\n        if (e.dataTransfer.files.length > 0 && imgElement === null) { //For external image drag and drop\n            if (e.dataTransfer.files.length > 1) {\n                return;\n            }\n            var imgFiles_1 = e.dataTransfer.files;\n            var fileName = imgFiles_1[0].name;\n            var imgType = fileName.substring(fileName.lastIndexOf('.'));\n            var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n            for (var i = 0; i < allowedTypes.length; i++) {\n                if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n                    if (this.parent.insertImageSettings.saveUrl) {\n                        this.onSelect(e);\n                    }\n                    else {\n                        this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n                            if (!actionBeginArgs.cancel) {\n                                var args = { args: e, text: '', file: imgFiles_1[0] };\n                                e.preventDefault();\n                                _this.imagePaste(args);\n                            }\n                            else {\n                                actionBeginArgs.originalEvent.preventDefault();\n                            }\n                        });\n                    }\n                }\n            }\n        }\n        else { //For internal image drag and drop\n            this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n                if (!actionBeginArgs.cancel) {\n                    var range = _this.parent.formatter.editorManager.nodeSelection.getRange(_this.parent.contentModule.getDocument());\n                    if (imgElement && imgElement.tagName === 'IMG') {\n                        if (imgElement.nextElementSibling) {\n                            if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n                                range.insertNode(imgElement.parentElement.parentElement);\n                            }\n                            else {\n                                range.insertNode(imgElement);\n                            }\n                        }\n                        else {\n                            range.insertNode(imgElement);\n                        }\n                        imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n                        var imgArgs_1 = { elements: [imgElement] };\n                        imgElement.addEventListener('load', function () {\n                            _this.parent.trigger(events.actionComplete, imgArgs_1);\n                        });\n                        _this.parent.formatter.editorManager.nodeSelection.Clear(_this.contentModule.getDocument());\n                        var args = e;\n                        _this.resizeStart(args, imgElement);\n                        _this.hideImageQuickToolbar();\n                    }\n                }\n                else {\n                    actionBeginArgs.originalEvent.preventDefault();\n                }\n            });\n        }\n    };\n    Image.prototype.onSelect = function (args) {\n        var _this = this;\n        // eslint-disable-next-line\n        var proxy = this;\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var parentElement = this.parent.createElement('ul', { className: classes.CLS_UPLOAD_FILES });\n        this.parent.rootContainer.appendChild(parentElement);\n        var validFiles = {\n            name: args.dataTransfer.files[0].name,\n            size: args.dataTransfer.files[0].size,\n            status: '',\n            statusCode: '',\n            type: args.dataTransfer.files[0].type,\n            rawFile: args.dataTransfer.files[0],\n            validationMessages: {}\n        };\n        var imageTag = this.parent.createElement('IMG');\n        imageTag.style.opacity = '0.5';\n        imageTag.classList.add(classes.CLS_RTE_IMAGE);\n        imageTag.classList.add(classes.CLS_IMGINLINE);\n        imageTag.classList.add(classes.CLS_RESIZE);\n        var file = validFiles.rawFile;\n        var reader = new FileReader();\n        reader.addEventListener('load', function () {\n            var url = URL.createObjectURL(convertToBlob(reader.result));\n            imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n        });\n        if (file) {\n            reader.readAsDataURL(file);\n        }\n        var selection = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n        var imageCommand = {\n            cssClass: (this.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n            url: this.parent.insertImageSettings.path + file.name,\n            selection: selection,\n            altText: file.name.replace(/\\.[a-zA-Z0-9]+$/, ''),\n            width: {\n                width: this.parent.insertImageSettings.width, minWidth: this.parent.insertImageSettings.minWidth,\n                maxWidth: this.parent.getInsertImgMaxWidth()\n            },\n            height: {\n                height: this.parent.insertImageSettings.height, minHeight: this.parent.insertImageSettings.minHeight,\n                maxHeight: this.parent.insertImageSettings.maxHeight\n            }\n        };\n        var actionBeginArgs = {\n            requestType: 'Image',\n            name: 'ImageDragAndDrop',\n            cancel: false,\n            originalEvent: args,\n            itemCollection: imageCommand\n        };\n        this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n            if (!actionBeginArgs.cancel) {\n                var command = actionBeginArgs.itemCollection;\n                var image_1 = createElement('img', {\n                    className: command.cssClass,\n                    attrs: { src: command.url, alt: command.altText }\n                });\n                image_1.style.opacity = '0.5';\n                image_1.classList.add(classes.CLS_RTE_IMAGE);\n                image_1.classList.add(classes.CLS_IMGINLINE);\n                image_1.classList.add(classes.CLS_RESIZE);\n                range.insertNode(image_1);\n                _this.uploadMethod(args, image_1);\n                image_1.addEventListener('load', function (e) {\n                    var actionCompleteArgs = {\n                        requestType: 'Image',\n                        name: 'InsertDropImage',\n                        elements: [image_1],\n                        event: e,\n                        editorMode: 'HTML'\n                    };\n                    _this.parent.trigger(events.actionComplete, actionCompleteArgs);\n                });\n                detach(parentElement);\n            }\n            else {\n                actionBeginArgs.originalEvent.preventDefault();\n            }\n        });\n    };\n    /**\n     * Rendering uploader and popup for drag and drop\n     *\n     * @param {DragEvent} dragEvent - specifies the event.\n     * @param {HTMLImageElement} imageElement - specifies the element.\n     * @returns {void}\n     */\n    Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n        var _this = this;\n        var isUploading = false;\n        // eslint-disable-next-line\n        var proxy = this;\n        var popupEle = this.parent.createElement('div');\n        this.parent.rootContainer.appendChild(popupEle);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }\n        });\n        var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n        this.popupObj = new Popup(popupEle, {\n            relateTo: imageElement,\n            height: '85px',\n            width: '300px',\n            offsetY: offsetY,\n            content: uploadEle,\n            viewPortElement: this.parent.element,\n            position: { X: 'center', Y: 'top' },\n            enableRtl: this.parent.enableRtl,\n            zIndex: 10001,\n            // eslint-disable-next-line\n            close: function (event) {\n                _this.parent.isBlur = false;\n                _this.popupObj.destroy();\n                detach(_this.popupObj.element);\n                _this.popupObj = null;\n                if (!_this.parent.inlineMode.enable) {\n                    _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n                }\n            }\n        });\n        this.popupObj.element.style.display = 'none';\n        addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n        addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n        if (!isNOU(this.parent.cssClass)) {\n            addClass([this.popupObj.element], this.parent.cssClass.replace(/\\s+/g, ' ').trim().split(' '));\n        }\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n        this.imageDragPopupTime = setTimeout(function () {\n            proxy.refreshPopup(imageElement);\n        }, timeOut);\n        this.uploadObj = new Uploader({\n            asyncSettings: {\n                saveUrl: this.parent.insertImageSettings.saveUrl,\n                removeUrl: this.parent.insertImageSettings.removeUrl\n            },\n            cssClass: classes.CLS_RTE_DIALOG_UPLOAD + this.parent.getCssClass(true),\n            dropArea: this.parent.element,\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            removing: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n            },\n            canceling: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n                _this.quickToolObj.imageQTBar.hidePopup();\n                _this.uploadCancelTime = setTimeout(function () {\n                    _this.uploadObj.destroy();\n                }, 900);\n            },\n            beforeUpload: function (args) {\n                _this.parent.trigger(events.beforeImageUpload, args);\n                if (!_this.parent.inlineMode.enable) {\n                    _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n                }\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    isUploading = true;\n                    _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n                        if (imageUploadingArgs.cancel) {\n                            if (!isNOU(imageElement)) {\n                                detach(imageElement);\n                            }\n                            if (!isNOU(_this.popupObj.element)) {\n                                detach(_this.popupObj.element);\n                            }\n                        }\n                        else {\n                            _this.parent.inputElement.contentEditable = 'false';\n                        }\n                    });\n                }\n            },\n            selected: function (e) {\n                if (isUploading) {\n                    e.cancel = true;\n                }\n            },\n            failure: function (e) {\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                _this.uploadFailureTime = setTimeout(function () {\n                    _this.uploadFailure(imageElement, args, e);\n                }, 900);\n            },\n            success: function (e) {\n                if (e.operation === 'cancel') {\n                    return;\n                }\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                _this.uploadSuccessTime = setTimeout(function () {\n                    _this.uploadSuccess(imageElement, dragEvent, args, e);\n                }, 900);\n            }\n        });\n        this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n        this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n        range.selectNodeContents(imageElement);\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n    };\n    Image.prototype.refreshPopup = function (imageElement) {\n        var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop +\n            imageElement.offsetTop : imageElement.offsetTop;\n        var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n        if (imgPosition > rtePosition) {\n            this.popupObj.relateTo = this.parent.inputElement;\n            this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n            this.popupObj.element.style.display = 'block';\n        }\n        else {\n            if (this.popupObj) {\n                this.popupObj.refreshPosition(imageElement);\n                this.popupObj.element.style.display = 'block';\n            }\n        }\n    };\n    /**\n     * Called when drop image upload was failed\n     *\n     * @param {HTMLElement} imgEle - specifies the image element.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {Object} e - specfies the object.\n     * @returns {void}\n     */\n    Image.prototype.uploadFailure = function (imgEle, args, e) {\n        detach(imgEle);\n        if (this.popupObj) {\n            this.popupObj.close();\n        }\n        this.parent.trigger(events.imageUploadFailed, e);\n        this.uploadObj.destroy();\n    };\n    /**\n     * Called when drop image upload was successful\n     *\n     * @param {HTMLElement} imageElement - specifies the image element.\n     * @param {DragEvent} dragEvent - specifies the drag event.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {ImageSuccessEventArgs} e - specifies the success event.\n     * @returns {void}\n     */\n    Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n        var _this = this;\n        imageElement.style.opacity = '1';\n        imageElement.classList.add(classes.CLS_IMG_FOCUS);\n        e.element = imageElement;\n        e.detectImageSource = ImageInputSource.Dropped;\n        this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n            if (!isNOU(_this.parent.insertImageSettings.path)) {\n                var url = _this.parent.insertImageSettings.path + e.file.name;\n                imageElement.src = url;\n                imageElement.setAttribute('alt', e.file.name);\n            }\n        });\n        if (this.popupObj) {\n            this.popupObj.close();\n            this.uploadObj.destroy();\n        }\n        this.showImageQuickToolbar(args);\n        this.resizeStart(dragEvent, imageElement);\n    };\n    Image.prototype.imagePaste = function (args) {\n        var _this = this;\n        if (args.text.length === 0 && !isNOU(args.file)) {\n            // eslint-disable-next-line\n            var proxy_1 = this;\n            var reader_2 = new FileReader();\n            args.args.preventDefault();\n            // eslint-disable-next-line\n            reader_2.addEventListener('load', function (e) {\n                var url = {\n                    cssClass: (proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                    url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNOU(args.callBack) ?\n                        reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n                    width: {\n                        width: proxy_1.parent.insertImageSettings.width, minWidth: proxy_1.parent.insertImageSettings.minWidth,\n                        maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n                    },\n                    height: {\n                        height: proxy_1.parent.insertImageSettings.height, minHeight: proxy_1.parent.insertImageSettings.minHeight,\n                        maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n                    }\n                };\n                if (!isNOU(args.callBack)) {\n                    args.callBack(url);\n                    return;\n                }\n                else {\n                    proxy_1.parent.formatter.process(proxy_1.parent, { item: { command: 'Images', subCommand: 'Image' } }, args.args, url);\n                    _this.showPopupToolBar(args, url);\n                }\n            });\n            reader_2.readAsDataURL(args.file);\n        }\n    };\n    Image.prototype.showPopupToolBar = function (e, url) {\n        var _this = this;\n        var imageSrc = 'img[src=\"' + url.url + '\"]';\n        var imageElement = this.parent.inputElement.querySelector(imageSrc);\n        this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n        var args = {\n            args: e.args,\n            type: 'Images',\n            isNotify: undefined,\n            elements: imageElement\n        };\n        if (imageElement) {\n            this.showImageQTbarTime = setTimeout(function () {\n                _this.showImageQuickToolbar(args);\n                if (_this.parent.insertImageSettings.resize) {\n                    _this.resizeStart(e.args, imageElement);\n                }\n            }, 0);\n        }\n    };\n    /* eslint-disable */\n    /**\n     * Destroys the ToolBar.\n     *\n     * @method destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    /* eslint-enable */\n    Image.prototype.destroy = function () {\n        if (this.isDestroyed) {\n            return;\n        }\n        this.prevSelectedImgEle = undefined;\n        if (!isNOU(this.imageQTPopupTime)) {\n            clearTimeout(this.imageQTPopupTime);\n            this.imageQTPopupTime = null;\n        }\n        if (!isNOU(this.imageDragPopupTime)) {\n            clearTimeout(this.imageDragPopupTime);\n            this.imageDragPopupTime = null;\n        }\n        if (!isNOU(this.uploadCancelTime)) {\n            clearTimeout(this.uploadCancelTime);\n            this.uploadCancelTime = null;\n        }\n        if (!isNOU(this.uploadFailureTime)) {\n            clearTimeout(this.uploadFailureTime);\n            this.uploadFailureTime = null;\n        }\n        if (!isNOU(this.showImageQTbarTime)) {\n            clearTimeout(this.showImageQTbarTime);\n            this.showImageQTbarTime = null;\n        }\n        if (!isNOU(this.uploadSuccessTime)) {\n            clearTimeout(this.uploadSuccessTime);\n            this.uploadSuccessTime = null;\n        }\n        this.removeEventListener();\n        this.clearDialogObj();\n        this.cancelResizeAction();\n        this.isDestroyed = true;\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {void}\n     */\n    Image.prototype.getModuleName = function () {\n        return 'image';\n    };\n    return Image;\n}());\nexport { Image };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
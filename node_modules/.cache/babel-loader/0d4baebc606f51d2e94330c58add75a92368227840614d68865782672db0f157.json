{"ast":null,"code":"import { isNullOrUndefined as isNOU, detach, Browser } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\n/**\n * `EnterKey` module is used to handle enter key press actions.\n */\nvar EnterKeyAction = /** @class */function () {\n  function EnterKeyAction(parent) {\n    this.parent = parent;\n    this.addEventListener();\n  }\n  EnterKeyAction.prototype.addEventListener = function () {\n    this.parent.on(events.enterHandler, this.enterHandler, this);\n    this.parent.on(events.destroy, this.destroy, this);\n  };\n  EnterKeyAction.prototype.destroy = function () {\n    if (isNOU(this.parent)) {\n      return;\n    }\n    this.removeEventListener();\n  };\n  EnterKeyAction.prototype.removeEventListener = function () {\n    this.parent.off(events.enterHandler, this.enterHandler);\n    this.parent.off(events.destroy, this.destroy);\n  };\n  EnterKeyAction.prototype.getRangeNode = function () {\n    this.range = this.parent.getRange();\n    this.startNode = this.range.startContainer.nodeName === '#text' ? this.range.startContainer.parentElement : this.range.startContainer;\n    this.endNode = this.range.endContainer.nodeName === '#text' ? this.range.endContainer.parentElement : this.range.endContainer;\n  };\n  EnterKeyAction.prototype.enterHandler = function (e) {\n    var _this = this;\n    this.getRangeNode();\n    var isTableEnter = true;\n    this.formatTags = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote'];\n    var tableImagCursor = this.processedTableImageCursor();\n    if (tableImagCursor.start || tableImagCursor.end) {\n      if (tableImagCursor.startName === 'TABLE' || tableImagCursor.endName === 'TABLE') {\n        // Default browser action prevented and hanled manually.\n        this.handleCursorAtTableSide(e, tableImagCursor.start, tableImagCursor.end);\n        return;\n      }\n    }\n    if (tableImagCursor.start || tableImagCursor.end || this.range.startContainer.nodeName === 'IMG') {\n      if (this.parent.enterKey === 'BR' && (tableImagCursor.startName === 'IMG' || tableImagCursor.endName === 'IMG' || this.range.startContainer.nodeName === 'IMG')) {\n        // Default browser action prevented and hanled manually.\n        this.handleEnterKeyAtImageSide(e, tableImagCursor.start, tableImagCursor.end);\n        return;\n      }\n    }\n    if (!isNOU(this.startNode.closest('TABLE')) && !isNOU(this.endNode.closest('TABLE'))) {\n      isTableEnter = false;\n      var curElement = this.startNode;\n      var blockElement = curElement;\n      while (!this.parent.formatter.editorManager.domNode.isBlockNode(curElement)) {\n        curElement = curElement.parentElement;\n        blockElement = curElement;\n      }\n      isTableEnter = blockElement.tagName === 'TH' || blockElement.tagName === 'TD' || blockElement.tagName === 'TBODY' ? false : true;\n    }\n    var eventArgs = e.args;\n    if (eventArgs.which === 13 && !eventArgs.ctrlKey && (!Browser.isDevice ? eventArgs.code === 'Enter' || eventArgs.code === 'NumpadEnter' : eventArgs.key === 'Enter')) {\n      if (isNOU(this.startNode.closest('LI, UL, OL')) && isNOU(this.endNode.closest('LI, UL, OL')) && isNOU(this.startNode.closest('.e-img-inner')) && isTableEnter && isNOU(this.startNode.closest('PRE')) && isNOU(this.endNode.closest('PRE')) && isNOU(this.startNode.closest('BLOCKQUOTE')) && isNOU(this.endNode.closest('BLOCKQUOTE'))) {\n        var shiftKey_1 = e.args.shiftKey;\n        var actionBeginArgs = {\n          cancel: false,\n          name: events.actionBegin,\n          requestType: shiftKey_1 ? 'ShiftEnterAction' : 'EnterAction',\n          originalEvent: e.args\n        };\n        this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n          if (!actionBeginArgs.cancel) {\n            if (_this.parent.formatter.getUndoRedoStack().length === 0) {\n              _this.parent.formatter.saveData();\n            }\n            if (!(_this.range.startOffset === _this.range.endOffset && _this.range.startContainer === _this.range.endContainer)) {\n              if (!(_this.range.startContainer.nodeName === 'SPAN' && (_this.range.startContainer.classList.contains('e-video-wrap') || _this.range.startContainer.classList.contains('e-audio-wrap')))) {\n                _this.range.deleteContents();\n              }\n              if (_this.range.startContainer.nodeName === '#text' && _this.range.startContainer.textContent.length === 0 && _this.range.startContainer.parentElement !== _this.parent.inputElement) {\n                if (_this.parent.enterKey === 'BR') {\n                  _this.range.startContainer.parentElement.innerHTML = '&#8203;';\n                } else {\n                  _this.range.startContainer.parentElement.innerHTML = '<br>';\n                }\n              } else if (_this.range.startContainer === _this.parent.inputElement && _this.range.startContainer.innerHTML === '') {\n                _this.range.startContainer.innerHTML = '<br>';\n                var focusElem = _this.range.startContainer.childNodes[_this.range.startOffset];\n                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, 0);\n              } else if (_this.parent.inputElement === _this.range.startContainer) {\n                var focusElem = _this.range.startContainer.childNodes[_this.range.startOffset];\n                if (focusElem.nodeName === '#text' && focusElem.textContent.length === 0) {\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, focusElem.textContent.length === 0 ? 0 : focusElem.previousSibling.textContent.length);\n                } else {\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, focusElem.textContent.length >= 0 ? 0 : 1);\n                  if (focusElem.previousSibling.textContent.length === 0) {\n                    detach(focusElem.previousSibling);\n                    if (!shiftKey_1) {\n                      var currentFocusElem = !isNOU(focusElem.lastChild) ? focusElem.lastChild : focusElem;\n                      while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text' && currentFocusElem.nodeName !== 'BR') {\n                        currentFocusElem = currentFocusElem.lastChild;\n                      }\n                      if (currentFocusElem.nodeName !== 'BR' && currentFocusElem.parentElement.textContent.length === 0 && currentFocusElem.parentElement.innerHTML.length === 0 && currentFocusElem.parentElement.nodeName !== 'BR') {\n                        currentFocusElem.parentElement.appendChild(_this.parent.createElement('BR'));\n                      }\n                      _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentFocusElem.nodeName === 'BR' ? currentFocusElem : currentFocusElem.parentElement, currentFocusElem.parentElement.textContent.length >= 0 || currentFocusElem.nodeName === 'BR' ? 0 : 1);\n                    }\n                  } else if (focusElem.textContent.length === 0) {\n                    var currentFocusElem = focusElem.previousSibling.nodeName === '#text' ? focusElem.previousSibling : focusElem.previousSibling.lastChild;\n                    while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text') {\n                      currentFocusElem = currentFocusElem.lastChild;\n                    }\n                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentFocusElem, currentFocusElem.textContent.length);\n                    detach(focusElem);\n                  } else if (_this.parent.enterKey !== 'BR' && focusElem.previousSibling.textContent.length !== 0 && focusElem.textContent.length !== 0) {\n                    e.args.preventDefault();\n                    return;\n                  }\n                }\n                _this.getRangeNode();\n              }\n            }\n            if (_this.range.startContainer === _this.range.endContainer && _this.range.startOffset === _this.range.endOffset && _this.range.startContainer === _this.parent.inputElement) {\n              if (!(_this.parent.inputElement.childNodes.length === 1 && _this.parent.inputElement.childNodes[0].nodeName === 'TABLE')) {\n                if (isNOU(_this.range.startContainer.childNodes[_this.range.startOffset])) {\n                  var currentLastElem = _this.range.startContainer.childNodes[_this.range.startOffset - 1];\n                  while (currentLastElem.lastChild !== null && currentLastElem.nodeName !== '#text') {\n                    currentLastElem = currentLastElem.lastChild;\n                  }\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentLastElem, currentLastElem.nodeName === 'BR' ? 0 : currentLastElem.textContent.length);\n                } else {\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.range.startContainer.childNodes[_this.range.startOffset], 0);\n                }\n              }\n              _this.getRangeNode();\n            }\n            if (_this.parent.enterKey === 'P' && !shiftKey_1 || _this.parent.enterKey === 'DIV' && !shiftKey_1 || _this.parent.shiftEnterKey === 'P' && shiftKey_1 || _this.parent.shiftEnterKey === 'DIV' && shiftKey_1) {\n              if (_this.range.startOffset === 1 && _this.parent.inputElement.childNodes.length === 1 && _this.parent.inputElement.childNodes[0].nodeName === 'TABLE' || _this.parent.enterKey === 'BR' && shiftKey_1) {\n                var newElem = _this.createInsertElement(shiftKey_1);\n                newElem.appendChild(_this.parent.createElement('BR'));\n                _this.parent.inputElement.appendChild(newElem);\n                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElem, 0);\n              } else {\n                var nearBlockNode = void 0;\n                if (isTableEnter && _this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode)) {\n                  if (_this.range.startContainer.nodeName === '#text' && !isNOU(_this.range.startContainer.previousSibling) && _this.range.startContainer.previousSibling.nodeName === 'HR') {\n                    nearBlockNode = _this.range.startContainer.nextSibling;\n                  } else {\n                    nearBlockNode = _this.startNode;\n                  }\n                } else {\n                  nearBlockNode = _this.parent.formatter.editorManager.domNode.blockParentNode(_this.startNode);\n                }\n                var isMediaNode = false; // To check the image audio and video node cases\n                var isFocusedFirst = false;\n                var parentElement = _this.range.startContainer.parentElement;\n                var isPreWrapApplied = parentElement ? _this.parent.contentModule.getDocument().defaultView.getComputedStyle(_this.range.startContainer.parentElement, null).getPropertyValue('white-space') === 'pre-wrap' : false;\n                if (_this.range.startOffset !== 0 && _this.range.endOffset !== 0 && _this.range.startContainer === _this.range.endContainer && !(!isNOU(nearBlockNode.childNodes[0]) && (nearBlockNode.childNodes[0].nodeName === 'IMG' || nearBlockNode.querySelectorAll('img, audio, video').length > 0))) {\n                  var startNodeText = _this.range.startContainer.textContent;\n                  var splitFirstText = startNodeText.substring(0, _this.range.startOffset);\n                  var lastCharBeforeCursor = splitFirstText.charCodeAt(_this.range.startOffset - 1);\n                  var isSplitTextEmpty = splitFirstText.trim().length === 0;\n                  var hasContentAfterCursor = startNodeText.slice(_this.range.startOffset).trim().length !== 0;\n                  var isCursorAtStartNonPreWrap = lastCharBeforeCursor !== 160 && isSplitTextEmpty && !isPreWrapApplied;\n                  var isCursorAtStartPreWrapWithContent = lastCharBeforeCursor === 32 && isPreWrapApplied && isSplitTextEmpty && hasContentAfterCursor;\n                  if (isCursorAtStartNonPreWrap || isCursorAtStartPreWrapWithContent) {\n                    isFocusedFirst = true;\n                  }\n                } else if (_this.range.startOffset === 0 && _this.range.endOffset === 0) {\n                  isFocusedFirst = true;\n                }\n                _this.removeBRElement(nearBlockNode);\n                var fireFoxEnterAtMiddle = Browser.userAgent.indexOf('Firefox') !== -1 && _this.range.startOffset === 0 && _this.range.startContainer === _this.range.endContainer && _this.range.startContainer.nodeName === '#text' && !_this.parent.formatter.editorManager.domNode.isBlockNode(_this.range.startContainer.previousSibling) && _this.range.startContainer.parentElement === _this.range.startContainer.previousSibling.parentElement;\n                var preventZeroWithSpace = _this.range.startContainer.nodeName === '#text' && _this.range.startContainer.textContent.includes('\\u200B') && _this.range.startContainer.textContent.trim() === '\\u200B' || _this.range.startContainer.nodeName === '#text' && !isNOU(_this.range.startContainer.textContent[_this.range.startOffset]) && _this.range.startContainer.textContent[_this.range.startOffset].includes('\\u200B') && _this.range.startContainer.textContent[_this.range.startOffset] === '\\u200B' && _this.parent.inputElement.textContent[0] !== '\\u200B';\n                // eslint-disable-next-line max-len\n                if (!preventZeroWithSpace && !fireFoxEnterAtMiddle && (_this.range.startOffset === 0 && _this.range.endOffset === 0 || isFocusedFirst) && !(!isNOU(_this.range.startContainer.previousSibling) && (_this.range.startContainer.previousSibling.nodeName === 'IMG' || _this.range.startContainer.previousSibling.nodeName === 'BR'))) {\n                  var isNearBlockLengthZero = void 0;\n                  var newElem = void 0;\n                  if (!isNOU(_this.range.startContainer.childNodes) && (_this.range.startContainer.textContent.length === 0 || _this.range.startContainer.nodeName !== '#text' && !isNOU(_this.range.startContainer.querySelector('.e-video-clickelem')) && _this.range.startContainer.querySelector('.e-video-clickelem').textContent.length === 0) && (_this.range.startContainer.querySelectorAll('img, audio, video').length > 0 || !isNOU(_this.range.startContainer.querySelector('.e-video-clickelem')) || _this.range.startContainer.nodeName === 'IMG' || _this.range.startContainer.nodeName === 'TABLE')) {\n                    newElem = _this.createInsertElement(shiftKey_1);\n                    isMediaNode = true;\n                    isNearBlockLengthZero = false;\n                  } else {\n                    if (nearBlockNode.textContent.trim().length !== 0 || !isNOU(nearBlockNode.childNodes[0]) && nearBlockNode.childNodes[0].nodeName === 'IMG' || nearBlockNode.textContent.trim() === '' && nearBlockNode.querySelectorAll('img, audio, video').length > 0) {\n                      if (_this.range.startOffset === _this.range.endOffset && _this.range.startOffset !== 0) {\n                        newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, false).cloneNode(true);\n                      } else {\n                        newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true).cloneNode(true);\n                        isMediaNode = true;\n                      }\n                      isNearBlockLengthZero = false;\n                    } else {\n                      newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true).cloneNode(true);\n                      isNearBlockLengthZero = true;\n                    }\n                  }\n                  var insertElem = void 0;\n                  if (_this.formatTags.indexOf(newElem.nodeName.toLocaleLowerCase()) < 0) {\n                    insertElem = _this.createInsertElement(shiftKey_1);\n                  } else {\n                    insertElem = _this.parent.createElement(newElem.nodeName);\n                  }\n                  while (newElem.firstChild) {\n                    insertElem.appendChild(newElem.firstChild);\n                  }\n                  nearBlockNode.parentElement.insertBefore(insertElem, nearBlockNode);\n                  if (!isNearBlockLengthZero) {\n                    var currentFocusElem = insertElem;\n                    var finalFocusElem = void 0;\n                    if (_this.range.startOffset === _this.range.endOffset && _this.range.startOffset !== 0) {\n                      while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text' && currentFocusElem.nodeName !== 'BR') {\n                        finalFocusElem = currentFocusElem;\n                        currentFocusElem = currentFocusElem.lastChild;\n                      }\n                    } else {\n                      finalFocusElem = currentFocusElem;\n                    }\n                    finalFocusElem.innerHTML = '<br>';\n                    if (!isMediaNode) {\n                      detach(nearBlockNode);\n                    }\n                  }\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), insertElem.nextElementSibling, 0);\n                } else if (nearBlockNode.textContent.length === 0 && !(!isNOU(nearBlockNode.childNodes[0]) && nearBlockNode.childNodes[0].nodeName === 'IMG' || nearBlockNode.querySelectorAll('video').length > 0 || nearBlockNode.querySelectorAll('audio').length > 0 || nearBlockNode.querySelectorAll('img').length > 0)) {\n                  if (!isNOU(nearBlockNode.children[0]) && nearBlockNode.children[0].tagName !== 'BR') {\n                    var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, false).cloneNode(true);\n                    _this.parent.formatter.editorManager.domNode.insertAfter(newElem, nearBlockNode);\n                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElem, newElem.textContent.length >= 0 ? 0 : 1);\n                  } else {\n                    var insertElem = _this.createInsertElement(shiftKey_1);\n                    insertElem.innerHTML = '<br>';\n                    _this.parent.formatter.editorManager.domNode.insertAfter(insertElem, nearBlockNode);\n                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), insertElem, 0);\n                  }\n                } else if (_this.range.startContainer === _this.range.endContainer && _this.range.startContainer.nodeName === 'SPAN' && (_this.range.startContainer.classList.contains('e-video-wrap') || _this.range.startContainer.classList.contains('e-audio-wrap'))) {\n                  if (nearBlockNode.textContent.trim().length > 0) {\n                    var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true);\n                    var audioVideoElem = !isNOU(newElem.previousSibling.querySelector('.e-video-wrap')) ? newElem.previousSibling.querySelector('.e-video-wrap') : newElem.previousSibling.querySelector('.e-audio-wrap');\n                    var isBRInserted = false;\n                    var lastNode = audioVideoElem.previousSibling;\n                    while (!isNOU(lastNode) && lastNode.nodeName !== '#text') {\n                      lastNode = lastNode.lastChild;\n                    }\n                    if (isNOU(lastNode)) {\n                      var brElm = _this.parent.createElement('br');\n                      audioVideoElem.parentElement.appendChild(brElm);\n                      isBRInserted = true;\n                    }\n                    if (isBRInserted) {\n                      _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), audioVideoElem.parentElement, 0);\n                    } else {\n                      _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), lastNode, lastNode.textContent.length);\n                    }\n                    detach(audioVideoElem);\n                  } else {\n                    var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true);\n                    var focusElem = newElem.previousSibling;\n                    while (!isNOU(focusElem.firstChild)) {\n                      detach(focusElem.firstChild);\n                    }\n                    var brElm = _this.parent.createElement('br');\n                    focusElem.appendChild(brElm);\n                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, 0);\n                  }\n                  if (!isNOU(_this.parent.audioModule)) {\n                    _this.parent.audioModule.hideAudioQuickToolbar();\n                  }\n                  if (!isNOU(_this.parent.videoModule)) {\n                    _this.parent.videoModule.hideVideoQuickToolbar();\n                  }\n                } else {\n                  var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true);\n                  if (!isNOU(newElem.childNodes[0]) && newElem.childNodes[0].nodeName === '#text' && newElem.childNodes[0].textContent.length === 0) {\n                    detach(newElem.childNodes[0]);\n                  }\n                  if (newElem.textContent.trim().length === 0 || newElem.childNodes[0].textContent.trim().includes('\\u200B') && newElem.childNodes[0].textContent.trim() === '\\u200B') {\n                    var brElm = _this.parent.createElement('br');\n                    if (_this.startNode.nodeName === 'A') {\n                      var startParentElem = _this.startNode.parentElement;\n                      _this.startNode.parentElement.insertBefore(brElm, _this.startNode);\n                      detach(_this.startNode);\n                      _this.startNode = startParentElem;\n                    } else {\n                      if (_this.startNode.nodeName !== 'BR') {\n                        _this.startNode.appendChild(brElm);\n                      }\n                    }\n                    if (newElem.childNodes[0].textContent === '\\n') {\n                      detach(newElem.childNodes[0]);\n                    }\n                    if (newElem.childNodes[0].textContent.trim().includes('\\u200B') && newElem.childNodes[0].textContent.trim() === '\\u200B') {\n                      detach(newElem.childNodes[0]);\n                    }\n                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.startNode, 0);\n                  }\n                  if ((_this.parent.enterKey === 'P' || _this.parent.enterKey === 'DIV') && !shiftKey_1 || (_this.parent.shiftEnterKey === 'DIV' || _this.parent.shiftEnterKey === 'P') && shiftKey_1) {\n                    var isHeadingTag = _this.formatTags.indexOf(newElem.nodeName.toLocaleLowerCase());\n                    if (isHeadingTag < 0 || isHeadingTag >= 0 && newElem.textContent.trim().length === 0) {\n                      var insertElm = _this.createInsertElement(shiftKey_1);\n                      while (newElem.firstChild) {\n                        insertElm.appendChild(newElem.firstChild);\n                      }\n                      _this.parent.formatter.editorManager.domNode.insertAfter(insertElm, newElem);\n                      detach(newElem);\n                      _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode) ? insertElm : _this.startNode, 0);\n                    }\n                  }\n                }\n              }\n              e.args.preventDefault();\n            }\n            if (_this.parent.enterKey === 'BR' && !shiftKey_1 || _this.parent.shiftEnterKey === 'BR' && shiftKey_1) {\n              var currentParent = void 0;\n              if (!_this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode)) {\n                var currentNode = _this.startNode;\n                var previousNode = currentNode;\n                while (!_this.parent.formatter.editorManager.domNode.isBlockNode(currentNode)) {\n                  previousNode = currentNode;\n                  currentNode = currentNode.parentElement;\n                }\n                currentParent = currentNode === _this.parent.inputElement ? previousNode : currentNode;\n              } else {\n                currentParent = _this.startNode;\n              }\n              var currentParentStyle = window.getComputedStyle(currentParent);\n              _this.removeBRElement(currentParent);\n              var isEmptyBrInserted = false;\n              var currentParentLastChild = currentParent.lastChild;\n              while (!isNOU(currentParentLastChild) && !(currentParentLastChild.nodeName === '#text' || currentParentLastChild.nodeName === 'BR' || currentParentLastChild.nodeName === 'IMG')) {\n                currentParentLastChild = currentParentLastChild.lastChild;\n              }\n              var isLastNodeLength = _this.range.startContainer === currentParentLastChild ? _this.range.startContainer.textContent.length : currentParent.textContent.length;\n              var isImageElement = _this.range.startContainer.nodeName === 'IMG' || _this.range.startContainer.childNodes.length > 0 && _this.range.startContainer.childNodes[_this.range.startOffset].nodeName === 'IMG';\n              if (currentParent !== _this.parent.inputElement && _this.parent.formatter.editorManager.domNode.isBlockNode(currentParent) && _this.range.startOffset === _this.range.endOffset && (_this.range.startOffset === isLastNodeLength || currentParent.textContent.trim().length === 0 && isImageElement)) {\n                var focusBRElem = _this.parent.createElement('br');\n                if (_this.range.startOffset === 0 && _this.range.startContainer.nodeName === 'TABLE') {\n                  _this.range.startContainer.parentElement.insertBefore(focusBRElem, _this.range.startContainer);\n                } else {\n                  if (currentParentLastChild.nodeName === 'BR' && currentParent.textContent.length === 0) {\n                    _this.parent.formatter.editorManager.domNode.insertAfter(focusBRElem, currentParentLastChild);\n                  } else if (_this.range.startOffset === 0 && _this.range.endOffset === 0 && isImageElement) {\n                    var imageElement = _this.range.startContainer.nodeName === 'IMG' ? _this.range.startContainer : _this.range.startContainer.childNodes[_this.range.startOffset];\n                    currentParent.insertBefore(focusBRElem, imageElement);\n                    focusBRElem = imageElement;\n                  } else {\n                    var lineBreakBRElem = _this.parent.createElement('br');\n                    var anchorElement = !isNOU(_this.range.startContainer.parentElement) && _this.range.startContainer.parentElement.nodeName === 'A' && _this.range.startContainer.parentElement.textContent.length === _this.range.startOffset ? _this.range.startContainer.parentElement : _this.range.startContainer;\n                    _this.parent.formatter.editorManager.domNode.insertAfter(focusBRElem, anchorElement);\n                    _this.parent.formatter.editorManager.domNode.insertAfter(lineBreakBRElem, anchorElement);\n                    var brSibling = anchorElement.nextElementSibling;\n                    var brNextSibling = !isNOU(brSibling) ? brSibling.nextElementSibling : null;\n                    if (!isNOU(brSibling) && !isNOU(brNextSibling) && !isNOU(brNextSibling.nextElementSibling) && brSibling.nodeName === 'BR' && brNextSibling.nodeName === 'BR' && brNextSibling.nextElementSibling.nodeName === 'BR') {\n                      brNextSibling.nextElementSibling.remove();\n                    }\n                  }\n                }\n                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusBRElem, 0);\n              } else if (!isNOU(currentParent) && currentParent !== _this.parent.inputElement && currentParent.nodeName !== 'BR') {\n                if (currentParent.textContent.trim().length === 0 || currentParent.textContent.trim().length === 1 && currentParent.textContent.charCodeAt(0) === 8203) {\n                  if (currentParent.childElementCount > 1 && currentParent.lastElementChild.nodeName === 'IMG') {\n                    _this.insertBRElement();\n                  } else {\n                    var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, currentParent, true).cloneNode(true);\n                    _this.parent.formatter.editorManager.domNode.insertAfter(newElem, currentParent);\n                    var outerBRElem = _this.parent.createElement('br');\n                    newElem.parentElement.insertBefore(outerBRElem, newElem);\n                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElem, 0);\n                  }\n                } else {\n                  var newElem = void 0;\n                  var outerBRElem = _this.parent.createElement('br');\n                  if (_this.range.startOffset === 0 && _this.range.endOffset === 0 && !isNOU(currentParent.previousSibling) && currentParent.previousSibling.nodeName === 'BR' && currentParent.nodeName !== 'P' && currentParent.nodeName !== 'DIV') {\n                    newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, currentParent, false).cloneNode(true);\n                    _this.parent.formatter.editorManager.domNode.insertAfter(outerBRElem, currentParent);\n                    _this.insertFocusContent();\n                    var currentFocusElem = outerBRElem.nextSibling;\n                    while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text') {\n                      currentFocusElem = currentFocusElem.lastChild;\n                    }\n                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentFocusElem, 0);\n                    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                    isEmptyBrInserted = true;\n                  } else if (currentParent !== _this.parent.inputElement && (currentParentStyle.display === 'inline' || currentParentStyle.display === 'inline-block')) {\n                    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                    newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, currentParent, true).cloneNode(true);\n                    currentParent.parentElement.insertBefore(outerBRElem, currentParent);\n                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentParent, 0);\n                    _this.insertFocusContent();\n                  } else {\n                    _this.insertBRElement();\n                  }\n                }\n              } else {\n                _this.insertBRElement();\n              }\n              e.args.preventDefault();\n            }\n            _this.triggerActionComplete(e, shiftKey_1);\n            _this.parent.inputElement.dispatchEvent(new Event('input'));\n          }\n        });\n      }\n    }\n  };\n  EnterKeyAction.prototype.removeBRElement = function (currentElement) {\n    if (Browser.userAgent.indexOf('Firefox') !== -1 && this.range.endOffset === currentElement.textContent.length && (currentElement.textContent.length !== 0 || currentElement.querySelectorAll('BR').length > 1) && !isNOU(currentElement.lastChild) && currentElement.lastChild.nodeName === 'BR') {\n      detach(currentElement.lastChild);\n    }\n  };\n  EnterKeyAction.prototype.insertBRElement = function () {\n    var isEmptyBrInserted = false;\n    var isFocusTextNode = true;\n    if (this.range.endContainer.textContent.length === 0 && this.range.startContainer.nodeName === 'BR') {\n      isFocusTextNode = false;\n    }\n    var brElm = this.parent.createElement('br');\n    var findAnchorLastChild = this.startNode;\n    while (findAnchorLastChild.lastChild) {\n      findAnchorLastChild = findAnchorLastChild.lastChild;\n    }\n    var findAnchorElement = this.startNode.nodeName === 'A' && this.endNode.nodeName === 'A' && !isNOU(this.range.startContainer.parentElement) && this.range.startOffset === this.range.endOffset && this.range.startContainer.textContent.trim().length === findAnchorLastChild.textContent.trim().length;\n    if (this.startNode.nodeName === 'BR' && this.endNode.nodeName === 'BR' && this.range.startOffset === 0 && this.range.startOffset === this.range.endOffset) {\n      this.parent.formatter.editorManager.domNode.insertAfter(brElm, this.startNode);\n      isEmptyBrInserted = true;\n    } else {\n      if (this.startNode === this.parent.inputElement && !isNOU(this.range.startContainer.previousSibling) && this.range.startContainer.previousSibling.nodeName === 'BR' && this.range.startContainer.textContent.length === 0) {\n        isEmptyBrInserted = true;\n      }\n      if (findAnchorElement) {\n        this.parent.formatter.editorManager.domNode.insertAfter(brElm, this.startNode);\n      } else {\n        this.range.insertNode(brElm);\n      }\n    }\n    if (isEmptyBrInserted || !isNOU(brElm.nextElementSibling) && brElm.nextElementSibling.tagName === 'BR' || !isNOU(brElm.nextSibling) && (brElm.nextSibling.textContent.length > 0 || brElm.nextSibling.nodeName === '#text' && brElm.nextSibling.textContent.trim().length === 0 && !isNOU(brElm.nextSibling.nextSibling) && brElm.nextSibling.nextSibling.textContent.trim().length > 0)) {\n      this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), !isNOU(brElm.nextSibling) && isFocusTextNode ? brElm.nextSibling : brElm, 0);\n      isEmptyBrInserted = false;\n    } else {\n      var brElements = this.parent.createElement('br');\n      if (findAnchorElement) {\n        this.parent.formatter.editorManager.domNode.insertAfter(brElements, this.startNode);\n      } else {\n        this.range.insertNode(brElements);\n      }\n      this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), brElm, 0);\n    }\n  };\n  EnterKeyAction.prototype.insertFocusContent = function () {\n    if (this.range.startContainer.textContent.length === 0) {\n      if (this.range.startContainer.nodeName === '#text') {\n        this.range.startContainer.parentElement.innerHTML = '&#8203;';\n      } else {\n        this.range.startContainer.innerHTML = '&#8203;';\n      }\n    }\n  };\n  EnterKeyAction.prototype.createInsertElement = function (shiftKey) {\n    var insertElem;\n    if (this.parent.enterKey === 'DIV' && !shiftKey || this.parent.shiftEnterKey === 'DIV' && shiftKey) {\n      insertElem = this.parent.createElement('div');\n    } else if (this.parent.enterKey === 'P' && !shiftKey || this.parent.shiftEnterKey === 'P' && shiftKey) {\n      insertElem = this.parent.createElement('p');\n    }\n    var previousBlockNode = this.parent.formatter.editorManager.domNode.blockNodes()[0].previousSibling;\n    var nextBlockNode = this.parent.formatter.editorManager.domNode.blockNodes()[0].nextSibling;\n    if (!isNOU(previousBlockNode) && previousBlockNode.nodeName !== '#text' && previousBlockNode.hasAttribute('style') && previousBlockNode.nodeName !== 'TABLE') {\n      insertElem.setAttribute('style', previousBlockNode.getAttribute('style'));\n    }\n    if (isNOU(previousBlockNode) && !isNOU(nextBlockNode) && nextBlockNode.nodeName !== '#text' && nextBlockNode.hasAttribute('style') && nextBlockNode.nodeName !== 'TABLE') {\n      insertElem.setAttribute('style', nextBlockNode.getAttribute('style'));\n    }\n    return insertElem;\n  };\n  EnterKeyAction.prototype.triggerActionComplete = function (e, shiftKey) {\n    this.parent.trigger(events.actionComplete, {\n      requestType: shiftKey ? 'ShiftEnterAction' : 'EnterAction',\n      args: e.args\n    });\n  };\n  EnterKeyAction.prototype.handleCursorAtTableSide = function (e, isStart, isEnd) {\n    var _this = this;\n    if (this.parent.enterKey !== 'BR') {\n      var shiftKey_2 = e.args.shiftKey;\n      var actionBeginArgs = {\n        cancel: false,\n        name: events.actionBegin,\n        requestType: shiftKey_2 ? 'ShiftEnterAction' : 'EnterAction',\n        originalEvent: e.args\n      };\n      this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n        if (!actionBeginArgs.cancel) {\n          var newElement = _this.parent.createElement(_this.parent.enterKey);\n          newElement.innerHTML = '<br>';\n          var tableElement = void 0;\n          if (isStart) {\n            tableElement = _this.range.startContainer.childNodes[_this.range.startOffset];\n            tableElement.parentElement.insertBefore(newElement, tableElement);\n          }\n          if (isEnd) {\n            tableElement = _this.range.startContainer.childNodes[_this.range.startOffset - 1];\n            if (!isNOU(tableElement.nextSibling)) {\n              tableElement.parentElement.insertBefore(newElement, tableElement.nextSibling);\n            } else if (isNOU(tableElement.nextSibling)) {\n              tableElement.parentElement.appendChild(newElement);\n            }\n          }\n          _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElement, 0);\n          e.args.preventDefault();\n          _this.triggerActionComplete(e, shiftKey_2);\n        }\n      });\n    }\n  };\n  EnterKeyAction.prototype.handleEnterKeyAtImageSide = function (e, isStart, isEnd) {\n    var _this = this;\n    var actionBeginArgs = {\n      cancel: false,\n      name: events.actionBegin,\n      requestType: e.args.shiftKey ? 'ShiftEnterAction' : 'EnterAction',\n      originalEvent: e.args\n    };\n    var directRange = false;\n    if (this.range.startContainer.nodeName === 'IMG' && this.range.startOffset === 0) {\n      directRange = true;\n    }\n    this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n      if (!actionBeginArgs.cancel) {\n        if (_this.parent.enterKey === 'BR') {\n          var newElement = _this.parent.createElement('BR');\n          var imageElement = void 0;\n          if (directRange) {\n            imageElement = _this.range.startContainer;\n            imageElement.parentElement.insertBefore(newElement, imageElement);\n            _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), imageElement, 0);\n          }\n          if (isStart) {\n            imageElement = _this.range.startContainer.childNodes[_this.range.startOffset];\n            imageElement.parentElement.insertBefore(newElement, imageElement);\n            _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), imageElement, 0);\n          }\n          if (isEnd) {\n            imageElement = _this.range.startContainer.childNodes[_this.range.startOffset - 1];\n            if (!isNOU(imageElement.nextSibling)) {\n              imageElement.parentElement.insertBefore(newElement, imageElement.nextSibling);\n              _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElement.nextSibling, 0);\n            } else if (isNOU(imageElement.nextSibling)) {\n              imageElement.parentElement.appendChild(newElement);\n              var brElement = _this.parent.createElement('BR');\n              imageElement.parentElement.appendChild(brElement);\n              _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), brElement, 0);\n            }\n          }\n          e.args.preventDefault();\n          _this.triggerActionComplete(e, e.args.shiftKey);\n        }\n      }\n    });\n  };\n  EnterKeyAction.prototype.isTableOrImageStart = function () {\n    var customHandlerElements = ['IMG', 'TABLE'];\n    var startContainer = this.range.startContainer;\n    var startOffset = this.range.startOffset;\n    var isCursorAtStart = this.range.collapsed && startContainer.nodeType === 1 && startContainer.isContentEditable && startContainer.childNodes[startOffset] && customHandlerElements.indexOf(startContainer.childNodes[startOffset].nodeName) > -1;\n    if (isCursorAtStart) {\n      return {\n        start: isCursorAtStart,\n        startNodeName: startContainer.childNodes[startOffset].nodeName\n      };\n    } else {\n      return {\n        start: false,\n        startNodeName: ''\n      };\n    }\n  };\n  EnterKeyAction.prototype.isTableOrImageEnd = function () {\n    var customHandlerElements = ['IMG', 'TABLE'];\n    var startContainer = this.range.startContainer;\n    var startOffset = this.range.startOffset;\n    var isCursorAtEnd = this.range.collapsed && startContainer.nodeType === 1 && startContainer.isContentEditable && startContainer.childNodes[startOffset - 1] && customHandlerElements.indexOf(startContainer.childNodes[startOffset - 1].nodeName) > -1;\n    if (isCursorAtEnd) {\n      return {\n        end: isCursorAtEnd,\n        endNodeName: startContainer.childNodes[startOffset - 1].nodeName\n      };\n    } else {\n      return {\n        end: false,\n        endNodeName: ''\n      };\n    }\n  };\n  EnterKeyAction.prototype.processedTableImageCursor = function () {\n    var _a = this.isTableOrImageStart(),\n      start = _a.start,\n      startNodeName = _a.startNodeName;\n    var _b = this.isTableOrImageEnd(),\n      end = _b.end,\n      endNodeName = _b.endNodeName;\n    return {\n      start: start,\n      startName: startNodeName,\n      end: end,\n      endName: endNodeName\n    };\n  };\n  return EnterKeyAction;\n}();\nexport { EnterKeyAction };","map":{"version":3,"names":["isNullOrUndefined","isNOU","detach","Browser","events","EnterKeyAction","parent","addEventListener","prototype","on","enterHandler","destroy","removeEventListener","off","getRangeNode","range","getRange","startNode","startContainer","nodeName","parentElement","endNode","endContainer","e","_this","isTableEnter","formatTags","tableImagCursor","processedTableImageCursor","start","end","startName","endName","handleCursorAtTableSide","enterKey","handleEnterKeyAtImageSide","closest","curElement","blockElement","formatter","editorManager","domNode","isBlockNode","tagName","eventArgs","args","which","ctrlKey","isDevice","code","key","shiftKey_1","shiftKey","actionBeginArgs","cancel","name","actionBegin","requestType","originalEvent","trigger","getUndoRedoStack","length","saveData","startOffset","endOffset","classList","contains","deleteContents","textContent","inputElement","innerHTML","focusElem","childNodes","nodeSelection","setCursorPoint","contentModule","getDocument","previousSibling","currentFocusElem","lastChild","appendChild","createElement","preventDefault","currentLastElem","shiftEnterKey","newElem","createInsertElement","nearBlockNode","nextSibling","blockParentNode","isMediaNode","isFocusedFirst","isPreWrapApplied","defaultView","getComputedStyle","getPropertyValue","querySelectorAll","startNodeText","splitFirstText","substring","lastCharBeforeCursor","charCodeAt","isSplitTextEmpty","trim","hasContentAfterCursor","slice","isCursorAtStartNonPreWrap","isCursorAtStartPreWrapWithContent","removeBRElement","fireFoxEnterAtMiddle","userAgent","indexOf","preventZeroWithSpace","includes","isNearBlockLengthZero","querySelector","nodeCutter","SplitNode","cloneNode","insertElem","toLocaleLowerCase","firstChild","insertBefore","finalFocusElem","nextElementSibling","children","insertAfter","audioVideoElem","isBRInserted","lastNode","brElm","audioModule","hideAudioQuickToolbar","videoModule","hideVideoQuickToolbar","startParentElem","isHeadingTag","insertElm","currentParent","currentNode","previousNode","currentParentStyle","window","isEmptyBrInserted","currentParentLastChild","isLastNodeLength","isImageElement","focusBRElem","imageElement","lineBreakBRElem","anchorElement","brSibling","brNextSibling","remove","childElementCount","lastElementChild","insertBRElement","outerBRElem","insertFocusContent","display","triggerActionComplete","dispatchEvent","Event","currentElement","isFocusTextNode","findAnchorLastChild","findAnchorElement","insertNode","brElements","previousBlockNode","blockNodes","nextBlockNode","hasAttribute","setAttribute","getAttribute","actionComplete","isStart","isEnd","shiftKey_2","newElement","tableElement","directRange","brElement","isTableOrImageStart","customHandlerElements","isCursorAtStart","collapsed","nodeType","isContentEditable","startNodeName","isTableOrImageEnd","isCursorAtEnd","endNodeName","_a","_b"],"sources":["/var/www/vue/vue-gantt-chart/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/actions/enter-key.js"],"sourcesContent":["import { isNullOrUndefined as isNOU, detach, Browser } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\n/**\n * `EnterKey` module is used to handle enter key press actions.\n */\nvar EnterKeyAction = /** @class */ (function () {\n    function EnterKeyAction(parent) {\n        this.parent = parent;\n        this.addEventListener();\n    }\n    EnterKeyAction.prototype.addEventListener = function () {\n        this.parent.on(events.enterHandler, this.enterHandler, this);\n        this.parent.on(events.destroy, this.destroy, this);\n    };\n    EnterKeyAction.prototype.destroy = function () {\n        if (isNOU(this.parent)) {\n            return;\n        }\n        this.removeEventListener();\n    };\n    EnterKeyAction.prototype.removeEventListener = function () {\n        this.parent.off(events.enterHandler, this.enterHandler);\n        this.parent.off(events.destroy, this.destroy);\n    };\n    EnterKeyAction.prototype.getRangeNode = function () {\n        this.range = this.parent.getRange();\n        this.startNode = this.range.startContainer.nodeName === '#text' ? this.range.startContainer.parentElement :\n            this.range.startContainer;\n        this.endNode = this.range.endContainer.nodeName === '#text' ? this.range.endContainer.parentElement :\n            this.range.endContainer;\n    };\n    EnterKeyAction.prototype.enterHandler = function (e) {\n        var _this = this;\n        this.getRangeNode();\n        var isTableEnter = true;\n        this.formatTags = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote'];\n        var tableImagCursor = this.processedTableImageCursor();\n        if (tableImagCursor.start || tableImagCursor.end) {\n            if (tableImagCursor.startName === 'TABLE' || tableImagCursor.endName === 'TABLE') { // Default browser action prevented and hanled manually.\n                this.handleCursorAtTableSide(e, tableImagCursor.start, tableImagCursor.end);\n                return;\n            }\n        }\n        if (tableImagCursor.start || tableImagCursor.end || this.range.startContainer.nodeName === 'IMG') {\n            if (this.parent.enterKey === 'BR' && (tableImagCursor.startName === 'IMG' || tableImagCursor.endName === 'IMG' || this.range.startContainer.nodeName === 'IMG')) { // Default browser action prevented and hanled manually.\n                this.handleEnterKeyAtImageSide(e, tableImagCursor.start, tableImagCursor.end);\n                return;\n            }\n        }\n        if (!isNOU(this.startNode.closest('TABLE')) && !isNOU(this.endNode.closest('TABLE'))) {\n            isTableEnter = false;\n            var curElement = this.startNode;\n            var blockElement = curElement;\n            while (!this.parent.formatter.editorManager.domNode.isBlockNode(curElement)) {\n                curElement = curElement.parentElement;\n                blockElement = curElement;\n            }\n            isTableEnter = blockElement.tagName === 'TH' || blockElement.tagName === 'TD' || blockElement.tagName === 'TBODY' ? false : true;\n        }\n        var eventArgs = e.args;\n        if (eventArgs.which === 13 && !eventArgs.ctrlKey && (!Browser.isDevice ? (eventArgs.code === 'Enter' || eventArgs.code === 'NumpadEnter') : eventArgs.key === 'Enter')) {\n            if (isNOU(this.startNode.closest('LI, UL, OL')) && isNOU(this.endNode.closest('LI, UL, OL')) &&\n                isNOU(this.startNode.closest('.e-img-inner')) && isTableEnter &&\n                isNOU(this.startNode.closest('PRE')) && isNOU(this.endNode.closest('PRE')) &&\n                isNOU(this.startNode.closest('BLOCKQUOTE')) && isNOU(this.endNode.closest('BLOCKQUOTE'))) {\n                var shiftKey_1 = e.args.shiftKey;\n                var actionBeginArgs = {\n                    cancel: false,\n                    name: events.actionBegin,\n                    requestType: shiftKey_1 ? 'ShiftEnterAction' : 'EnterAction',\n                    originalEvent: e.args\n                };\n                this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n                    if (!actionBeginArgs.cancel) {\n                        if (_this.parent.formatter.getUndoRedoStack().length === 0) {\n                            _this.parent.formatter.saveData();\n                        }\n                        if (!(_this.range.startOffset === _this.range.endOffset && _this.range.startContainer === _this.range.endContainer)) {\n                            if (!(_this.range.startContainer.nodeName === 'SPAN' && (_this.range.startContainer.classList.contains('e-video-wrap') ||\n                                _this.range.startContainer.classList.contains('e-audio-wrap')))) {\n                                _this.range.deleteContents();\n                            }\n                            if (_this.range.startContainer.nodeName === '#text' && _this.range.startContainer.textContent.length === 0 &&\n                                _this.range.startContainer.parentElement !== _this.parent.inputElement) {\n                                if (_this.parent.enterKey === 'BR') {\n                                    _this.range.startContainer.parentElement.innerHTML = '&#8203;';\n                                }\n                                else {\n                                    _this.range.startContainer.parentElement.innerHTML = '<br>';\n                                }\n                            }\n                            else if (_this.range.startContainer === _this.parent.inputElement && _this.range.startContainer.innerHTML === '') {\n                                _this.range.startContainer.innerHTML = '<br>';\n                                var focusElem = _this.range.startContainer.childNodes[_this.range.startOffset];\n                                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, 0);\n                            }\n                            else if (_this.parent.inputElement === _this.range.startContainer) {\n                                var focusElem = _this.range.startContainer.childNodes[_this.range.startOffset];\n                                if (focusElem.nodeName === '#text' && focusElem.textContent.length === 0) {\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, focusElem.textContent.length === 0 ? 0 : focusElem.previousSibling.textContent.length);\n                                }\n                                else {\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, focusElem.textContent.length >= 0 ? 0 : 1);\n                                    if (focusElem.previousSibling.textContent.length === 0) {\n                                        detach(focusElem.previousSibling);\n                                        if (!shiftKey_1) {\n                                            var currentFocusElem = !isNOU(focusElem.lastChild) ? focusElem.lastChild : focusElem;\n                                            while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text' && currentFocusElem.nodeName !== 'BR') {\n                                                currentFocusElem = currentFocusElem.lastChild;\n                                            }\n                                            if (currentFocusElem.nodeName !== 'BR' && currentFocusElem.parentElement.textContent.length === 0 && currentFocusElem.parentElement.innerHTML.length === 0 &&\n                                                currentFocusElem.parentElement.nodeName !== 'BR') {\n                                                currentFocusElem.parentElement.appendChild(_this.parent.createElement('BR'));\n                                            }\n                                            _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentFocusElem.nodeName === 'BR' ? currentFocusElem : currentFocusElem.parentElement, currentFocusElem.parentElement.textContent.length >= 0 || currentFocusElem.nodeName === 'BR' ? 0 : 1);\n                                        }\n                                    }\n                                    else if (focusElem.textContent.length === 0) {\n                                        var currentFocusElem = focusElem.previousSibling.nodeName === '#text' ? focusElem.previousSibling : focusElem.previousSibling.lastChild;\n                                        while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text') {\n                                            currentFocusElem = currentFocusElem.lastChild;\n                                        }\n                                        _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentFocusElem, currentFocusElem.textContent.length);\n                                        detach(focusElem);\n                                    }\n                                    else if (_this.parent.enterKey !== 'BR' &&\n                                        focusElem.previousSibling.textContent.length !== 0 && focusElem.textContent.length !== 0) {\n                                        e.args.preventDefault();\n                                        return;\n                                    }\n                                }\n                                _this.getRangeNode();\n                            }\n                        }\n                        if (_this.range.startContainer === _this.range.endContainer &&\n                            _this.range.startOffset === _this.range.endOffset && _this.range.startContainer === _this.parent.inputElement) {\n                            if (!(_this.parent.inputElement.childNodes.length === 1 && _this.parent.inputElement.childNodes[0].nodeName === 'TABLE')) {\n                                if (isNOU(_this.range.startContainer.childNodes[_this.range.startOffset])) {\n                                    var currentLastElem = _this.range.startContainer.childNodes[_this.range.startOffset - 1];\n                                    while (currentLastElem.lastChild !== null && currentLastElem.nodeName !== '#text') {\n                                        currentLastElem = currentLastElem.lastChild;\n                                    }\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentLastElem, (currentLastElem.nodeName === 'BR' ? 0 : currentLastElem.textContent.length));\n                                }\n                                else {\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.range.startContainer.childNodes[_this.range.startOffset], 0);\n                                }\n                            }\n                            _this.getRangeNode();\n                        }\n                        if ((_this.parent.enterKey === 'P' && !shiftKey_1) || (_this.parent.enterKey === 'DIV' && !shiftKey_1) ||\n                            (_this.parent.shiftEnterKey === 'P' && shiftKey_1) ||\n                            (_this.parent.shiftEnterKey === 'DIV' && shiftKey_1)) {\n                            if ((_this.range.startOffset === 1 && _this.parent.inputElement.childNodes.length === 1 && _this.parent.inputElement.childNodes[0].nodeName === 'TABLE') || (_this.parent.enterKey === 'BR' && shiftKey_1)) {\n                                var newElem = _this.createInsertElement(shiftKey_1);\n                                newElem.appendChild(_this.parent.createElement('BR'));\n                                _this.parent.inputElement.appendChild(newElem);\n                                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElem, 0);\n                            }\n                            else {\n                                var nearBlockNode = void 0;\n                                if (isTableEnter && _this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode)) {\n                                    if (_this.range.startContainer.nodeName === '#text' && !isNOU(_this.range.startContainer.previousSibling) && _this.range.startContainer.previousSibling.nodeName === 'HR') {\n                                        nearBlockNode = _this.range.startContainer.nextSibling;\n                                    }\n                                    else {\n                                        nearBlockNode = _this.startNode;\n                                    }\n                                }\n                                else {\n                                    nearBlockNode = _this.parent.formatter.editorManager.domNode.blockParentNode(_this.startNode);\n                                }\n                                var isMediaNode = false; // To check the image audio and video node cases\n                                var isFocusedFirst = false;\n                                var parentElement = _this.range.startContainer.parentElement;\n                                var isPreWrapApplied = parentElement ? _this.parent.contentModule.getDocument().defaultView.getComputedStyle(_this.range.startContainer.parentElement, null).getPropertyValue('white-space') === 'pre-wrap' : false;\n                                if (_this.range.startOffset !== 0 && _this.range.endOffset !== 0 &&\n                                    _this.range.startContainer === _this.range.endContainer && !(!isNOU(nearBlockNode.childNodes[0])\n                                    && (nearBlockNode.childNodes[0].nodeName === 'IMG' || nearBlockNode.querySelectorAll('img, audio, video').length > 0))) {\n                                    var startNodeText = _this.range.startContainer.textContent;\n                                    var splitFirstText = startNodeText.substring(0, _this.range.startOffset);\n                                    var lastCharBeforeCursor = splitFirstText.charCodeAt(_this.range.startOffset - 1);\n                                    var isSplitTextEmpty = splitFirstText.trim().length === 0;\n                                    var hasContentAfterCursor = startNodeText.slice(_this.range.startOffset).trim().length !== 0;\n                                    var isCursorAtStartNonPreWrap = lastCharBeforeCursor !== 160\n                                        && isSplitTextEmpty && !isPreWrapApplied;\n                                    var isCursorAtStartPreWrapWithContent = lastCharBeforeCursor === 32\n                                        && isPreWrapApplied && isSplitTextEmpty && hasContentAfterCursor;\n                                    if (isCursorAtStartNonPreWrap || isCursorAtStartPreWrapWithContent) {\n                                        isFocusedFirst = true;\n                                    }\n                                }\n                                else if (_this.range.startOffset === 0 && _this.range.endOffset === 0) {\n                                    isFocusedFirst = true;\n                                }\n                                _this.removeBRElement(nearBlockNode);\n                                var fireFoxEnterAtMiddle = Browser.userAgent.indexOf('Firefox') !== -1 && _this.range.startOffset === 0 && _this.range.startContainer === _this.range.endContainer &&\n                                    _this.range.startContainer.nodeName === '#text' && !_this.parent.formatter.editorManager.domNode.isBlockNode(_this.range.startContainer.previousSibling) &&\n                                    _this.range.startContainer.parentElement === _this.range.startContainer.previousSibling.parentElement;\n                                var preventZeroWithSpace = ((_this.range.startContainer.nodeName === '#text' && _this.range.startContainer.textContent.includes('\\u200B') &&\n                                    _this.range.startContainer.textContent.trim() === '\\u200B') ||\n                                    (_this.range.startContainer.nodeName === '#text' && !isNOU(_this.range.startContainer.textContent[_this.range.startOffset]) &&\n                                        _this.range.startContainer.textContent[_this.range.startOffset].includes('\\u200B') && _this.range.startContainer.textContent[_this.range.startOffset] === '\\u200B' &&\n                                        _this.parent.inputElement.textContent[0] !== '\\u200B'));\n                                // eslint-disable-next-line max-len\n                                if (!preventZeroWithSpace && !fireFoxEnterAtMiddle && ((_this.range.startOffset === 0 && _this.range.endOffset === 0) || isFocusedFirst) &&\n                                    !(!isNOU(_this.range.startContainer.previousSibling) &&\n                                        (_this.range.startContainer.previousSibling.nodeName === 'IMG' || _this.range.startContainer.previousSibling.nodeName === 'BR'))) {\n                                    var isNearBlockLengthZero = void 0;\n                                    var newElem = void 0;\n                                    if (!isNOU(_this.range.startContainer.childNodes) &&\n                                        (_this.range.startContainer.textContent.length === 0 ||\n                                            (_this.range.startContainer.nodeName !== '#text' && !isNOU(_this.range.startContainer.querySelector('.e-video-clickelem')) &&\n                                                _this.range.startContainer.querySelector('.e-video-clickelem').textContent.length === 0)) &&\n                                        (_this.range.startContainer.querySelectorAll('img, audio, video').length > 0 ||\n                                            !isNOU(_this.range.startContainer.querySelector('.e-video-clickelem')) ||\n                                            _this.range.startContainer.nodeName === 'IMG' || _this.range.startContainer.nodeName === 'TABLE')) {\n                                        newElem = _this.createInsertElement(shiftKey_1);\n                                        isMediaNode = true;\n                                        isNearBlockLengthZero = false;\n                                    }\n                                    else {\n                                        if ((nearBlockNode.textContent.trim().length !== 0 ||\n                                            (!isNOU(nearBlockNode.childNodes[0]) && nearBlockNode.childNodes[0].nodeName === 'IMG') ||\n                                            (nearBlockNode.textContent.trim() === '' && nearBlockNode.querySelectorAll('img, audio, video').length > 0))) {\n                                            if ((_this.range.startOffset === _this.range.endOffset && _this.range.startOffset !== 0)) {\n                                                newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, false).cloneNode(true);\n                                            }\n                                            else {\n                                                newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true).cloneNode(true);\n                                                isMediaNode = true;\n                                            }\n                                            isNearBlockLengthZero = false;\n                                        }\n                                        else {\n                                            newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true).cloneNode(true);\n                                            isNearBlockLengthZero = true;\n                                        }\n                                    }\n                                    var insertElem = void 0;\n                                    if (_this.formatTags.indexOf(newElem.nodeName.toLocaleLowerCase()) < 0) {\n                                        insertElem = _this.createInsertElement(shiftKey_1);\n                                    }\n                                    else {\n                                        insertElem = _this.parent.createElement(newElem.nodeName);\n                                    }\n                                    while (newElem.firstChild) {\n                                        insertElem.appendChild(newElem.firstChild);\n                                    }\n                                    nearBlockNode.parentElement.insertBefore(insertElem, nearBlockNode);\n                                    if (!isNearBlockLengthZero) {\n                                        var currentFocusElem = insertElem;\n                                        var finalFocusElem = void 0;\n                                        if (_this.range.startOffset === _this.range.endOffset && _this.range.startOffset !== 0) {\n                                            while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text' &&\n                                                currentFocusElem.nodeName !== 'BR') {\n                                                finalFocusElem = currentFocusElem;\n                                                currentFocusElem = currentFocusElem.lastChild;\n                                            }\n                                        }\n                                        else {\n                                            finalFocusElem = currentFocusElem;\n                                        }\n                                        finalFocusElem.innerHTML = '<br>';\n                                        if (!isMediaNode) {\n                                            detach(nearBlockNode);\n                                        }\n                                    }\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), insertElem.nextElementSibling, 0);\n                                }\n                                else if (nearBlockNode.textContent.length === 0 && !(!isNOU(nearBlockNode.childNodes[0]) && nearBlockNode.childNodes[0].nodeName === 'IMG' ||\n                                    (nearBlockNode.querySelectorAll('video').length > 0) || (nearBlockNode.querySelectorAll('audio').length > 0) || (nearBlockNode.querySelectorAll('img').length > 0))) {\n                                    if (!isNOU(nearBlockNode.children[0]) && nearBlockNode.children[0].tagName !== 'BR') {\n                                        var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, false).cloneNode(true);\n                                        _this.parent.formatter.editorManager.domNode.insertAfter(newElem, nearBlockNode);\n                                        _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElem, newElem.textContent.length >= 0 ? 0 : 1);\n                                    }\n                                    else {\n                                        var insertElem = _this.createInsertElement(shiftKey_1);\n                                        insertElem.innerHTML = '<br>';\n                                        _this.parent.formatter.editorManager.domNode.insertAfter(insertElem, nearBlockNode);\n                                        _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), insertElem, 0);\n                                    }\n                                }\n                                else if (_this.range.startContainer === _this.range.endContainer && _this.range.startContainer.nodeName === 'SPAN' &&\n                                    (_this.range.startContainer.classList.contains('e-video-wrap') ||\n                                        _this.range.startContainer.classList.contains('e-audio-wrap'))) {\n                                    if (nearBlockNode.textContent.trim().length > 0) {\n                                        var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true);\n                                        var audioVideoElem = !isNOU(newElem.previousSibling.querySelector('.e-video-wrap')) ?\n                                            newElem.previousSibling.querySelector('.e-video-wrap') : newElem.previousSibling.querySelector('.e-audio-wrap');\n                                        var isBRInserted = false;\n                                        var lastNode = audioVideoElem.previousSibling;\n                                        while (!isNOU(lastNode) && lastNode.nodeName !== '#text') {\n                                            lastNode = lastNode.lastChild;\n                                        }\n                                        if (isNOU(lastNode)) {\n                                            var brElm = _this.parent.createElement('br');\n                                            audioVideoElem.parentElement.appendChild(brElm);\n                                            isBRInserted = true;\n                                        }\n                                        if (isBRInserted) {\n                                            _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), audioVideoElem.parentElement, 0);\n                                        }\n                                        else {\n                                            _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), lastNode, lastNode.textContent.length);\n                                        }\n                                        detach(audioVideoElem);\n                                    }\n                                    else {\n                                        var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true);\n                                        var focusElem = newElem.previousSibling;\n                                        while (!isNOU(focusElem.firstChild)) {\n                                            detach(focusElem.firstChild);\n                                        }\n                                        var brElm = _this.parent.createElement('br');\n                                        focusElem.appendChild(brElm);\n                                        _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, 0);\n                                    }\n                                    if (!isNOU(_this.parent.audioModule)) {\n                                        _this.parent.audioModule.hideAudioQuickToolbar();\n                                    }\n                                    if (!isNOU(_this.parent.videoModule)) {\n                                        _this.parent.videoModule.hideVideoQuickToolbar();\n                                    }\n                                }\n                                else {\n                                    var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true);\n                                    if (!isNOU(newElem.childNodes[0]) && newElem.childNodes[0].nodeName === '#text' &&\n                                        newElem.childNodes[0].textContent.length === 0) {\n                                        detach(newElem.childNodes[0]);\n                                    }\n                                    if (newElem.textContent.trim().length === 0 || (newElem.childNodes[0].textContent.trim().includes('\\u200B') && newElem.childNodes[0].textContent.trim() === '\\u200B')) {\n                                        var brElm = _this.parent.createElement('br');\n                                        if (_this.startNode.nodeName === 'A') {\n                                            var startParentElem = _this.startNode.parentElement;\n                                            _this.startNode.parentElement.insertBefore(brElm, _this.startNode);\n                                            detach(_this.startNode);\n                                            _this.startNode = startParentElem;\n                                        }\n                                        else {\n                                            if (_this.startNode.nodeName !== 'BR') {\n                                                _this.startNode.appendChild(brElm);\n                                            }\n                                        }\n                                        if (newElem.childNodes[0].textContent === '\\n') {\n                                            detach(newElem.childNodes[0]);\n                                        }\n                                        if (newElem.childNodes[0].textContent.trim().includes('\\u200B') && newElem.childNodes[0].textContent.trim() === '\\u200B') {\n                                            detach(newElem.childNodes[0]);\n                                        }\n                                        _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.startNode, 0);\n                                    }\n                                    if (((_this.parent.enterKey === 'P' || _this.parent.enterKey === 'DIV') && !shiftKey_1) || ((_this.parent.shiftEnterKey === 'DIV' ||\n                                        _this.parent.shiftEnterKey === 'P') && shiftKey_1)) {\n                                        var isHeadingTag = _this.formatTags.indexOf(newElem.nodeName.toLocaleLowerCase());\n                                        if ((isHeadingTag < 0) || (isHeadingTag >= 0 && newElem.textContent.trim().length === 0)) {\n                                            var insertElm = _this.createInsertElement(shiftKey_1);\n                                            while (newElem.firstChild) {\n                                                insertElm.appendChild(newElem.firstChild);\n                                            }\n                                            _this.parent.formatter.editorManager.domNode.insertAfter(insertElm, newElem);\n                                            detach(newElem);\n                                            _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode) ?\n                                                insertElm : _this.startNode, 0);\n                                        }\n                                    }\n                                }\n                            }\n                            e.args.preventDefault();\n                        }\n                        if ((_this.parent.enterKey === 'BR' && !shiftKey_1) || (_this.parent.shiftEnterKey === 'BR' && shiftKey_1)) {\n                            var currentParent = void 0;\n                            if (!_this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode)) {\n                                var currentNode = _this.startNode;\n                                var previousNode = currentNode;\n                                while (!_this.parent.formatter.editorManager.domNode.isBlockNode(currentNode)) {\n                                    previousNode = currentNode;\n                                    currentNode = currentNode.parentElement;\n                                }\n                                currentParent = currentNode === _this.parent.inputElement ?\n                                    previousNode : currentNode;\n                            }\n                            else {\n                                currentParent = _this.startNode;\n                            }\n                            var currentParentStyle = window.getComputedStyle(currentParent);\n                            _this.removeBRElement(currentParent);\n                            var isEmptyBrInserted = false;\n                            var currentParentLastChild = currentParent.lastChild;\n                            while (!isNOU(currentParentLastChild) && !(currentParentLastChild.nodeName === '#text' || currentParentLastChild.nodeName === 'BR'\n                                || currentParentLastChild.nodeName === 'IMG')) {\n                                currentParentLastChild = currentParentLastChild.lastChild;\n                            }\n                            var isLastNodeLength = _this.range.startContainer === currentParentLastChild ?\n                                _this.range.startContainer.textContent.length : currentParent.textContent.length;\n                            var isImageElement = (_this.range.startContainer.nodeName === 'IMG' || (_this.range.startContainer.childNodes.length > 0\n                                && _this.range.startContainer.childNodes[_this.range.startOffset].nodeName === 'IMG'));\n                            if (currentParent !== _this.parent.inputElement &&\n                                _this.parent.formatter.editorManager.domNode.isBlockNode(currentParent) &&\n                                _this.range.startOffset === _this.range.endOffset &&\n                                (_this.range.startOffset === isLastNodeLength ||\n                                    (currentParent.textContent.trim().length === 0 && isImageElement))) {\n                                var focusBRElem = _this.parent.createElement('br');\n                                if (_this.range.startOffset === 0 && _this.range.startContainer.nodeName === 'TABLE') {\n                                    _this.range.startContainer.parentElement.insertBefore(focusBRElem, _this.range.startContainer);\n                                }\n                                else {\n                                    if (currentParentLastChild.nodeName === 'BR' && currentParent.textContent.length === 0) {\n                                        _this.parent.formatter.editorManager.domNode.insertAfter(focusBRElem, currentParentLastChild);\n                                    }\n                                    else if (_this.range.startOffset === 0 && _this.range.endOffset === 0 && isImageElement) {\n                                        var imageElement = _this.range.startContainer.nodeName === 'IMG' ? _this.range.startContainer :\n                                            _this.range.startContainer.childNodes[_this.range.startOffset];\n                                        currentParent.insertBefore(focusBRElem, imageElement);\n                                        focusBRElem = imageElement;\n                                    }\n                                    else {\n                                        var lineBreakBRElem = _this.parent.createElement('br');\n                                        var anchorElement = (!isNOU(_this.range.startContainer.parentElement) && _this.range.startContainer.parentElement.nodeName === 'A'\n                                            && _this.range.startContainer.parentElement.textContent.length === _this.range.startOffset)\n                                            ? _this.range.startContainer.parentElement : _this.range.startContainer;\n                                        _this.parent.formatter.editorManager.domNode.insertAfter(focusBRElem, anchorElement);\n                                        _this.parent.formatter.editorManager.domNode.insertAfter(lineBreakBRElem, anchorElement);\n                                        var brSibling = anchorElement.nextElementSibling;\n                                        var brNextSibling = !isNOU(brSibling) ? brSibling.nextElementSibling : null;\n                                        if (!isNOU(brSibling) && !isNOU(brNextSibling) && !isNOU(brNextSibling.nextElementSibling) &&\n                                            brSibling.nodeName === 'BR' && brNextSibling.nodeName === 'BR' && brNextSibling.nextElementSibling.nodeName === 'BR') {\n                                            brNextSibling.nextElementSibling.remove();\n                                        }\n                                    }\n                                }\n                                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusBRElem, 0);\n                            }\n                            else if (!isNOU(currentParent) && currentParent !== _this.parent.inputElement && currentParent.nodeName !== 'BR') {\n                                if (currentParent.textContent.trim().length === 0 || (currentParent.textContent.trim().length === 1 &&\n                                    currentParent.textContent.charCodeAt(0) === 8203)) {\n                                    if (currentParent.childElementCount > 1 && currentParent.lastElementChild.nodeName === 'IMG') {\n                                        _this.insertBRElement();\n                                    }\n                                    else {\n                                        var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, currentParent, true).cloneNode(true);\n                                        _this.parent.formatter.editorManager.domNode.insertAfter(newElem, currentParent);\n                                        var outerBRElem = _this.parent.createElement('br');\n                                        newElem.parentElement.insertBefore(outerBRElem, newElem);\n                                        _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElem, 0);\n                                    }\n                                }\n                                else {\n                                    var newElem = void 0;\n                                    var outerBRElem = _this.parent.createElement('br');\n                                    if (_this.range.startOffset === 0 && _this.range.endOffset === 0 &&\n                                        !isNOU(currentParent.previousSibling) && currentParent.previousSibling.nodeName === 'BR' && currentParent.nodeName !== 'P' && currentParent.nodeName !== 'DIV') {\n                                        newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, currentParent, false).cloneNode(true);\n                                        _this.parent.formatter.editorManager.domNode.insertAfter(outerBRElem, currentParent);\n                                        _this.insertFocusContent();\n                                        var currentFocusElem = outerBRElem.nextSibling;\n                                        while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text') {\n                                            currentFocusElem = currentFocusElem.lastChild;\n                                        }\n                                        _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentFocusElem, 0);\n                                        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                                        isEmptyBrInserted = true;\n                                    }\n                                    else if (currentParent !== _this.parent.inputElement &&\n                                        (currentParentStyle.display === 'inline' || currentParentStyle.display === 'inline-block')) {\n                                        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                                        newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, currentParent, true).cloneNode(true);\n                                        currentParent.parentElement.insertBefore(outerBRElem, currentParent);\n                                        _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentParent, 0);\n                                        _this.insertFocusContent();\n                                    }\n                                    else {\n                                        _this.insertBRElement();\n                                    }\n                                }\n                            }\n                            else {\n                                _this.insertBRElement();\n                            }\n                            e.args.preventDefault();\n                        }\n                        _this.triggerActionComplete(e, shiftKey_1);\n                        _this.parent.inputElement.dispatchEvent(new Event('input'));\n                    }\n                });\n            }\n        }\n    };\n    EnterKeyAction.prototype.removeBRElement = function (currentElement) {\n        if (Browser.userAgent.indexOf('Firefox') !== -1 &&\n            this.range.endOffset === currentElement.textContent.length && (currentElement.textContent.length !== 0 ||\n            currentElement.querySelectorAll('BR').length > 1) &&\n            !isNOU(currentElement.lastChild) && currentElement.lastChild.nodeName === 'BR') {\n            detach(currentElement.lastChild);\n        }\n    };\n    EnterKeyAction.prototype.insertBRElement = function () {\n        var isEmptyBrInserted = false;\n        var isFocusTextNode = true;\n        if (this.range.endContainer.textContent.length === 0 && this.range.startContainer.nodeName === 'BR') {\n            isFocusTextNode = false;\n        }\n        var brElm = this.parent.createElement('br');\n        var findAnchorLastChild = this.startNode;\n        while (findAnchorLastChild.lastChild) {\n            findAnchorLastChild = findAnchorLastChild.lastChild;\n        }\n        var findAnchorElement = this.startNode.nodeName === 'A' && this.endNode.nodeName === 'A' &&\n            !isNOU(this.range.startContainer.parentElement) && this.range.startOffset === this.range.endOffset &&\n            this.range.startContainer.textContent.trim().length === findAnchorLastChild.textContent.trim().length;\n        if (this.startNode.nodeName === 'BR' && this.endNode.nodeName === 'BR' && this.range.startOffset === 0 && this.range.startOffset === this.range.endOffset) {\n            this.parent.formatter.editorManager.domNode.insertAfter(brElm, this.startNode);\n            isEmptyBrInserted = true;\n        }\n        else {\n            if (this.startNode === this.parent.inputElement && !isNOU(this.range.startContainer.previousSibling) &&\n                this.range.startContainer.previousSibling.nodeName === 'BR' && this.range.startContainer.textContent.length === 0) {\n                isEmptyBrInserted = true;\n            }\n            if (findAnchorElement) {\n                this.parent.formatter.editorManager.domNode.insertAfter(brElm, this.startNode);\n            }\n            else {\n                this.range.insertNode(brElm);\n            }\n        }\n        if (isEmptyBrInserted || (!isNOU(brElm.nextElementSibling) && brElm.nextElementSibling.tagName === 'BR') || (!isNOU(brElm.nextSibling) && (brElm.nextSibling.textContent.length > 0 || (brElm.nextSibling.nodeName === '#text' && brElm.nextSibling.textContent.trim().length === 0 && !isNOU(brElm.nextSibling.nextSibling) && brElm.nextSibling.nextSibling.textContent.trim().length > 0)))) {\n            this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), !isNOU(brElm.nextSibling) && isFocusTextNode ? brElm.nextSibling : brElm, 0);\n            isEmptyBrInserted = false;\n        }\n        else {\n            var brElements = this.parent.createElement('br');\n            if (findAnchorElement) {\n                this.parent.formatter.editorManager.domNode.insertAfter(brElements, this.startNode);\n            }\n            else {\n                this.range.insertNode(brElements);\n            }\n            this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), brElm, 0);\n        }\n    };\n    EnterKeyAction.prototype.insertFocusContent = function () {\n        if (this.range.startContainer.textContent.length === 0) {\n            if (this.range.startContainer.nodeName === '#text') {\n                this.range.startContainer.parentElement.innerHTML = '&#8203;';\n            }\n            else {\n                this.range.startContainer.innerHTML = '&#8203;';\n            }\n        }\n    };\n    EnterKeyAction.prototype.createInsertElement = function (shiftKey) {\n        var insertElem;\n        if ((this.parent.enterKey === 'DIV' && !shiftKey) || (this.parent.shiftEnterKey === 'DIV' && shiftKey)) {\n            insertElem = this.parent.createElement('div');\n        }\n        else if ((this.parent.enterKey === 'P' && !shiftKey) || (this.parent.shiftEnterKey === 'P' && shiftKey)) {\n            insertElem = this.parent.createElement('p');\n        }\n        var previousBlockNode = this.parent.formatter.editorManager.domNode.blockNodes()[0].previousSibling;\n        var nextBlockNode = this.parent.formatter.editorManager.domNode.blockNodes()[0].nextSibling;\n        if (!isNOU(previousBlockNode) && previousBlockNode.nodeName !== '#text' && previousBlockNode.hasAttribute('style') && previousBlockNode.nodeName !== 'TABLE') {\n            insertElem.setAttribute('style', previousBlockNode.getAttribute('style'));\n        }\n        if (isNOU(previousBlockNode) && !isNOU(nextBlockNode) && nextBlockNode.nodeName !== '#text' && nextBlockNode.hasAttribute('style') && nextBlockNode.nodeName !== 'TABLE') {\n            insertElem.setAttribute('style', nextBlockNode.getAttribute('style'));\n        }\n        return insertElem;\n    };\n    EnterKeyAction.prototype.triggerActionComplete = function (e, shiftKey) {\n        this.parent.trigger(events.actionComplete, { requestType: shiftKey ? 'ShiftEnterAction' : 'EnterAction', args: e.args });\n    };\n    EnterKeyAction.prototype.handleCursorAtTableSide = function (e, isStart, isEnd) {\n        var _this = this;\n        if (this.parent.enterKey !== 'BR') {\n            var shiftKey_2 = e.args.shiftKey;\n            var actionBeginArgs = {\n                cancel: false,\n                name: events.actionBegin,\n                requestType: shiftKey_2 ? 'ShiftEnterAction' : 'EnterAction',\n                originalEvent: e.args\n            };\n            this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n                if (!actionBeginArgs.cancel) {\n                    var newElement = _this.parent.createElement(_this.parent.enterKey);\n                    newElement.innerHTML = '<br>';\n                    var tableElement = void 0;\n                    if (isStart) {\n                        tableElement = _this.range.startContainer.childNodes[_this.range.startOffset];\n                        tableElement.parentElement.insertBefore(newElement, tableElement);\n                    }\n                    if (isEnd) {\n                        tableElement = _this.range.startContainer.childNodes[_this.range.startOffset - 1];\n                        if (!isNOU(tableElement.nextSibling)) {\n                            tableElement.parentElement.insertBefore(newElement, tableElement.nextSibling);\n                        }\n                        else if (isNOU(tableElement.nextSibling)) {\n                            tableElement.parentElement.appendChild(newElement);\n                        }\n                    }\n                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElement, 0);\n                    e.args.preventDefault();\n                    _this.triggerActionComplete(e, shiftKey_2);\n                }\n            });\n        }\n    };\n    EnterKeyAction.prototype.handleEnterKeyAtImageSide = function (e, isStart, isEnd) {\n        var _this = this;\n        var actionBeginArgs = {\n            cancel: false,\n            name: events.actionBegin,\n            requestType: e.args.shiftKey ? 'ShiftEnterAction' : 'EnterAction',\n            originalEvent: e.args\n        };\n        var directRange = false;\n        if (this.range.startContainer.nodeName === 'IMG' && this.range.startOffset === 0) {\n            directRange = true;\n        }\n        this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n            if (!actionBeginArgs.cancel) {\n                if (_this.parent.enterKey === 'BR') {\n                    var newElement = _this.parent.createElement('BR');\n                    var imageElement = void 0;\n                    if (directRange) {\n                        imageElement = _this.range.startContainer;\n                        imageElement.parentElement.insertBefore(newElement, imageElement);\n                        _this.parent.formatter.editorManager.nodeSelection.\n                            setCursorPoint(_this.parent.contentModule.getDocument(), imageElement, 0);\n                    }\n                    if (isStart) {\n                        imageElement = _this.range.startContainer.childNodes[_this.range.startOffset];\n                        imageElement.parentElement.insertBefore(newElement, imageElement);\n                        _this.parent.formatter.editorManager.nodeSelection.\n                            setCursorPoint(_this.parent.contentModule.getDocument(), imageElement, 0);\n                    }\n                    if (isEnd) {\n                        imageElement = _this.range.startContainer.childNodes[_this.range.startOffset - 1];\n                        if (!isNOU(imageElement.nextSibling)) {\n                            imageElement.parentElement.insertBefore(newElement, imageElement.nextSibling);\n                            _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElement.nextSibling, 0);\n                        }\n                        else if (isNOU(imageElement.nextSibling)) {\n                            imageElement.parentElement.appendChild(newElement);\n                            var brElement = _this.parent.createElement('BR');\n                            imageElement.parentElement.appendChild(brElement);\n                            _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), brElement, 0);\n                        }\n                    }\n                    e.args.preventDefault();\n                    _this.triggerActionComplete(e, e.args.shiftKey);\n                }\n            }\n        });\n    };\n    EnterKeyAction.prototype.isTableOrImageStart = function () {\n        var customHandlerElements = ['IMG', 'TABLE'];\n        var startContainer = this.range.startContainer;\n        var startOffset = this.range.startOffset;\n        var isCursorAtStart = this.range.collapsed && (startContainer.nodeType === 1) &&\n            startContainer.isContentEditable && startContainer.childNodes[startOffset] &&\n            (customHandlerElements.indexOf(startContainer.childNodes[startOffset].nodeName) > -1);\n        if (isCursorAtStart) {\n            return { start: isCursorAtStart, startNodeName: startContainer.childNodes[startOffset].nodeName };\n        }\n        else {\n            return { start: false, startNodeName: '' };\n        }\n    };\n    EnterKeyAction.prototype.isTableOrImageEnd = function () {\n        var customHandlerElements = ['IMG', 'TABLE'];\n        var startContainer = this.range.startContainer;\n        var startOffset = this.range.startOffset;\n        var isCursorAtEnd = this.range.collapsed && (startContainer.nodeType === 1) &&\n            startContainer.isContentEditable && startContainer.childNodes[startOffset - 1] &&\n            (customHandlerElements.indexOf(startContainer.childNodes[startOffset - 1].nodeName) > -1);\n        if (isCursorAtEnd) {\n            return { end: isCursorAtEnd, endNodeName: startContainer.childNodes[startOffset - 1].nodeName };\n        }\n        else {\n            return { end: false, endNodeName: '' };\n        }\n    };\n    EnterKeyAction.prototype.processedTableImageCursor = function () {\n        var _a = this.isTableOrImageStart(), start = _a.start, startNodeName = _a.startNodeName;\n        var _b = this.isTableOrImageEnd(), end = _b.end, endNodeName = _b.endNodeName;\n        return { start: start, startName: startNodeName, end: end, endName: endNodeName };\n    };\n    return EnterKeyAction;\n}());\nexport { EnterKeyAction };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
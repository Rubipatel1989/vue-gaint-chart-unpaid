{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport * as EVENTS from './../../common/constant';\nimport { isNullOrUndefined as isNOU, detach, createElement, closest } from '@syncfusion/ej2-base';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\nimport { markerClassName } from './dom-node';\nimport { NodeCutter } from './nodecutter';\n/**\n * Formats internal component\n *\n * @hidden\n\n */\nvar Formats = /** @class */function () {\n  /**\n   * Constructor for creating the Formats plugin\n   *\n   * @param {EditorManager} parent - specifies the parent element.\n   * @hidden\n    */\n  function Formats(parent) {\n    this.blockquotePrevent = false;\n    this.parent = parent;\n    this.addEventListener();\n  }\n  Formats.prototype.addEventListener = function () {\n    this.parent.observer.on(EVENTS.FORMAT_TYPE, this.applyFormats, this);\n    this.parent.observer.on(EVENTS.KEY_UP_HANDLER, this.onKeyUp, this);\n    this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.onKeyDown, this);\n    this.parent.observer.on(EVENTS.BLOCKQUOTE_LIST_HANDLE, this.blockQuotesHandled, this);\n    this.parent.observer.on(EVENTS.INTERNAL_DESTROY, this.destroy, this);\n  };\n  Formats.prototype.removeEventListener = function () {\n    this.parent.observer.off(EVENTS.FORMAT_TYPE, this.applyFormats);\n    this.parent.observer.off(EVENTS.KEY_UP_HANDLER, this.onKeyUp);\n    this.parent.observer.off(EVENTS.KEY_DOWN_HANDLER, this.onKeyDown);\n    this.parent.observer.off(EVENTS.INTERNAL_DESTROY, this.destroy);\n  };\n  Formats.prototype.getParentNode = function (node) {\n    for (; node.parentNode && node.parentNode !== this.parent.editableElement; null) {\n      node = node.parentNode;\n    }\n    return node;\n  };\n  Formats.prototype.blockQuotesHandled = function () {\n    this.blockquotePrevent = true;\n  };\n  Formats.prototype.onKeyUp = function (e) {\n    var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n    var endCon = range.endContainer;\n    var lastChild = endCon.lastChild;\n    if (e.event.which === 13 && range.startContainer === endCon && endCon.nodeType !== 3) {\n      var pTag = createElement('p');\n      pTag.innerHTML = '<br>';\n      if (!isNOU(lastChild) && lastChild && lastChild.nodeName === 'BR' && lastChild.previousSibling && lastChild.previousSibling.nodeName === 'TABLE') {\n        endCon.replaceChild(pTag, lastChild);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n      } else {\n        var brNode = this.parent.nodeSelection.getSelectionNodeCollectionBr(range)[0];\n        if (!isNOU(brNode) && brNode.nodeName === 'BR' && brNode.previousSibling && brNode.previousSibling.nodeName === 'TABLE') {\n          endCon.replaceChild(pTag, brNode);\n          this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n        }\n      }\n    }\n    if (e.enterAction !== 'BR' && !isNOU(range.startContainer) && !isNOU(range.startContainer.parentElement) && range.startContainer === range.endContainer && range.startContainer.nodeName === '#text' && range.startContainer.parentElement.classList.contains('e-content') && range.startContainer.parentElement.isContentEditable) {\n      var pTag = createElement(e.enterAction);\n      range.startContainer.parentElement.insertBefore(pTag, range.startContainer);\n      pTag.appendChild(range.startContainer);\n      this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 1);\n    }\n  };\n  Formats.prototype.getBlockParent = function (node, endNode) {\n    var currentParent = node;\n    while (node !== endNode) {\n      currentParent = node;\n      node = node.parentElement;\n    }\n    return currentParent;\n  };\n  Formats.prototype.onKeyDown = function (e) {\n    if (e.event.which === 13 && !this.blockquotePrevent) {\n      var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n      var startCon = range.startContainer.textContent.length === 0 || range.startContainer.nodeName === 'PRE' ? range.startContainer : range.startContainer.parentElement;\n      var endCon = range.endContainer.textContent.length === 0 || range.endContainer.nodeName === 'PRE' ? range.endContainer : range.endContainer.parentElement;\n      var preElem = closest(startCon, 'pre');\n      var endPreElem = closest(endCon, 'pre');\n      var blockquoteEle = closest(startCon, 'blockquote');\n      var endBlockquoteEle = closest(endCon, 'blockquote');\n      var liParent = !isNOU(preElem) && !isNOU(preElem.parentElement) && preElem.parentElement.tagName === 'LI';\n      if (liParent) {\n        return;\n      }\n      if (isNOU(preElem) && !isNOU(endPreElem) || !isNOU(preElem) && isNOU(endPreElem)) {\n        e.event.preventDefault();\n        this.deleteContent(range);\n        this.removeCodeContent(range);\n        range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, endCon, 0);\n      }\n      if (e.event.which === 13 && (!isNOU(blockquoteEle) && !isNOU(endBlockquoteEle) || !isNOU(blockquoteEle) && isNOU(endBlockquoteEle))) {\n        var startParent = this.getBlockParent(range.startContainer, blockquoteEle);\n        if (startParent.textContent.charCodeAt(0) === 8203 && startParent.textContent.length === 1 || startParent.textContent.length === 0 && startParent.querySelectorAll('img').length === 0 && startParent.querySelectorAll('table').length === 0) {\n          e.event.preventDefault();\n          if (isNOU(startParent.nextElementSibling)) {\n            this.paraFocus(startParent.parentElement === this.parent.editableElement ? startParent : startParent.parentElement); //Revert from blockquotes while pressing enter key\n          } else {\n            var nodeCutter = new NodeCutter();\n            var newElem = nodeCutter.SplitNode(range, startParent.parentElement, false).cloneNode(true);\n            this.paraFocus(startParent.parentElement === this.parent.editableElement ? startParent : startParent.parentElement);\n          }\n        }\n      }\n      if (e.event.which === 13 && !isNOU(preElem) && !isNOU(endPreElem)) {\n        e.event.preventDefault();\n        this.deleteContent(range);\n        this.removeCodeContent(range);\n        range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        var lastEmpty = range.startContainer.childNodes[range.endOffset];\n        var lastBeforeBr = range.startContainer.childNodes[range.endOffset - 1];\n        var startParent = range.startContainer;\n        if (!isNOU(lastEmpty) && !isNOU(lastBeforeBr) && isNOU(lastEmpty.nextSibling) && lastEmpty.nodeName === 'BR' && lastBeforeBr.nodeName === 'BR') {\n          this.paraFocus(range.startContainer, e.enterAction);\n        } else if (startParent.textContent.charCodeAt(0) === 8203 && startParent.textContent.length === 1 || startParent.textContent.length === 0) {\n          //Double enter with any parent tag for the node\n          while (startParent.parentElement.nodeName !== 'PRE' && (startParent.textContent.length === 1 || startParent.textContent.length === 0)) {\n            startParent = startParent.parentElement;\n          }\n          if (!isNOU(startParent.previousSibling) && startParent.previousSibling.nodeName === 'BR' && isNOU(startParent.nextSibling)) {\n            this.paraFocus(startParent.parentElement);\n          } else {\n            this.isNotEndCursor(preElem, range);\n          }\n        } else {\n          //Cursor at start and middle\n          this.isNotEndCursor(preElem, range);\n        }\n      }\n    }\n    this.blockquotePrevent = false;\n  };\n  Formats.prototype.removeCodeContent = function (range) {\n    var regEx = new RegExp('\\uFEFF', 'g');\n    if (!isNOU(range.endContainer.textContent.match(regEx))) {\n      var pointer = range.endContainer.textContent.charCodeAt(range.endOffset - 1) === 65279 ? range.endOffset - 2 : range.endOffset;\n      range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n      if (range.endContainer.textContent === '') {\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer.parentElement, 0);\n      } else {\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer, pointer);\n      }\n    }\n  };\n  Formats.prototype.deleteContent = function (range) {\n    if (range.startContainer !== range.endContainer || range.startOffset !== range.endOffset) {\n      range.deleteContents();\n    }\n  };\n  Formats.prototype.paraFocus = function (referNode, enterAction) {\n    var insertTag;\n    if (enterAction === 'DIV') {\n      insertTag = createElement('div');\n      insertTag.innerHTML = '<br>';\n    } else if (enterAction === 'BR') {\n      insertTag = createElement('br');\n    } else {\n      insertTag = createElement('p');\n      insertTag.innerHTML = '<br>';\n    }\n    this.parent.domNode.insertAfter(insertTag, referNode);\n    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, insertTag, 0);\n    detach(referNode.lastChild);\n  };\n  Formats.prototype.isNotEndCursor = function (preElem, range) {\n    var nodeCutter = new NodeCutter();\n    var isEnd = range.startOffset === preElem.lastChild.textContent.length && preElem.lastChild.textContent === range.startContainer.textContent;\n    //Cursor at start point\n    if (preElem.textContent.indexOf(range.startContainer.textContent) === 0 && (range.startOffset === 0 && range.endOffset === 0 || range.startContainer.nodeName === 'PRE')) {\n      this.insertMarker(preElem, range);\n      var brTag = createElement('br');\n      preElem.childNodes[range.endOffset].parentElement.insertBefore(brTag, preElem.childNodes[range.endOffset]);\n    } else {\n      //Cursor at middle\n      var cloneNode = nodeCutter.SplitNode(range, preElem, true);\n      this.insertMarker(preElem, range);\n      var previousSib = preElem.previousElementSibling;\n      if (previousSib.tagName === 'PRE') {\n        previousSib.insertAdjacentHTML('beforeend', '<br>' + cloneNode.innerHTML);\n        detach(preElem);\n      }\n    }\n    //To place the cursor position\n    this.setCursorPosition(isEnd, preElem);\n  };\n  Formats.prototype.setCursorPosition = function (isEnd, preElem) {\n    var isEmpty = false;\n    var markerElem = this.parent.editableElement.querySelector('.tempSpan');\n    var mrkParentElem = markerElem.parentElement;\n    // eslint-disable-next-line\n    markerElem.parentNode.textContent === '' ? isEmpty = true : this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n    if (isEnd) {\n      if (isEmpty) {\n        //Enter press when pre element is empty\n        if (mrkParentElem === preElem) {\n          this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n          detach(markerElem);\n        } else {\n          this.focusSelectionParent(markerElem, mrkParentElem);\n        }\n      } else {\n        var brElm = createElement('br');\n        this.parent.domNode.insertAfter(brElm, markerElem);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n        detach(markerElem);\n      }\n    } else {\n      // eslint-disable-next-line\n      isEmpty ? this.focusSelectionParent(markerElem, mrkParentElem) : detach(markerElem);\n    }\n  };\n  Formats.prototype.focusSelectionParent = function (markerElem, tempSpanPElem) {\n    detach(markerElem);\n    tempSpanPElem.innerHTML = '\\u200B';\n    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, tempSpanPElem, 0);\n  };\n  Formats.prototype.insertMarker = function (preElem, range) {\n    var tempSpan = createElement('span', {\n      className: 'tempSpan'\n    });\n    if (range.startContainer.nodeName === 'PRE') {\n      preElem.childNodes[range.endOffset].parentElement.insertBefore(tempSpan, preElem.childNodes[range.endOffset]);\n    } else {\n      range.startContainer.parentElement.insertBefore(tempSpan, range.startContainer);\n    }\n  };\n  Formats.prototype.applyFormats = function (e) {\n    var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n    var tableCursor = this.parent.nodeSelection.processedTableImageCursor(range);\n    if (tableCursor.start || tableCursor.end) {\n      if (tableCursor.startName === 'TABLE' || tableCursor.endName === 'TABLE') {\n        var tableNode = tableCursor.start ? tableCursor.startNode : tableCursor.endNode;\n        this.applyTableSidesFormat(e, tableCursor.start, tableNode);\n        return;\n      }\n    }\n    var isSelectAll = false;\n    if (this.parent.editableElement === range.endContainer && !isNOU(this.parent.editableElement.children[range.endOffset - 1]) && this.parent.editableElement.children[range.endOffset - 1].tagName === 'TABLE' && !range.collapsed) {\n      isSelectAll = true;\n    }\n    var save = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n    this.parent.domNode.setMarker(save);\n    var formatsNodes = this.parent.domNode.blockNodes(true);\n    if (e.enterAction === 'BR') {\n      this.setSelectionBRConfig();\n      var allSelectedNode = this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument);\n      var selectedNodes = this.parent.nodeSelection.getSelectionNodes(allSelectedNode);\n      var currentFormatNodes = [];\n      if (selectedNodes.length === 0) {\n        selectedNodes.push(formatsNodes[0]);\n      }\n      for (var i = 0; i < selectedNodes.length; i++) {\n        var currentNode = selectedNodes[i];\n        var previousCurrentNode = void 0;\n        while (!this.parent.domNode.isBlockNode(currentNode) && currentNode !== this.parent.editableElement) {\n          previousCurrentNode = currentNode;\n          currentNode = currentNode.parentElement;\n        }\n        if (this.parent.domNode.isBlockNode(currentNode) && currentNode === this.parent.editableElement) {\n          currentFormatNodes.push(previousCurrentNode);\n        }\n      }\n      for (var i = 0; i < currentFormatNodes.length; i++) {\n        if (!this.parent.domNode.isBlockNode(currentFormatNodes[i])) {\n          var currentNode = currentFormatNodes[i];\n          var previousNode = currentNode;\n          while (currentNode === this.parent.editableElement) {\n            previousNode = currentNode;\n            currentNode = currentNode.parentElement;\n          }\n          var tempElem = void 0;\n          if (this.parent.domNode.isBlockNode(previousNode.parentElement) && previousNode.parentElement === this.parent.editableElement) {\n            tempElem = createElement('div');\n            previousNode.parentElement.insertBefore(tempElem, previousNode);\n            tempElem.appendChild(previousNode);\n            if (previousNode.textContent.length === 0) {\n              previousNode.appendChild(createElement('br'));\n            }\n          } else {\n            tempElem = previousNode;\n          }\n          var preNode = tempElem.previousSibling;\n          while (!isNOU(preNode) && preNode.nodeName !== 'BR' && !this.parent.domNode.isBlockNode(preNode)) {\n            tempElem.firstChild.parentElement.insertBefore(preNode, tempElem.firstChild);\n            preNode = tempElem.previousSibling;\n          }\n          if (!isNOU(preNode) && preNode.nodeName === 'BR') {\n            detach(preNode);\n          }\n          var postNode = tempElem.nextSibling;\n          while (!isNOU(postNode) && postNode.nodeName !== 'BR' && !this.parent.domNode.isBlockNode(postNode)) {\n            tempElem.appendChild(postNode);\n            postNode = tempElem.nextSibling;\n          }\n          if (!isNOU(postNode) && postNode.nodeName === 'BR') {\n            detach(postNode);\n          }\n        }\n      }\n      this.setSelectionBRConfig();\n      formatsNodes = this.parent.domNode.blockNodes();\n    }\n    var isWholeBlockquoteNotSelected = false;\n    var isPartiallySelected = false;\n    for (var i = 0; i < formatsNodes.length; i++) {\n      if (isNOU(closest(formatsNodes[0], 'blockquote')) || isNOU(closest(formatsNodes[formatsNodes.length - 1], 'blockquote'))) {\n        isPartiallySelected = true;\n      }\n    }\n    for (var i = 0; i < formatsNodes.length; i++) {\n      var parentNode = void 0;\n      var replaceHTML = void 0;\n      if (e.subCommand.toLowerCase() === 'blockquote') {\n        parentNode = this.getParentNode(formatsNodes[i]);\n        if (e.enterAction === 'BR') {\n          replaceHTML = parentNode.innerHTML;\n        } else {\n          if (!isNOU(closest(formatsNodes[i], 'table')) && this.parent.editableElement.contains(closest(formatsNodes[i], 'table'))) {\n            replaceHTML = !isNOU(closest(formatsNodes[i], 'blockquote')) ? closest(formatsNodes[i], 'blockquote').outerHTML : formatsNodes[i].outerHTML;\n          } else {\n            replaceHTML = parentNode.outerHTML;\n          }\n        }\n      } else {\n        parentNode = formatsNodes[i];\n        replaceHTML = parentNode.innerHTML;\n      }\n      if (e.subCommand.toLowerCase() === 'blockquote' && e.subCommand.toLowerCase() === parentNode.tagName.toLowerCase() && isPartiallySelected || e.subCommand.toLowerCase() === parentNode.tagName.toLowerCase() && (e.subCommand.toLowerCase() !== 'pre' && e.subCommand.toLowerCase() !== 'blockquote' || !isNOU(e.exeValue) && e.exeValue.name === 'dropDownSelect') || isNOU(parentNode.parentNode) || parentNode.tagName === 'TABLE' && e.subCommand.toLowerCase() === 'pre') {\n        continue;\n      }\n      this.cleanFormats(parentNode, e.subCommand);\n      var replaceNode = e.subCommand.toLowerCase() === 'pre' && parentNode.tagName.toLowerCase() === 'pre' ? 'p' : e.subCommand;\n      var isToggleBlockquoteList = e.subCommand.toLowerCase() === parentNode.tagName.toLowerCase() && e.subCommand.toLowerCase() === 'blockquote' && this.parent.domNode.isList(parentNode.firstElementChild);\n      var ensureNode = parentNode.tagName === 'TABLE' ? !isNOU(closest(formatsNodes[i], 'blockquote')) ? closest(formatsNodes[i], 'blockquote') : parentNode : parentNode;\n      var isToggleBlockquote = e.subCommand.toLowerCase() === ensureNode.tagName.toLowerCase() && e.subCommand.toLowerCase() === 'blockquote';\n      var replaceTag = void 0;\n      if (isToggleBlockquoteList) {\n        replaceTag = replaceHTML.replace('<blockquote>', '').replace('</blockquote>', '');\n      } else if (isToggleBlockquote && closest(formatsNodes[0], 'blockquote') && closest(formatsNodes[formatsNodes.length - 1], 'blockquote')) {\n        if (isNOU(formatsNodes[0].previousSibling) && isNOU(formatsNodes[formatsNodes.length - 1].nextSibling)) {\n          replaceTag = replaceHTML.replace(/<blockquote[^>]*>|<\\/blockquote>/g, '');\n        } else {\n          isWholeBlockquoteNotSelected = true;\n          if (i === 0) {\n            var tempCloseSpanElem = createElement('span');\n            tempCloseSpanElem.classList.add('e-rte-blockquote-close');\n            formatsNodes[i].parentNode.insertBefore(tempCloseSpanElem, formatsNodes[i]);\n          }\n          if (i === formatsNodes.length - 1) {\n            var tempOpenSpanElem = createElement('span');\n            tempOpenSpanElem.classList.add('e-rte-blockquote-open');\n            this.parent.domNode.insertAfter(tempOpenSpanElem, formatsNodes[i]);\n          }\n        }\n      } else {\n        replaceTag = this.parent.domNode.createTagString(replaceNode, e.subCommand.toLowerCase() === 'blockquote' ? null : parentNode, replaceHTML.replace(/>\\s+</g, '><'));\n      }\n      if (parentNode.tagName === 'LI') {\n        parentNode.innerHTML = '';\n        parentNode.insertAdjacentHTML('beforeend', replaceTag);\n      } else if (!isWholeBlockquoteNotSelected) {\n        var currentTag = !isNOU(closest(formatsNodes[i], 'table')) && this.parent.editableElement.contains(closest(formatsNodes[i], 'table')) ? !isNOU(closest(formatsNodes[i], 'blockquote')) ? closest(formatsNodes[i], 'blockquote') : formatsNodes[i] : parentNode;\n        this.parent.domNode.replaceWith(currentTag, replaceTag);\n      }\n    }\n    if (isWholeBlockquoteNotSelected) {\n      var blockquoteElem = this.parent.editableElement.querySelectorAll('.e-rte-blockquote-open, .e-rte-blockquote-close');\n      for (var i = 0; i < blockquoteElem.length; i++) {\n        var blockquoteNode = blockquoteElem[i].parentElement;\n        var blockquoteContent = blockquoteNode.innerHTML;\n        blockquoteContent = blockquoteContent.replace(/<span class=\"e-rte-blockquote-open\"><\\/span>/g, '<blockquote>');\n        blockquoteContent = blockquoteContent.replace(/<span class=\"e-rte-blockquote-close\"><\\/span>/g, '</blockquote>');\n        if (blockquoteElem[0].parentElement === blockquoteElem[1].parentElement) {\n          this.parent.domNode.replaceWith(blockquoteNode, this.parent.domNode.openTagString(blockquoteNode) + blockquoteContent.trim() + this.parent.domNode.closeTagString(blockquoteNode));\n          break;\n        } else if (i === blockquoteElem.length - 1 && !isNOU(blockquoteElem[i]) && !isNOU(blockquoteElem[i - 1]) && blockquoteElem[i].parentElement !== blockquoteElem[i - 1].parentElement) {\n          this.parent.domNode.replaceWith(blockquoteNode, blockquoteContent.trim());\n        } else {\n          this.parent.domNode.replaceWith(blockquoteNode, this.parent.domNode.openTagString(blockquoteNode) + blockquoteContent.trim() + this.parent.domNode.closeTagString(blockquoteNode));\n        }\n      }\n    }\n    this.preFormatMerge();\n    this.blockquotesFormatMerge(e.enterAction);\n    var startNode = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n    var endNode = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n    if (!isNOU(startNode) && !isNOU(endNode)) {\n      startNode = startNode.lastChild;\n      endNode = endNode.lastChild;\n    }\n    save = this.parent.domNode.saveMarker(save);\n    if (isIDevice()) {\n      setEditFrameFocus(this.parent.editableElement, e.selector);\n    }\n    if (isSelectAll) {\n      this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startNode, endNode, 0, endNode.textContent.length);\n    } else {\n      save.restore();\n    }\n    if (e.callBack) {\n      e.callBack({\n        requestType: e.subCommand,\n        editorMode: 'HTML',\n        event: e.event,\n        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n        elements: this.parent.domNode.blockNodes()\n      });\n    }\n  };\n  Formats.prototype.setSelectionBRConfig = function () {\n    var startElem = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n    var endElem = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n    if (isNOU(endElem)) {\n      this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, startElem, 0);\n    } else {\n      this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startElem, endElem, 0, 0);\n    }\n  };\n  Formats.prototype.preFormatMerge = function () {\n    var preNodes = this.parent.editableElement.querySelectorAll('PRE');\n    if (!isNOU(preNodes)) {\n      for (var i = 0; i < preNodes.length; i++) {\n        var previousSib = preNodes[i].previousElementSibling;\n        if (!isNOU(previousSib) && previousSib.tagName === 'PRE') {\n          previousSib.insertAdjacentHTML('beforeend', '<br>' + preNodes[i].innerHTML);\n          detach(preNodes[i]);\n        }\n      }\n    }\n  };\n  Formats.prototype.blockquotesFormatMerge = function (enterAction) {\n    var blockquoteNodes = this.parent.editableElement.querySelectorAll('BLOCKQUOTE');\n    if (!isNOU(blockquoteNodes)) {\n      for (var i = 0; i < blockquoteNodes.length; i++) {\n        if (blockquoteNodes[i].innerHTML.trim() === '') {\n          detach(blockquoteNodes[i]);\n        }\n        var previousSib = blockquoteNodes[i].previousElementSibling;\n        if (!isNOU(previousSib) && previousSib.tagName === 'BLOCKQUOTE') {\n          previousSib.insertAdjacentHTML('beforeend', (enterAction === 'BR' ? '<br>' : '') + blockquoteNodes[i].innerHTML);\n          detach(blockquoteNodes[i]);\n        }\n      }\n    }\n  };\n  Formats.prototype.cleanFormats = function (element, tagName) {\n    var ignoreAttr = ['display', 'font-size', 'margin-top', 'margin-bottom', 'margin-left', 'margin-right', 'font-weight'];\n    tagName = tagName.toLowerCase();\n    for (var i = 0; i < ignoreAttr.length && tagName !== 'p' && tagName !== 'blockquote' && tagName !== 'pre'; i++) {\n      element.style.removeProperty(ignoreAttr[i]);\n    }\n  };\n  Formats.prototype.applyTableSidesFormat = function (e, start, table) {\n    var formatNode = createElement(e.subCommand);\n    if (!(e.enterAction === 'BR')) {\n      formatNode.appendChild(createElement('br'));\n    }\n    table.insertAdjacentElement(start ? 'beforebegin' : 'afterend', formatNode);\n    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, formatNode, 0);\n    if (e.callBack) {\n      e.callBack({\n        requestType: e.subCommand,\n        editorMode: 'HTML',\n        event: e.event,\n        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n        elements: this.parent.domNode.blockNodes()\n      });\n    }\n  };\n  Formats.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n  return Formats;\n}();\nexport { Formats };","map":{"version":3,"names":["EVENTS","isNullOrUndefined","isNOU","detach","createElement","closest","isIDevice","setEditFrameFocus","markerClassName","NodeCutter","Formats","parent","blockquotePrevent","addEventListener","prototype","observer","on","FORMAT_TYPE","applyFormats","KEY_UP_HANDLER","onKeyUp","KEY_DOWN_HANDLER","onKeyDown","BLOCKQUOTE_LIST_HANDLE","blockQuotesHandled","INTERNAL_DESTROY","destroy","removeEventListener","off","getParentNode","node","parentNode","editableElement","e","range","nodeSelection","getRange","currentDocument","endCon","endContainer","lastChild","event","which","startContainer","nodeType","pTag","innerHTML","nodeName","previousSibling","replaceChild","setCursorPoint","brNode","getSelectionNodeCollectionBr","enterAction","parentElement","classList","contains","isContentEditable","insertBefore","appendChild","getBlockParent","endNode","currentParent","startCon","textContent","length","preElem","endPreElem","blockquoteEle","endBlockquoteEle","liParent","tagName","preventDefault","deleteContent","removeCodeContent","startParent","charCodeAt","querySelectorAll","nextElementSibling","paraFocus","nodeCutter","newElem","SplitNode","cloneNode","lastEmpty","childNodes","endOffset","lastBeforeBr","nextSibling","isNotEndCursor","regEx","RegExp","match","pointer","replace","startOffset","deleteContents","referNode","insertTag","domNode","insertAfter","isEnd","indexOf","insertMarker","brTag","previousSib","previousElementSibling","insertAdjacentHTML","setCursorPosition","isEmpty","markerElem","querySelector","mrkParentElem","focusSelectionParent","brElm","tempSpanPElem","tempSpan","className","tableCursor","processedTableImageCursor","start","end","startName","endName","tableNode","startNode","applyTableSidesFormat","isSelectAll","children","collapsed","save","setMarker","formatsNodes","blockNodes","setSelectionBRConfig","allSelectedNode","getSelectedNodes","selectedNodes","getSelectionNodes","currentFormatNodes","push","i","currentNode","previousCurrentNode","isBlockNode","previousNode","tempElem","preNode","firstChild","postNode","isWholeBlockquoteNotSelected","isPartiallySelected","replaceHTML","subCommand","toLowerCase","outerHTML","exeValue","name","cleanFormats","replaceNode","isToggleBlockquoteList","isList","firstElementChild","ensureNode","isToggleBlockquote","replaceTag","tempCloseSpanElem","add","tempOpenSpanElem","createTagString","currentTag","replaceWith","blockquoteElem","blockquoteNode","blockquoteContent","openTagString","trim","closeTagString","preFormatMerge","blockquotesFormatMerge","startSelection","endSelection","saveMarker","selector","setSelectionText","restore","callBack","requestType","editorMode","elements","startElem","endElem","preNodes","blockquoteNodes","element","ignoreAttr","style","removeProperty","table","formatNode","insertAdjacentElement"],"sources":["/var/www/vue/vue-gantt-chart/node_modules/@syncfusion/ej2-richtexteditor/src/editor-manager/plugin/formats.js"],"sourcesContent":["import * as EVENTS from './../../common/constant';\nimport { isNullOrUndefined as isNOU, detach, createElement, closest } from '@syncfusion/ej2-base';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\nimport { markerClassName } from './dom-node';\nimport { NodeCutter } from './nodecutter';\n/**\n * Formats internal component\n *\n * @hidden\n\n */\nvar Formats = /** @class */ (function () {\n    /**\n     * Constructor for creating the Formats plugin\n     *\n     * @param {EditorManager} parent - specifies the parent element.\n     * @hidden\n\n     */\n    function Formats(parent) {\n        this.blockquotePrevent = false;\n        this.parent = parent;\n        this.addEventListener();\n    }\n    Formats.prototype.addEventListener = function () {\n        this.parent.observer.on(EVENTS.FORMAT_TYPE, this.applyFormats, this);\n        this.parent.observer.on(EVENTS.KEY_UP_HANDLER, this.onKeyUp, this);\n        this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.onKeyDown, this);\n        this.parent.observer.on(EVENTS.BLOCKQUOTE_LIST_HANDLE, this.blockQuotesHandled, this);\n        this.parent.observer.on(EVENTS.INTERNAL_DESTROY, this.destroy, this);\n    };\n    Formats.prototype.removeEventListener = function () {\n        this.parent.observer.off(EVENTS.FORMAT_TYPE, this.applyFormats);\n        this.parent.observer.off(EVENTS.KEY_UP_HANDLER, this.onKeyUp);\n        this.parent.observer.off(EVENTS.KEY_DOWN_HANDLER, this.onKeyDown);\n        this.parent.observer.off(EVENTS.INTERNAL_DESTROY, this.destroy);\n    };\n    Formats.prototype.getParentNode = function (node) {\n        for (; node.parentNode && node.parentNode !== this.parent.editableElement; null) {\n            node = node.parentNode;\n        }\n        return node;\n    };\n    Formats.prototype.blockQuotesHandled = function () {\n        this.blockquotePrevent = true;\n    };\n    Formats.prototype.onKeyUp = function (e) {\n        var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        var endCon = range.endContainer;\n        var lastChild = endCon.lastChild;\n        if (e.event.which === 13 && range.startContainer === endCon && endCon.nodeType !== 3) {\n            var pTag = createElement('p');\n            pTag.innerHTML = '<br>';\n            if (!isNOU(lastChild) && lastChild && lastChild.nodeName === 'BR' && (lastChild.previousSibling && lastChild.previousSibling.nodeName === 'TABLE')) {\n                endCon.replaceChild(pTag, lastChild);\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n            }\n            else {\n                var brNode = this.parent.nodeSelection.getSelectionNodeCollectionBr(range)[0];\n                if (!isNOU(brNode) && brNode.nodeName === 'BR' && (brNode.previousSibling && brNode.previousSibling.nodeName === 'TABLE')) {\n                    endCon.replaceChild(pTag, brNode);\n                    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n                }\n            }\n        }\n        if (e.enterAction !== 'BR' && !isNOU(range.startContainer) && !isNOU(range.startContainer.parentElement) && range.startContainer === range.endContainer && range.startContainer.nodeName === '#text' && range.startContainer.parentElement.classList.contains('e-content') && range.startContainer.parentElement.isContentEditable) {\n            var pTag = createElement(e.enterAction);\n            range.startContainer.parentElement.insertBefore(pTag, range.startContainer);\n            pTag.appendChild(range.startContainer);\n            this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 1);\n        }\n    };\n    Formats.prototype.getBlockParent = function (node, endNode) {\n        var currentParent = node;\n        while (node !== endNode) {\n            currentParent = node;\n            node = node.parentElement;\n        }\n        return currentParent;\n    };\n    Formats.prototype.onKeyDown = function (e) {\n        if (e.event.which === 13 && !this.blockquotePrevent) {\n            var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n            var startCon = (range.startContainer.textContent.length === 0 || range.startContainer.nodeName === 'PRE')\n                ? range.startContainer : range.startContainer.parentElement;\n            var endCon = (range.endContainer.textContent.length === 0 || range.endContainer.nodeName === 'PRE')\n                ? range.endContainer : range.endContainer.parentElement;\n            var preElem = closest(startCon, 'pre');\n            var endPreElem = closest(endCon, 'pre');\n            var blockquoteEle = closest(startCon, 'blockquote');\n            var endBlockquoteEle = closest(endCon, 'blockquote');\n            var liParent = !isNOU(preElem) && !isNOU(preElem.parentElement) && preElem.parentElement.tagName === 'LI';\n            if (liParent) {\n                return;\n            }\n            if (((isNOU(preElem) && !isNOU(endPreElem)) || (!isNOU(preElem) && isNOU(endPreElem)))) {\n                e.event.preventDefault();\n                this.deleteContent(range);\n                this.removeCodeContent(range);\n                range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, endCon, 0);\n            }\n            if (e.event.which === 13 && ((!isNOU(blockquoteEle) && !isNOU(endBlockquoteEle)) ||\n                (!isNOU(blockquoteEle) && isNOU(endBlockquoteEle)))) {\n                var startParent = this.getBlockParent(range.startContainer, blockquoteEle);\n                if ((startParent.textContent.charCodeAt(0) === 8203 &&\n                    startParent.textContent.length === 1) || (startParent.textContent.length === 0 &&\n                    startParent.querySelectorAll('img').length === 0 &&\n                    startParent.querySelectorAll('table').length === 0)) {\n                    e.event.preventDefault();\n                    if (isNOU(startParent.nextElementSibling)) {\n                        this.paraFocus(startParent.parentElement === this.parent.editableElement ?\n                            startParent : startParent.parentElement); //Revert from blockquotes while pressing enter key\n                    }\n                    else {\n                        var nodeCutter = new NodeCutter();\n                        var newElem = nodeCutter.SplitNode(range, startParent.parentElement, false).cloneNode(true);\n                        this.paraFocus(startParent.parentElement === this.parent.editableElement ?\n                            startParent : startParent.parentElement);\n                    }\n                }\n            }\n            if (e.event.which === 13 && !isNOU(preElem) && !isNOU(endPreElem)) {\n                e.event.preventDefault();\n                this.deleteContent(range);\n                this.removeCodeContent(range);\n                range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n                var lastEmpty = range.startContainer.childNodes[range.endOffset];\n                var lastBeforeBr = range.startContainer.childNodes[range.endOffset - 1];\n                var startParent = range.startContainer;\n                if (!isNOU(lastEmpty) && !isNOU(lastBeforeBr) && isNOU(lastEmpty.nextSibling) &&\n                    lastEmpty.nodeName === 'BR' && lastBeforeBr.nodeName === 'BR') {\n                    this.paraFocus(range.startContainer, e.enterAction);\n                }\n                else if ((startParent.textContent.charCodeAt(0) === 8203 &&\n                    startParent.textContent.length === 1) || startParent.textContent.length === 0) {\n                    //Double enter with any parent tag for the node\n                    while (startParent.parentElement.nodeName !== 'PRE' &&\n                        (startParent.textContent.length === 1 || startParent.textContent.length === 0)) {\n                        startParent = startParent.parentElement;\n                    }\n                    if (!isNOU(startParent.previousSibling) && startParent.previousSibling.nodeName === 'BR' &&\n                        isNOU(startParent.nextSibling)) {\n                        this.paraFocus(startParent.parentElement);\n                    }\n                    else {\n                        this.isNotEndCursor(preElem, range);\n                    }\n                }\n                else {\n                    //Cursor at start and middle\n                    this.isNotEndCursor(preElem, range);\n                }\n            }\n        }\n        this.blockquotePrevent = false;\n    };\n    Formats.prototype.removeCodeContent = function (range) {\n        var regEx = new RegExp('\\uFEFF', 'g');\n        if (!isNOU(range.endContainer.textContent.match(regEx))) {\n            var pointer = range.endContainer.textContent.charCodeAt(range.endOffset - 1) === 65279 ?\n                range.endOffset - 2 : range.endOffset;\n            range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n            if (range.endContainer.textContent === '') {\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer.parentElement, 0);\n            }\n            else {\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer, pointer);\n            }\n        }\n    };\n    Formats.prototype.deleteContent = function (range) {\n        if (range.startContainer !== range.endContainer || range.startOffset !== range.endOffset) {\n            range.deleteContents();\n        }\n    };\n    Formats.prototype.paraFocus = function (referNode, enterAction) {\n        var insertTag;\n        if (enterAction === 'DIV') {\n            insertTag = createElement('div');\n            insertTag.innerHTML = '<br>';\n        }\n        else if (enterAction === 'BR') {\n            insertTag = createElement('br');\n        }\n        else {\n            insertTag = createElement('p');\n            insertTag.innerHTML = '<br>';\n        }\n        this.parent.domNode.insertAfter(insertTag, referNode);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, insertTag, 0);\n        detach(referNode.lastChild);\n    };\n    Formats.prototype.isNotEndCursor = function (preElem, range) {\n        var nodeCutter = new NodeCutter();\n        var isEnd = range.startOffset === preElem.lastChild.textContent.length &&\n            preElem.lastChild.textContent === range.startContainer.textContent;\n        //Cursor at start point\n        if (preElem.textContent.indexOf(range.startContainer.textContent) === 0 &&\n            ((range.startOffset === 0 && range.endOffset === 0) || range.startContainer.nodeName === 'PRE')) {\n            this.insertMarker(preElem, range);\n            var brTag = createElement('br');\n            preElem.childNodes[range.endOffset].parentElement.insertBefore(brTag, preElem.childNodes[range.endOffset]);\n        }\n        else {\n            //Cursor at middle\n            var cloneNode = nodeCutter.SplitNode(range, preElem, true);\n            this.insertMarker(preElem, range);\n            var previousSib = preElem.previousElementSibling;\n            if (previousSib.tagName === 'PRE') {\n                previousSib.insertAdjacentHTML('beforeend', '<br>' + cloneNode.innerHTML);\n                detach(preElem);\n            }\n        }\n        //To place the cursor position\n        this.setCursorPosition(isEnd, preElem);\n    };\n    Formats.prototype.setCursorPosition = function (isEnd, preElem) {\n        var isEmpty = false;\n        var markerElem = this.parent.editableElement.querySelector('.tempSpan');\n        var mrkParentElem = markerElem.parentElement;\n        // eslint-disable-next-line\n        markerElem.parentNode.textContent === '' ? isEmpty = true :\n            this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n        if (isEnd) {\n            if (isEmpty) {\n                //Enter press when pre element is empty\n                if (mrkParentElem === preElem) {\n                    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n                    detach(markerElem);\n                }\n                else {\n                    this.focusSelectionParent(markerElem, mrkParentElem);\n                }\n            }\n            else {\n                var brElm = createElement('br');\n                this.parent.domNode.insertAfter(brElm, markerElem);\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n                detach(markerElem);\n            }\n        }\n        else {\n            // eslint-disable-next-line\n            isEmpty ? this.focusSelectionParent(markerElem, mrkParentElem) : detach(markerElem);\n        }\n    };\n    Formats.prototype.focusSelectionParent = function (markerElem, tempSpanPElem) {\n        detach(markerElem);\n        tempSpanPElem.innerHTML = '\\u200B';\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, tempSpanPElem, 0);\n    };\n    Formats.prototype.insertMarker = function (preElem, range) {\n        var tempSpan = createElement('span', { className: 'tempSpan' });\n        if (range.startContainer.nodeName === 'PRE') {\n            preElem.childNodes[range.endOffset].parentElement.insertBefore(tempSpan, preElem.childNodes[range.endOffset]);\n        }\n        else {\n            range.startContainer.parentElement.insertBefore(tempSpan, range.startContainer);\n        }\n    };\n    Formats.prototype.applyFormats = function (e) {\n        var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        var tableCursor = this.parent.nodeSelection.processedTableImageCursor(range);\n        if (tableCursor.start || tableCursor.end) {\n            if (tableCursor.startName === 'TABLE' || tableCursor.endName === 'TABLE') {\n                var tableNode = tableCursor.start ? tableCursor.startNode : tableCursor.endNode;\n                this.applyTableSidesFormat(e, tableCursor.start, tableNode);\n                return;\n            }\n        }\n        var isSelectAll = false;\n        if (this.parent.editableElement === range.endContainer &&\n            !isNOU(this.parent.editableElement.children[range.endOffset - 1]) &&\n            this.parent.editableElement.children[range.endOffset - 1].tagName === 'TABLE' && !range.collapsed) {\n            isSelectAll = true;\n        }\n        var save = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n        this.parent.domNode.setMarker(save);\n        var formatsNodes = this.parent.domNode.blockNodes(true);\n        if (e.enterAction === 'BR') {\n            this.setSelectionBRConfig();\n            var allSelectedNode = this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument);\n            var selectedNodes = this.parent.nodeSelection.getSelectionNodes(allSelectedNode);\n            var currentFormatNodes = [];\n            if (selectedNodes.length === 0) {\n                selectedNodes.push(formatsNodes[0]);\n            }\n            for (var i = 0; i < selectedNodes.length; i++) {\n                var currentNode = selectedNodes[i];\n                var previousCurrentNode = void 0;\n                while (!this.parent.domNode.isBlockNode(currentNode) && currentNode !== this.parent.editableElement) {\n                    previousCurrentNode = currentNode;\n                    currentNode = currentNode.parentElement;\n                }\n                if (this.parent.domNode.isBlockNode(currentNode) && currentNode === this.parent.editableElement) {\n                    currentFormatNodes.push(previousCurrentNode);\n                }\n            }\n            for (var i = 0; i < currentFormatNodes.length; i++) {\n                if (!this.parent.domNode.isBlockNode(currentFormatNodes[i])) {\n                    var currentNode = currentFormatNodes[i];\n                    var previousNode = currentNode;\n                    while (currentNode === this.parent.editableElement) {\n                        previousNode = currentNode;\n                        currentNode = currentNode.parentElement;\n                    }\n                    var tempElem = void 0;\n                    if (this.parent.domNode.isBlockNode(previousNode.parentElement) &&\n                        previousNode.parentElement === this.parent.editableElement) {\n                        tempElem = createElement('div');\n                        previousNode.parentElement.insertBefore(tempElem, previousNode);\n                        tempElem.appendChild(previousNode);\n                        if (previousNode.textContent.length === 0) {\n                            previousNode.appendChild(createElement('br'));\n                        }\n                    }\n                    else {\n                        tempElem = previousNode;\n                    }\n                    var preNode = tempElem.previousSibling;\n                    while (!isNOU(preNode) && preNode.nodeName !== 'BR' &&\n                        !this.parent.domNode.isBlockNode(preNode)) {\n                        tempElem.firstChild.parentElement.insertBefore(preNode, tempElem.firstChild);\n                        preNode = tempElem.previousSibling;\n                    }\n                    if (!isNOU(preNode) && preNode.nodeName === 'BR') {\n                        detach(preNode);\n                    }\n                    var postNode = tempElem.nextSibling;\n                    while (!isNOU(postNode) && postNode.nodeName !== 'BR' &&\n                        !this.parent.domNode.isBlockNode(postNode)) {\n                        tempElem.appendChild(postNode);\n                        postNode = tempElem.nextSibling;\n                    }\n                    if (!isNOU(postNode) && postNode.nodeName === 'BR') {\n                        detach(postNode);\n                    }\n                }\n            }\n            this.setSelectionBRConfig();\n            formatsNodes = this.parent.domNode.blockNodes();\n        }\n        var isWholeBlockquoteNotSelected = false;\n        var isPartiallySelected = false;\n        for (var i = 0; i < formatsNodes.length; i++) {\n            if (isNOU(closest(formatsNodes[0], 'blockquote')) ||\n                isNOU(closest(formatsNodes[formatsNodes.length - 1], 'blockquote'))) {\n                isPartiallySelected = true;\n            }\n        }\n        for (var i = 0; i < formatsNodes.length; i++) {\n            var parentNode = void 0;\n            var replaceHTML = void 0;\n            if (e.subCommand.toLowerCase() === 'blockquote') {\n                parentNode = this.getParentNode(formatsNodes[i]);\n                if (e.enterAction === 'BR') {\n                    replaceHTML = parentNode.innerHTML;\n                }\n                else {\n                    if (!isNOU(closest(formatsNodes[i], 'table')) && this.parent.editableElement.contains(closest(formatsNodes[i], 'table'))) {\n                        replaceHTML = !isNOU(closest((formatsNodes[i]), 'blockquote')) ?\n                            closest((formatsNodes[i]), 'blockquote').outerHTML :\n                            (formatsNodes[i]).outerHTML;\n                    }\n                    else {\n                        replaceHTML = parentNode.outerHTML;\n                    }\n                }\n            }\n            else {\n                parentNode = formatsNodes[i];\n                replaceHTML = parentNode.innerHTML;\n            }\n            if ((e.subCommand.toLowerCase() === 'blockquote' && e.subCommand.toLowerCase() === parentNode.tagName.toLowerCase() && isPartiallySelected) ||\n                ((e.subCommand.toLowerCase() === parentNode.tagName.toLowerCase() &&\n                    (e.subCommand.toLowerCase() !== 'pre' && e.subCommand.toLowerCase() !== 'blockquote' ||\n                        (!isNOU(e.exeValue) && e.exeValue.name === 'dropDownSelect'))) ||\n                    isNOU(parentNode.parentNode) || (parentNode.tagName === 'TABLE' && e.subCommand.toLowerCase() === 'pre'))) {\n                continue;\n            }\n            this.cleanFormats(parentNode, e.subCommand);\n            var replaceNode = (e.subCommand.toLowerCase() === 'pre' && parentNode.tagName.toLowerCase() === 'pre') ?\n                'p' : e.subCommand;\n            var isToggleBlockquoteList = e.subCommand.toLowerCase() === parentNode.tagName.toLowerCase() &&\n                e.subCommand.toLowerCase() === 'blockquote' && this.parent.domNode.isList(parentNode.firstElementChild);\n            var ensureNode = parentNode.tagName === 'TABLE' ?\n                (!isNOU(closest((formatsNodes[i]), 'blockquote')) ? closest((formatsNodes[i]), 'blockquote') : parentNode) : parentNode;\n            var isToggleBlockquote = (e.subCommand.toLowerCase() === ensureNode.tagName.toLowerCase())\n                && e.subCommand.toLowerCase() === 'blockquote';\n            var replaceTag = void 0;\n            if (isToggleBlockquoteList) {\n                replaceTag = replaceHTML.replace('<blockquote>', '').replace('</blockquote>', '');\n            }\n            else if (isToggleBlockquote && closest(formatsNodes[0], 'blockquote') && closest(formatsNodes[formatsNodes.length - 1], 'blockquote')) {\n                if (isNOU(formatsNodes[0].previousSibling) && isNOU(formatsNodes[formatsNodes.length - 1].nextSibling)) {\n                    replaceTag = replaceHTML.replace(/<blockquote[^>]*>|<\\/blockquote>/g, '');\n                }\n                else {\n                    isWholeBlockquoteNotSelected = true;\n                    if (i === 0) {\n                        var tempCloseSpanElem = createElement('span');\n                        tempCloseSpanElem.classList.add('e-rte-blockquote-close');\n                        formatsNodes[i].parentNode.insertBefore(tempCloseSpanElem, formatsNodes[i]);\n                    }\n                    if (i === formatsNodes.length - 1) {\n                        var tempOpenSpanElem = createElement('span');\n                        tempOpenSpanElem.classList.add('e-rte-blockquote-open');\n                        this.parent.domNode.insertAfter(tempOpenSpanElem, formatsNodes[i]);\n                    }\n                }\n            }\n            else {\n                replaceTag = this.parent.domNode.createTagString(replaceNode, (e.subCommand.toLowerCase() === 'blockquote' ? null : parentNode), replaceHTML.replace(/>\\s+</g, '><'));\n            }\n            if (parentNode.tagName === 'LI') {\n                parentNode.innerHTML = '';\n                parentNode.insertAdjacentHTML('beforeend', replaceTag);\n            }\n            else if (!isWholeBlockquoteNotSelected) {\n                var currentTag = ((!isNOU(closest(formatsNodes[i], 'table')) && this.parent.editableElement.contains(closest(formatsNodes[i], 'table'))) ?\n                    (!isNOU(closest((formatsNodes[i]), 'blockquote')) ? closest((formatsNodes[i]), 'blockquote') : formatsNodes[i]) : parentNode);\n                this.parent.domNode.replaceWith(currentTag, replaceTag);\n            }\n        }\n        if (isWholeBlockquoteNotSelected) {\n            var blockquoteElem = this.parent.editableElement.querySelectorAll('.e-rte-blockquote-open, .e-rte-blockquote-close');\n            for (var i = 0; i < blockquoteElem.length; i++) {\n                var blockquoteNode = blockquoteElem[i].parentElement;\n                var blockquoteContent = blockquoteNode.innerHTML;\n                blockquoteContent = blockquoteContent.replace(/<span class=\"e-rte-blockquote-open\"><\\/span>/g, '<blockquote>');\n                blockquoteContent = blockquoteContent.replace(/<span class=\"e-rte-blockquote-close\"><\\/span>/g, '</blockquote>');\n                if (blockquoteElem[0].parentElement === blockquoteElem[1].parentElement) {\n                    this.parent.domNode.replaceWith(blockquoteNode, this.parent.domNode.openTagString(blockquoteNode) +\n                        blockquoteContent.trim() + this.parent.domNode.closeTagString(blockquoteNode));\n                    break;\n                }\n                else if (i === blockquoteElem.length - 1 && !isNOU(blockquoteElem[i]) && !isNOU(blockquoteElem[i - 1]) &&\n                    blockquoteElem[i].parentElement !== blockquoteElem[i - 1].parentElement) {\n                    this.parent.domNode.replaceWith(blockquoteNode, blockquoteContent.trim());\n                }\n                else {\n                    this.parent.domNode.replaceWith(blockquoteNode, this.parent.domNode.openTagString(blockquoteNode) +\n                        blockquoteContent.trim() + this.parent.domNode.closeTagString(blockquoteNode));\n                }\n            }\n        }\n        this.preFormatMerge();\n        this.blockquotesFormatMerge(e.enterAction);\n        var startNode = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n        var endNode = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n        if (!isNOU(startNode) && !isNOU(endNode)) {\n            startNode = startNode.lastChild;\n            endNode = endNode.lastChild;\n        }\n        save = this.parent.domNode.saveMarker(save);\n        if (isIDevice()) {\n            setEditFrameFocus(this.parent.editableElement, e.selector);\n        }\n        if (isSelectAll) {\n            this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startNode, endNode, 0, endNode.textContent.length);\n        }\n        else {\n            save.restore();\n        }\n        if (e.callBack) {\n            e.callBack({\n                requestType: e.subCommand,\n                editorMode: 'HTML',\n                event: e.event,\n                range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n                elements: this.parent.domNode.blockNodes()\n            });\n        }\n    };\n    Formats.prototype.setSelectionBRConfig = function () {\n        var startElem = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n        var endElem = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n        if (isNOU(endElem)) {\n            this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, startElem, 0);\n        }\n        else {\n            this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startElem, endElem, 0, 0);\n        }\n    };\n    Formats.prototype.preFormatMerge = function () {\n        var preNodes = this.parent.editableElement.querySelectorAll('PRE');\n        if (!isNOU(preNodes)) {\n            for (var i = 0; i < preNodes.length; i++) {\n                var previousSib = preNodes[i].previousElementSibling;\n                if (!isNOU(previousSib) && previousSib.tagName === 'PRE') {\n                    previousSib.insertAdjacentHTML('beforeend', '<br>' + preNodes[i].innerHTML);\n                    detach(preNodes[i]);\n                }\n            }\n        }\n    };\n    Formats.prototype.blockquotesFormatMerge = function (enterAction) {\n        var blockquoteNodes = this.parent.editableElement.querySelectorAll('BLOCKQUOTE');\n        if (!isNOU(blockquoteNodes)) {\n            for (var i = 0; i < blockquoteNodes.length; i++) {\n                if (blockquoteNodes[i].innerHTML.trim() === '') {\n                    detach(blockquoteNodes[i]);\n                }\n                var previousSib = blockquoteNodes[i].previousElementSibling;\n                if (!isNOU(previousSib) && previousSib.tagName === 'BLOCKQUOTE') {\n                    previousSib.insertAdjacentHTML('beforeend', (enterAction === 'BR' ? '<br>' : '') + blockquoteNodes[i].innerHTML);\n                    detach(blockquoteNodes[i]);\n                }\n            }\n        }\n    };\n    Formats.prototype.cleanFormats = function (element, tagName) {\n        var ignoreAttr = ['display', 'font-size', 'margin-top', 'margin-bottom', 'margin-left', 'margin-right', 'font-weight'];\n        tagName = tagName.toLowerCase();\n        for (var i = 0; i < ignoreAttr.length && (tagName !== 'p' && tagName !== 'blockquote' && tagName !== 'pre'); i++) {\n            element.style.removeProperty(ignoreAttr[i]);\n        }\n    };\n    Formats.prototype.applyTableSidesFormat = function (e, start, table) {\n        var formatNode = createElement(e.subCommand);\n        if (!(e.enterAction === 'BR')) {\n            formatNode.appendChild(createElement('br'));\n        }\n        table.insertAdjacentElement(start ? 'beforebegin' : 'afterend', formatNode);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, formatNode, 0);\n        if (e.callBack) {\n            e.callBack({\n                requestType: e.subCommand,\n                editorMode: 'HTML',\n                event: e.event,\n                range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n                elements: this.parent.domNode.blockNodes()\n            });\n        }\n    };\n    Formats.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    return Formats;\n}());\nexport { Formats };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}